{"version":3,"file":"geoplatform.mapcore.js","sources":["../../src/control/L.Control.Loading.js","../../src/control/L.Control.MeasureControl.js","../../src/control/L.Control.MousePosition.js","../../src/layer/osm.js","../../src/layer/baselayer-default.js","../../src/service/types.js","../../src/shared/popup-template.js","../../src/layer/feature.js","../../src/layer/L.esri.Cluster.FeatureLayer.js","../../src/shared/style-resolver.js","../../src/layer/cluster-feature.js","../../src/layer/wms.js","../../src/layer/wmst.js","../../src/layer/wmts.js","../../src/layer/L.TileLayer.ESRI.js","../../src/layer/osm-factory.js","../../src/layer/factory.js","../../src/map/instance.js","../../src/map/factory.js","../../src/index.js"],"sourcesContent":["\n\nvar loadingControl = !L || !L.Control ? null : L.Control.extend({\n    options: {\n        position: 'topleft',\n        separate: false,\n        zoomControl: null,\n        spinjs: false,\n        spin: {\n          lines: 7,\n          length: 3,\n          width: 3,\n          radius: 5,\n          rotate: 13,\n          top: \"83%\"\n        }\n    },\n\n    initialize: function(options) {\n        L.setOptions(this, options);\n        this._dataLoaders = {};\n\n        // Try to set the zoom control this control is attached to from the\n        // options\n        if (this.options.zoomControl !== null) {\n            this.zoomControl = this.options.zoomControl;\n        }\n    },\n\n    onAdd: function(map) {\n        if (this.options.spinjs && (typeof Spinner !== 'function')) {\n            return console.error(\"Leaflet.loading cannot load because you didn't load spin.js (http://fgnass.github.io/spin.js/), even though you set it in options.\");\n        }\n        this._addLayerListeners(map);\n        this._addMapListeners(map);\n\n        // Try to set the zoom control this control is attached to from the map\n        // the control is being added to\n        if (!this.options.separate && !this.zoomControl) {\n            if (map.zoomControl) {\n                this.zoomControl = map.zoomControl;\n            } else if (map.zoomsliderControl) {\n                this.zoomControl = map.zoomsliderControl;\n            }\n        }\n\n        // Create the loading indicator\n        var classes = 'leaflet-control-loading';\n        var container;\n        if (this.zoomControl && !this.options.separate) {\n            // If there is a zoom control, hook into the bottom of it\n            container = this.zoomControl._container;\n            // These classes are no longer used as of Leaflet 0.6\n            classes += ' leaflet-bar-part-bottom leaflet-bar-part last';\n        }\n        else {\n            // Otherwise, create a container for the indicator\n            container = L.DomUtil.create('div', 'leaflet-control-zoom leaflet-bar');\n        }\n        this._indicator = L.DomUtil.create('a', classes, container);\n        if (this.options.spinjs) {\n          this._spinner = new Spinner(this.options.spin).spin();\n          this._indicator.appendChild(this._spinner.el);\n        }\n        return container;\n    },\n\n    onRemove: function(map) {\n        this._removeLayerListeners(map);\n        this._removeMapListeners(map);\n    },\n\n    removeFrom: function (map) {\n        if (this.zoomControl && !this.options.separate) {\n            // Override Control.removeFrom() to avoid clobbering the entire\n            // _container, which is the same as zoomControl's\n            this._container.removeChild(this._indicator);\n            this._map = null;\n            this.onRemove(map);\n            return this;\n        }\n        else {\n            // If this control is separate from the zoomControl, call the\n            // parent method so we don't leave behind an empty container\n            return L.Control.prototype.removeFrom.call(this, map);\n        }\n    },\n\n    addLoader: function(id) {\n        this._dataLoaders[id] = true;\n        this.updateIndicator();\n    },\n\n    removeLoader: function(id) {\n        delete this._dataLoaders[id];\n        this.updateIndicator();\n    },\n\n    updateIndicator: function() {\n        if (this.isLoading()) {\n            this._showIndicator();\n        }\n        else {\n            this._hideIndicator();\n        }\n    },\n\n    isLoading: function() {\n        return this._countLoaders() > 0;\n    },\n\n    _countLoaders: function() {\n        var size = 0, key;\n        for (key in this._dataLoaders) {\n            if (this._dataLoaders.hasOwnProperty(key)) size++;\n        }\n        return size;\n    },\n\n    _showIndicator: function() {\n        // Show loading indicator\n        L.DomUtil.addClass(this._indicator, 'is-loading');\n\n        // If zoomControl exists, make the zoom-out button not last\n        if (!this.options.separate) {\n            if (this.zoomControl instanceof L.Control.Zoom) {\n                L.DomUtil.removeClass(this.zoomControl._zoomOutButton, 'leaflet-bar-part-bottom');\n            }\n            else if (typeof L.Control.Zoomslider === 'function' && this.zoomControl instanceof L.Control.Zoomslider) {\n                L.DomUtil.removeClass(this.zoomControl._ui.zoomOut, 'leaflet-bar-part-bottom');\n            }\n        }\n    },\n\n    _hideIndicator: function() {\n        // Hide loading indicator\n        L.DomUtil.removeClass(this._indicator, 'is-loading');\n\n        // If zoomControl exists, make the zoom-out button last\n        if (!this.options.separate) {\n            if (this.zoomControl instanceof L.Control.Zoom) {\n                L.DomUtil.addClass(this.zoomControl._zoomOutButton, 'leaflet-bar-part-bottom');\n            }\n            else if (typeof L.Control.Zoomslider === 'function' && this.zoomControl instanceof L.Control.Zoomslider) {\n                L.DomUtil.addClass(this.zoomControl._ui.zoomOut, 'leaflet-bar-part-bottom');\n            }\n        }\n    },\n\n    _handleLoading: function(e) {\n        this.addLoader(this.getEventId(e));\n    },\n\n    _handleLoad: function(e) {\n        this.removeLoader(this.getEventId(e));\n    },\n\n    getEventId: function(e) {\n        if (e.id) {\n            return e.id;\n        }\n        else if (e.layer) {\n            return e.layer._leaflet_id;\n        }\n        return e.target._leaflet_id;\n    },\n\n    _layerAdd: function(e) {\n        if (!e.layer || !e.layer.on) return;\n        try {\n            e.layer.on({\n                loading: this._handleLoading,\n                load: this._handleLoad\n            }, this);\n        }\n        catch (exception) {\n            console.warn('L.Control.Loading: Tried and failed to add ' +\n                         ' event handlers to layer', e.layer);\n            console.warn('L.Control.Loading: Full details', exception);\n        }\n    },\n\n    _addLayerListeners: function(map) {\n        // Add listeners for begin and end of load to any layers already on the\n        // map\n        map.eachLayer(function(layer) {\n            if (!layer.on) return;\n            layer.on({\n                loading: this._handleLoading,\n                load: this._handleLoad\n            }, this);\n        }, this);\n\n        // When a layer is added to the map, add listeners for begin and end\n        // of load\n        map.on('layeradd', this._layerAdd, this);\n    },\n\n    _removeLayerListeners: function(map) {\n        // Remove listeners for begin and end of load from all layers\n        map.eachLayer(function(layer) {\n            if (!layer.off) return;\n            layer.off({\n                loading: this._handleLoading,\n                load: this._handleLoad\n            }, this);\n        }, this);\n\n        // Remove layeradd listener from map\n        map.off('layeradd', this._layerAdd, this);\n    },\n\n    _addMapListeners: function(map) {\n        // Add listeners to the map for (custom) dataloading and dataload\n        // events, eg, for AJAX calls that affect the map but will not be\n        // reflected in the above layer events.\n        map.on({\n            dataloading: this._handleLoading,\n            dataload: this._handleLoad,\n            layerremove: this._handleLoad\n        }, this);\n    },\n\n    _removeMapListeners: function(map) {\n        map.off({\n            dataloading: this._handleLoading,\n            dataload: this._handleLoad,\n            layerremove: this._handleLoad\n        }, this);\n    }\n});\n\n\n\nif(L) {\n    if(L.Control) {\n        L.Control.Loading = loadingControl;\n        L.Control.loading = function(options) {\n            return new L.Control.Loading(options);\n        };\n    }\n    if(L.Map) {\n        L.Map.addInitHook(function () {\n            if (this.options.loadingControl) {\n                this.loadingControl = new loadingControl();\n                this.addControl(this.loadingControl);\n            }\n        });\n    }\n}\n\nexport default loadingControl;\n","\nvar measureControl = !L || !L.Control ? null : L.Control.extend({\n    options: {\n        position: 'topleft'\n    },\n\n    onAdd: function (map) {\n        var className = 'leaflet-control-zoom leaflet-bar leaflet-control',\n            container = L.DomUtil.create('div', className);\n\n        this._createButton('&#8674;', 'Measure', 'leaflet-control-measure leaflet-bar-part leaflet-bar-part-top-and-bottom', container, this._toggleMeasure, this);\n\n        return container;\n    },\n\n    _createButton: function (html, title, className, container, fn, context) {\n        var link = L.DomUtil.create('a', className, container);\n        link.innerHTML = html;\n        link.href = '#';\n        link.title = title;\n\n        L.DomEvent\n            .on(link, 'click', L.DomEvent.stopPropagation)\n            .on(link, 'click', L.DomEvent.preventDefault)\n            .on(link, 'click', fn, context)\n            .on(link, 'dblclick', L.DomEvent.stopPropagation);\n\n        return link;\n    },\n\n    _toggleMeasure: function () {\n        this._measuring = !this._measuring;\n\n        if(this._measuring) {\n            L.DomUtil.addClass(this._container, 'leaflet-control-measure-on');\n            this._startMeasuring();\n        } else {\n            L.DomUtil.removeClass(this._container, 'leaflet-control-measure-on');\n            this._stopMeasuring();\n        }\n    },\n\n    _startMeasuring: function() {\n        this._oldCursor = this._map._container.style.cursor;\n        this._map._container.style.cursor = 'crosshair';\n\n        this._doubleClickZoom = this._map.doubleClickZoom.enabled();\n        this._map.doubleClickZoom.disable();\n\n        L.DomEvent\n            .on(this._map, 'mousemove', this._mouseMove, this)\n            .on(this._map, 'click', this._mouseClick, this)\n            .on(this._map, 'dblclick', this._finishPath, this)\n            .on(document, 'keydown', this._onKeyDown, this);\n\n        if(!this._layerPaint) {\n            this._layerPaint = L.layerGroup().addTo(this._map);\n        }\n\n        if(!this._points) {\n            this._points = [];\n        }\n    },\n\n    _stopMeasuring: function() {\n        this._map._container.style.cursor = this._oldCursor;\n\n        L.DomEvent\n            .off(document, 'keydown', this._onKeyDown, this)\n            .off(this._map, 'mousemove', this._mouseMove, this)\n            .off(this._map, 'click', this._mouseClick, this)\n            .off(this._map, 'dblclick', this._mouseClick, this);\n\n        if(this._doubleClickZoom) {\n            this._map.doubleClickZoom.enable();\n        }\n\n        if(this._layerPaint) {\n            this._layerPaint.clearLayers();\n        }\n\n        this._restartPath();\n    },\n\n    _mouseMove: function(e) {\n        if(!e.latlng || !this._lastPoint) {\n            return;\n        }\n\n        if(!this._layerPaintPathTemp) {\n            this._layerPaintPathTemp = L.polyline([this._lastPoint, e.latlng], {\n                color: 'black',\n                weight: 1.5,\n                clickable: false,\n                dashArray: '6,3'\n            }).addTo(this._layerPaint);\n        } else {\n            this._layerPaintPathTemp.spliceLatLngs(0, 2, this._lastPoint, e.latlng);\n        }\n\n        if(this._tooltip) {\n            if(!this._distance) {\n                this._distance = 0;\n            }\n\n            this._updateTooltipPosition(e.latlng);\n\n            var distance = e.latlng.distanceTo(this._lastPoint);\n            this._updateTooltipDistance(this._distance + distance, distance);\n        }\n    },\n\n    _mouseClick: function(e) {\n        // Skip if no coordinates\n        if(!e.latlng) {\n            return;\n        }\n\n        // If we have a tooltip, update the distance and create a new tooltip, leaving the old one exactly where it is (i.e. where the user has clicked)\n        if(this._lastPoint && this._tooltip) {\n            if(!this._distance) {\n                this._distance = 0;\n            }\n\n            this._updateTooltipPosition(e.latlng);\n\n            var distance = e.latlng.distanceTo(this._lastPoint);\n            this._updateTooltipDistance(this._distance + distance, distance);\n\n            this._distance += distance;\n        }\n        this._createTooltip(e.latlng);\n\n\n        // If this is already the second click, add the location to the fix path (create one first if we don't have one)\n        if(this._lastPoint && !this._layerPaintPath) {\n            this._layerPaintPath = L.polyline([this._lastPoint], {\n                color: 'black',\n                weight: 2,\n                clickable: false\n            }).addTo(this._layerPaint);\n        }\n\n        if(this._layerPaintPath) {\n            this._layerPaintPath.addLatLng(e.latlng);\n        }\n\n        // Upate the end marker to the current location\n        if(this._lastCircle) {\n            this._layerPaint.removeLayer(this._lastCircle);\n        }\n\n        this._lastCircle = new L.CircleMarker(e.latlng, {\n            color: 'black',\n            opacity: 1,\n            weight: 1,\n            fill: true,\n            fillOpacity: 1,\n            radius:2,\n            clickable: this._lastCircle ? true : false\n        }).addTo(this._layerPaint);\n\n        this._lastCircle.on('click', function() { this._finishPath(); }, this);\n\n        // Save current location as last location\n        this._lastPoint = e.latlng;\n    },\n\n    _finishPath: function() {\n        // Remove the last end marker as well as the last (moving tooltip)\n        if(this._lastCircle) {\n            this._layerPaint.removeLayer(this._lastCircle);\n        }\n        if(this._tooltip) {\n            this._layerPaint.removeLayer(this._tooltip);\n        }\n        if(this._layerPaint && this._layerPaintPathTemp) {\n            this._layerPaint.removeLayer(this._layerPaintPathTemp);\n        }\n\n        // Reset everything\n        this._restartPath();\n    },\n\n    _restartPath: function() {\n        this._distance = 0;\n        this._tooltip = undefined;\n        this._lastCircle = undefined;\n        this._lastPoint = undefined;\n        this._layerPaintPath = undefined;\n        this._layerPaintPathTemp = undefined;\n    },\n\n    _createTooltip: function(position) {\n        var icon = L.divIcon({\n            className: 'leaflet-measure-tooltip',\n            iconAnchor: [-5, -5]\n        });\n        this._tooltip = L.marker(position, {\n            icon: icon,\n            clickable: false\n        }).addTo(this._layerPaint);\n    },\n\n    _updateTooltipPosition: function(position) {\n        this._tooltip.setLatLng(position);\n    },\n\n    _updateTooltipDistance: function(total, difference) {\n        var totalRound = this._round(total),\n            differenceRound = this._round(difference);\n\n        var text = '<div class=\"leaflet-measure-tooltip-total\">' + totalRound + ' nm</div>';\n        if(differenceRound > 0 && totalRound != differenceRound) {\n            text += '<div class=\"leaflet-measure-tooltip-difference\">(+' + differenceRound + ' nm)</div>';\n        }\n\n        this._tooltip._icon.innerHTML = text;\n    },\n\n    _round: function(val) {\n        return Math.round((val / 1852) * 10) / 10;\n    },\n\n    _onKeyDown: function (e) {\n        if(e.keyCode == 27) {\n            // If not in path exit measuring mode, else just finish path\n            if(!this._lastPoint) {\n                this._toggleMeasure();\n            } else {\n                this._finishPath();\n            }\n        }\n    }\n});\n\nif(L) {\n    if(L.Control) {\n        L.Control.Measure = measureControl;\n        L.control.measure = function (options) {\n            return new L.Control.Measure(options);\n        };\n    }\n    if(L.Map) {\n\n        L.Map.mergeOptions({\n            measureControl: false\n        });\n\n        L.Map.addInitHook(function () {\n            if (this.options.measureControl) {\n                this.measureControl = new measureControl();\n                this.addControl(this.measureControl);\n            }\n        });\n    }\n}\n\n\n\n\nexport default measureControl;\n","\n\n\nvar positionControl = !L || !L.Control ? null : L.Control.extend({\n  options: {\n    position: 'bottomleft',\n    separator: ' : ',\n    emptyString: 'Unavailable',\n    lngFirst: false,\n    numDigits: 6,\n    lngFormatter: undefined,\n    latFormatter: undefined,\n    prefix: \"\"\n  },\n\n  onAdd: function (map) {\n    this._container = L.DomUtil.create('div', 'leaflet-control-mouseposition');\n    L.DomEvent.disableClickPropagation(this._container);\n    map.on('mousemove', this._onMouseMove, this);\n    this._container.innerHTML=this.options.emptyString;\n    return this._container;\n  },\n\n  onRemove: function (map) {\n    map.off('mousemove', this._onMouseMove);\n  },\n\n  _onMouseMove: function (e) {\n    var lng = this.options.lngFormatter ? this.options.lngFormatter(e.latlng.lng) : L.Util.formatNum(e.latlng.lng, this.options.numDigits);\n    var lat = this.options.latFormatter ? this.options.latFormatter(e.latlng.lat) : L.Util.formatNum(e.latlng.lat, this.options.numDigits);\n    var value = this.options.lngFirst ? lng + this.options.separator + lat : lat + this.options.separator + lng;\n    var prefixAndValue = this.options.prefix + ' ' + value;\n    this._container.innerHTML = prefixAndValue;\n  }\n\n});\n\n\nif(L) {\n    if(L.Control) {\n        L.Control.MousePosition =  positionControl;\n        L.control.mousePosition = function (options) {\n            return new L.Control.MousePosition(options);\n        };\n    }\n    if(L.Map) {\n        L.Map.mergeOptions({\n            positionControl: false\n        });\n\n        L.Map.addInitHook(function () {\n            if (this.options.positionControl) {\n                this.positionControl = new positionControl();\n                this.addControl(this.positionControl);\n            }\n        });\n    }\n}\nexport default positionControl;\n","\nimport Q from \"q\";\nimport GeoPlatformClient from 'geoplatform.client';\n\nconst QueryFactory = GeoPlatformClient.QueryFactory;\nconst LayerService = GeoPlatformClient.LayerService;\nconst HttpClient = GeoPlatformClient.JQueryHttpClient;\nconst Config = GeoPlatformClient.Config;\n\n/**\n * @param {LayerService} layerService - optional, GeoPlatform Layer service to use to fetch the layer\n * @return {Promise} resolving OpenStreet Map GeoPlatform Layer\n */\nexport default {\n\n    /**\n     * @param {Object} layer - GeoPlatform Layer object\n     * @return {boolean} true if is an OSM layer\n     */\n    test : function(layer) {\n        return  layer &&\n                layer.resourceTypes &&\n                layer.resourceTypes.length &&\n                ~layer.resourceTypes.indexOf(\"http://www.geoplatform.gov/ont/openlayer/OSMLayer\");\n    },\n\n    get : function(layerService) {\n        let query = QueryFactory()\n            .fields('*')\n            .resourceTypes(\"http://www.geoplatform.gov/ont/openlayer/OSMLayer\");\n        if(!layerService)\n            layerService = new LayerService(Config.ualUrl, new HttpClient());\n        return layerService.search(query)\n        .then( response => response.results.length ? response.results[0] : null)\n        .catch( e => Q.reject(e));\n    }\n\n};\n","\nimport Q from 'q';\nimport OSM from './osm';\nimport GeoPlatformClient from 'geoplatform.client';\n\n\nconst url = GeoPlatformClient.Config.ualUrl;\nconst baseLayerId = GeoPlatformClient.Config.defaultBaseLayerId;\nconst LayerService = GeoPlatformClient.LayerService;\nconst HttpClient = GeoPlatformClient.JQueryHttpClient;\n\n/**\n * If a default base layer is defined using the 'defaultBaseLayer'\n * environment value, fetch it. Otherwise, fetch the OpenStreet Map layer.\n * @param {LayerService} layerService - GeoPlatform Layer service to use to fetch the layer\n * @return {Promise} resolving GeoPlatform Layer object\n */\nexport default function(layerService) {\n    if(!GeoPlatformClient.Config.defaultBaseLayerId)\n        return OSM.get();\n\n    if(!layerService)\n        layerService = new LayerService(url, new HttpClient());\n    return layerService.get(baseLayerId)\n    .catch(e => Q.resolve( OSM.get() ));\n}\n","\nimport jQuery from \"jquery\";\nimport Q from \"q\";\nimport GeoPlatformClient from 'geoplatform.client';\n\n\nconst ItemService = GeoPlatformClient.ItemService;\nconst HttpClient = GeoPlatformClient.JQueryHttpClient;\nconst QueryFactory = GeoPlatformClient.QueryFactory;\nconst Config = GeoPlatformClient.Config;\n\n\nconst ogcExpr = /OGC.+\\(([A-Z\\-]+)\\)/;\nconst esriExpr = /Esri REST ([A-Za-z]+) Service/;\nconst keyFn = (expr, str) => {\n    let m = expr.exec(str);\n    return (m && m.length) ? m[1] : null;\n};\n\nvar types = {\n    //will be populated by function\n    //...\n    //...\n    //...\n    refresh: updateList //method to allow refreshing list later\n};\n\nfunction updateList() {\n    \n    let url = Config.ualUrl;\n    if(!url) {\n        console.log(\"WARN : ServiceTypes - no GeoPlatform API URL configured, unable to load service types\");\n    } else {\n\n        let query = QueryFactory()\n            .types('dct:Standard')\n            .resourceTypes('ServiceType')\n            .pageSize(50);\n\n        new ItemService(url, new HttpClient()).search(query)\n        .then( data => {\n\n            for(let i=0; i<data.results.length; ++i) {\n\n                let type = data.results[i],\n                    key = null,\n                    label = type.label;\n\n                if(~label.indexOf(\"WMS-T\")) {\n                    key = 'WMST';\n                    type.supported = true;\n\n                } else if(~label.indexOf('OGC')) {\n                    key = keyFn(ogcExpr, label);\n                    type.supported = 'WMS' === key || 'WMTS' === key;\n\n                } else if(~label.indexOf('Esri')) {\n                    key = keyFn(esriExpr, label);\n                    type.supported = true;\n                    key = 'ESRI_' + key.toUpperCase() + '_SERVER';\n\n                } else if(~label.indexOf(\"Feed\")) {\n                    key = \"FEED\";\n                    type.supported = true;\n\n                } else {\n                    key = label;\n\n                }\n\n                types[key] = type;\n            }\n            // console.log(types);\n        })\n        .catch( error => {\n            console.log(\"Error loading supported service types: \" + error.message);\n        });\n    }\n}\n\nexport default types;\n","\n\nfunction featurePopupTemplate(feature) {\n\n    let props = Object.keys(feature.properties);\n\n    const pFn = function(list, names) {\n        if(!list || !list.find) return null;\n        let match = list.find( name => {\n            let lc = name.toLowerCase();\n            return names.indexOf(lc)>=0;\n        });\n        return match;\n    };\n\n    let titleProp = pFn(props, ['title','name','label']);\n    let title = titleProp ? feature.properties[titleProp] : \"Untitled\";\n\n    let descProp = pFn(props, ['description', 'summary', 'descript']);\n    let description = descProp ? feature.properties[descProp] : \"No description provided\";\n\n    let result = '<div class=\"feature-popup\">' +\n        '<h5>' + title + '</h5>' +\n        '<p>' + description + '</p>';\n\n    if(feature.properties.modified) {\n        let modified = new Date(feature.properties.modified);\n        result += '<div><span class=\"label\">Updated</span><span class=\"value\">' +\n            modified.toDateString() + '</span></div>';\n    }\n\n    if(feature.properties['cap:effective']) {\n        let date = new Date(feature.properties['cap:effective']);\n        result += '<div>' +\n            '<span class=\"label\">Effective</span>' +\n            '<span class=\"value\">' +\n            date.toDateString() + ' ' + date.toTimeString() +\n            '</span>' +\n            '</div>';\n    }\n    if(feature.properties['cap:expires']) {\n        let date = new Date(feature.properties['cap:expires']);\n        result += '<div>' +\n            '<span class=\"label\">Expires</span>' +\n            '<span class=\"value\">' +\n            date.toDateString() + ' ' + date.toTimeString() +\n            '</span>' +\n            '</div>';\n    }\n\n    let linkProp = pFn(props, ['landingpage','link','website']);\n    if(linkProp) {\n        result += '<br>';\n        result += '<a href=\"' + feature.properties[linkProp] + '\" target=\"_blank\">link</a>';\n    }\n\n    result += '<hr>';\n\n    for(let prop in feature.properties) {\n        if(titleProp === prop || descProp === prop ||\n            linkProp === prop || 'modified' === prop)\n            continue;\n        let value = feature.properties[prop];\n        if(typeof(value) === 'object') {\n            for(let p in value) {\n                result += '<div>' +\n                    '<span class=\"label\">' + prop + '.' + p + '</span>' +\n                    '<span class=\"value\">' + value[p] + '</span>' +\n                    '</div>';\n            }\n        } else {\n            result += '<div>' +\n                '<span class=\"label\">' + prop + '</span>' +\n                '<span class=\"value\">' + value + '</span>' +\n                '</div>';\n        }\n    }\n    result += '</div>';\n    return result;\n};\n\nexport default featurePopupTemplate;\n","\nimport jQuery from \"jquery\";\nimport Q from \"q\";\nimport {Config} from \"geoplatform.client\";\n\nimport featurePopupTemplate from '../shared/popup-template';\n\n/**\n * Feature Layer\n * Provides custom style loading and point-ilization as well\n * as adding visibility and opacity manipulation methods\n * @extends L.esri.FeatureLayer\n */\nvar FeatureLayer = !L || !L.esri ? null : L.esri.FeatureLayer.extend({\n\n    _gpStyle : { color: \"#00f\", weight: 2, fillColor: '#00f', fillOpacity: 0.3 },\n\n    /**\n     * @param {object} feature - GeoJSON Point Feature\n     * @param {L.LatLng} latlng\n     * @return {L.Marker}\n     */\n    pointToLayerFn: function (feature, latlng) {\n\n        // console.log(\"Feature: \" + feature.id);\n\n        var style = feature && feature.properties ? feature.properties.style : null;\n        if(!style && typeof this.options.style === 'function') {\n            // console.log(\"Using local style function\");\n            try {\n                style = this.options.style(feature);\n            } catch(e) {\n                console.log(\"error using style function in ClusteredFeatureLayer: \" + e.message);\n            }\n        }\n\n        style = style || this.options.style || {};\n\n        let marker = null;\n        if(style.shape === 'image') {\n            let width = style.width || 16;\n            let height = style.height || 16;\n            var icon = L.icon( {\n                iconUrl: style.content, //base64 encoded string\n                iconSize: [width, height],\n                iconAnchor: [width*0.5, height*0.5],\n                popupAnchor: [0, -11],\n            });\n            marker = L.marker( latlng, {\n                icon: icon,\n                pane: Config.leafletPane\n            });\n\n        } else {\n            style.radius = style.radius || style['stroke-width'] || 4;\n            style.weight = style.weight || style['stroke-width'] || 2;\n            style.color = style.color || style.stroke || '#03f';\n            style.opacity = style.opacity || style['stroke-opacity'] || 0.9;\n            style.fillOpacity = style.opacity || style['fill-opacity'] || 0.3;\n            style.fillColor = style.color || style.fill;\n            style.renderer = this.options.renderer;  //important for pane!\n            marker = L.circleMarker(latlng, style);\n        }\n\n        let popupTemplate = this.options.popupTemplate || featurePopupTemplate;\n        marker.bindPopup(popupTemplate(feature));\n        return marker;\n    },\n\n    /**\n     * for all non-point features, bind a popup\n     * @param {object} feature - GeoJSON feature\n     * @param {L.Layer} layer - layer representing feature\n     */\n    eachFeatureFn: function(feature, layer) {\n        if(!feature || !feature.geometry || feature.geometry.type === 'Point') {\n            return;\n        }\n        layer.bindPopup(featurePopupTemplate(feature));\n    },\n\n\n\n    initialize: function (options) {\n\n        var self = this;\n        options = options || {};\n\n        if(Config.leafletPane)\n            options.pane = Config.leafletPane;\n\n        let getGPStyle = () => { return this._gpStyle; };\n        options.style = options.style || getGPStyle();\n\n        //in order to put features-based layers into same pane as tile layers,\n        // must specify renderer and set desired pane on that\n        let svgOpts = {};\n        if(Config.leafletPane)\n            svgOpts.pane = Config.leafletPane;\n        var renderer = (L.SVG && L.svg(svgOpts)) || (L.Canvas && L.canvas());\n        options.renderer = renderer;\n\n        options.pointToLayer = L.bind(this.pointToLayerFn, this);\n        options.onEachFeature = L.bind(this.eachFeatureFn, this);\n\n        // options.fields = ['FID', 'type', 'title', 'geometry'];\n\n        L.esri.FeatureLayer.prototype.initialize.call(this, options);\n\n        this.on('load', function() {\n            if(typeof this.options.zIndex !== 'undefined')\n                this.setZIndex(this.options.zIndex);\n        });\n\n    },\n\n    setZIndex : function (index) {\n        this.options.zIndex = index;\n        for(var id in this._layers)\n            this._layers[id].setZIndex(index);\n    },\n\n    toggleVisibility: function() {\n        for(var id in this._layers) {\n            let layer = this._layers[id];\n            if(layer.toggleVisibility)\n                this._layers[id].toggleVisibility();\n        }\n    },\n\n    setOpacity: function(opacity) {\n        for(var id in this._layers) {\n            let layer = this._layers[id];\n            if(layer.setOpacity)\n                layer.setOpacity(opacity);\n        }\n    },\n\n    loadStyle: function(gpLayerId) {\n        var self = this;\n\n        if(this.options.styleLoader) {\n            this.options.styleLoader(gpLayerId)\n            .then( json => {\n\n                if(!json) return;\n\n                let style = null;\n\n                if(json && json.styles) {\n\n                    let styleFn = L.Util.bind(function(feature) {\n\n                        let property = this.property || this.field1;\n                        let v = feature[property] || (feature.properties ? feature.properties[property] : null);\n                        let style = null;\n                        if(this.styles) {\n                            let wrapper = this.styles.find( sw => sw.value === v );\n                            if(wrapper) {\n                                style = wrapper.style;\n                                style.radius = style.radius || style['stroke-width'] || 4;\n                                style.weight = style.weight || style['stroke-width'] || 2;\n                                style.color = style.color   || style.stroke || '#03f';\n                                style.opacity = style.opacity || style['stroke-opacity'] || 0.9;\n                                style.fillOpacity = style.opacity || style['fill-opacity'] || 0.3;\n                                style.fillColor = style.color || style.fill;\n                            }\n                        }\n                        // console.log(\"Using style: \" + JSON.stringify(style));\n                        return style;\n                    }, json);\n                    this.options.style = styleFn;\n                    this.setStyle(styleFn);\n                    return;\n\n                } else if(json && typeof(json.push) !== 'undefined') {\n                    //multiple styles returned\n                    style = json[0];  //use first for now\n\n                } else if(json) {\n                    style = json;\n\n                } else {\n                    return; //unrecognizable style\n                }\n\n                if(style.shape) {\n                    var obj = jQuery.extend({}, style);\n                    obj.style = style;\n                    this._gpStyle = style;\n\n                    //setStyle on Cluster.FeatureLayer doesn't appear to work consistently for\n                    // non-clustered features.\n                    // this.setStyle(obj);\n                    //So instead, we manually set it on all features of the layer (that aren't clustered)\n                    for(let id in this._layers)\n                        this._layers[id].setStyle(obj);\n\n                }\n            })\n            .catch( e => {\n                console.log(\"Error fetching feature layer style\");\n                console.log(e);\n            });\n        }\n    }\n\n});\n\n\nexport default FeatureLayer;\n","\n/* jshint ignore:start */\n\n\n/* esri-leaflet-cluster - v2.0.0 - Thu Aug 18 2016 17:12:43 GMT-0700 (PDT)\n * Copyright (c) 2016 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nvar version = \"2.0.0\";\n\nvar FeatureLayer = !L || !L.esri || !L.esri.Cluster ? null : \n    L.esri.Cluster.FeatureManager.extend({\n\n  statics: {\n    EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose',\n    CLUSTEREVENTS: 'clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu'\n  },\n\n  /**\n   * Constructor\n   */\n\n  initialize: function (options) {\n    esriLeaflet.FeatureManager.prototype.initialize.call(this, options);\n\n    options = L.setOptions(this, options);\n\n    this._layers = {};\n    this._leafletIds = {};\n\n    this.cluster = L.markerClusterGroup(options);\n    this._key = 'c' + (Math.random() * 1e9).toString(36).replace('.', '_');\n\n    this.cluster.addEventParent(this);\n  },\n\n  /**\n   * Layer Interface\n   */\n\n  onAdd: function (map) {\n    esriLeaflet.FeatureManager.prototype.onAdd.call(this, map);\n    this._map.addLayer(this.cluster);\n\n    // NOTE !!!!!!!\n    // Using this type of layer requires map.maxZoom to be set during map creation!\n    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n  },\n\n  onRemove: function (map) {\n    esriLeaflet.FeatureManager.prototype.onRemove.call(this, map);\n    this._map.removeLayer(this.cluster);\n  },\n\n  /**\n   * Feature Management Methods\n   */\n\n  createLayers: function (features) {\n    var markers = [];\n\n    for (var i = features.length - 1; i >= 0; i--) {\n      var geojson = features[i];\n      var layer = this._layers[geojson.id];\n\n      if (!layer) {\n        var newLayer = L.GeoJSON.geometryToLayer(geojson, this.options);\n        newLayer.feature = L.GeoJSON.asFeature(geojson);\n        newLayer.defaultOptions = newLayer.options;\n        newLayer._leaflet_id = this._key + '_' + geojson.id;\n\n        this.resetStyle(newLayer.feature.id);\n\n        // cache the layer\n        this._layers[newLayer.feature.id] = newLayer;\n\n        this._leafletIds[newLayer._leaflet_id] = geojson.id;\n\n        if (this.options.onEachFeature) {\n          this.options.onEachFeature(newLayer.feature, newLayer);\n        }\n\n        this.fire('createfeature', {\n          feature: newLayer.feature\n        });\n\n        // add the layer if it is within the time bounds or our layer is not time enabled\n        if (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson))) {\n          markers.push(newLayer);\n        }\n      }\n    }\n\n    if (markers.length) {\n      this.cluster.addLayers(markers);\n    }\n  },\n\n  addLayers: function (ids) {\n    var layersToAdd = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var layer = this._layers[ids[i]];\n      this.fire('addfeature', {\n        feature: layer.feature\n      });\n      layersToAdd.push(layer);\n    }\n    this.cluster.addLayers(layersToAdd);\n  },\n\n  removeLayers: function (ids, permanent) {\n    var layersToRemove = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      var layer = this._layers[id];\n      this.fire('removefeature', {\n        feature: layer.feature,\n        permanent: permanent\n      });\n      layersToRemove.push(layer);\n      if (this._layers[id] && permanent) {\n        delete this._layers[id];\n      }\n    }\n    this.cluster.removeLayers(layersToRemove);\n  },\n\n  /**\n   * Styling Methods\n   */\n\n  resetStyle: function (id) {\n    var layer = this._layers[id];\n\n    if (layer) {\n      layer.options = layer.defaultOptions;\n      this.setFeatureStyle(layer.feature.id, this.options.style);\n    }\n\n    return this;\n  },\n\n  setStyle: function (style) {\n    this.eachFeature(function (layer) {\n      this.setFeatureStyle(layer.feature.id, style);\n    }, this);\n    return this;\n  },\n\n  setFeatureStyle: function (id, style) {\n    var layer = this._layers[id];\n\n    if (typeof style === 'function') {\n      style = style(layer.feature);\n    }\n    if (layer.setStyle) {\n      layer.setStyle(style);\n    }\n  },\n\n  /**\n   * Utility Methods\n   */\n\n  eachFeature: function (fn, context) {\n    for (var i in this._layers) {\n      fn.call(context, this._layers[i]);\n    }\n    return this;\n  },\n\n  getFeature: function (id) {\n    return this._layers[id];\n  }\n});\n\nfunction featureLayer (options) {\n  return new FeatureLayer(options);\n}\n\nexport {\n    FeatureLayer,\n    featureLayer as default,\n    version as VERSION\n}\n","\nimport jQuery from 'jquery';\nimport Q from \"q\";\nimport {Config} from 'geoplatform.client';\n\n/**\n * Fetches style information from GeoPlatform UAL\n * @param {string} id - identifier of layer to resolve style for\n */\nfunction featureStyleResolver(id) {\n    let deferred = Q.defer();\n    jQuery.ajax({\n       url: Config.ualUrl + '/api/layers/' + id + '/style',\n       dataType: 'json',\n       success: function(data) {\n           deferred.resolve(data);\n       },\n       error: function(xhr, status, message) {\n           let em = `FeatureStyleResolver() -\n               Error loading style information for layer ${id} : ${message}`;\n           let error = new Error(em);\n           deferred.reject(error);\n       }\n    });\n    return deferred.promise;\n};\n\nexport default featureStyleResolver;\n","\nimport jQuery from \"jquery\";\nimport Q from  \"q\";\nimport { Config } from 'geoplatform.client';\n\nimport { FeatureLayer as EsriClusterFeatureLayer } from './L.esri.Cluster.FeatureLayer';\nimport featureStyleResolver from '../shared/style-resolver';\n\n\n/**\n * Clustered Feature Layer\n * Provides custom style loading and point-ilization as well\n * as adding visibility and opacity manipulation methods\n * @extends L.esri.ClusterFeatureLayer\n */\nvar ClusteredFeatureLayer = !L || !EsriClusterFeatureLayer ? null :\nEsriClusterFeatureLayer.extend({\n\n    _gpStyle : { color: \"#00f\", weight: 2, fillColor: '#00f', fillOpacity: 0.3 },\n\n    /**\n     * @param {object} feature - GeoJSON Point Feature\n     * @param {L.LatLng} latlng\n     * @return {L.Marker}\n     */\n    pointToLayerFn: function (feature, latlng) {\n\n        var style = feature && feature.properties ? feature.properties.style : null;\n        if(!style && typeof this.options.style === 'function') {\n            // console.log(\"Using local style function\");\n            try {\n                style = this.options.style(feature);\n            } catch(e) {\n                console.log(\"error using style function in ClusteredFeatureLayer: \" + e.message);\n            }\n        }\n\n        style = style || this.options.style || {};\n        style.radius      = style['stroke-width'] || style.radius || 4;\n        style.weight      = style['stroke-width'] || style.weight || 2;\n        style.color       = style.stroke || style.color || '#03f';\n        style.opacity     = style['stroke-opacity'] || style.opacity || 0.9;\n        style.fillOpacity = style['fill-opacity'] || style.opacity || 0.3;\n        style.fillColor   = style.fill || style.color || '#03f';\n        style.renderer    = this.options.renderer;  //important for pane!\n\n        let marker = null;\n        if(style.shape === 'image') {\n            let width = style.width || 16;\n            let height = style.height || 16;\n            var icon = L.icon( {\n                iconUrl: style.content, //base64 encoded string\n                iconSize: [width, height],\n                iconAnchor: [width*0.5, height*0.5],\n                popupAnchor: [0, -11],\n            });\n            marker = L.marker( latlng, {\n                icon: icon,\n                pane: Config.leafletPane\n            });\n        } else {\n            marker = L.circleMarker(latlng, style);\n        }\n\n        let popupTemplate = this.options.popupTemplate || featurePopupTemplate;\n        marker.bindPopup(popupTemplate(feature));\n\n        return marker;\n    },\n\n    /**\n     * for all non-point features, bind a popup\n     * @param {object} feature - GeoJSON feature\n     * @param {L.Layer} layer - layer representing feature\n     */\n    eachFeatureFn: function(feature, layer) {\n        if(!feature || !feature.geometry || feature.geometry.type === 'Point') {\n            return;\n        }\n        layer.bindPopup(featurePopupTemplate(feature));\n    },\n\n\n\n    initialize: function (options) {\n\n        var self = this;\n\n        options = options || {};\n\n        if(Config.leafletPane)\n            options.pane = Config.leafletPane;\n\n        options.pointToLayer = L.bind(this.pointToLayerFn, this);\n        options.onEachFeature = L.bind(this.eachFeatureFn, this);\n        // options.fields = ['FID', 'type', 'title', 'geometry'];\n\n        //Increase from 1 to increase the distance away from the center that spiderfied markers are placed.\n        // This needs to be increased to ensure all markers can be clicked\n        // when spiderfied (some get stuck under the spider legs)\n        options.spiderfyDistanceMultiplier = 2;\n\n        let getGPStyle = () => { return this._gpStyle; };\n        options.style = options.style || getGPStyle;\n        if(options.styleResolver) {\n            this.styleResolver = options.styleResolver;\n        }\n\n        //in order to put features-based layers into same pane as tile layers,\n        // must specify renderer and set desired pane on that\n        let svgOpts = {};\n        if(Config.leafletPane)\n            svgOpts.pane = Config.leafletPane;\n        var renderer = (L.SVG && L.svg(svgOpts)) || (L.Canvas && L.canvas());\n        options.renderer = renderer;\n\n        L.esri.Cluster.FeatureLayer.prototype.initialize.call(this, options);\n\n        this.on('load', function() {\n            if(typeof this.options.zIndex !== 'undefined')\n                this.setZIndex(this.options.zIndex);\n        });\n\n    },\n\n    onAdd: function(map) {\n        L.esri.Cluster.FeatureLayer.prototype.onAdd.call(this, map);\n\n        if(this.options.layerId) {\n            this.loadStyle(this.options.layerId);\n        }\n    },\n\n    setZIndex : function (index) {\n        this.options.zIndex = index;\n        for(var id in this._layers)\n            this._layers[id].setZIndex(index);\n    },\n\n    toggleVisibility: function() {\n\n        //clustered features\n        if(this.cluster && this.cluster._featureGroup && this.cluster._featureGroup._layers) {\n            for(let id in this.cluster._featureGroup._layers) {\n                let layer = this.cluster._featureGroup._layers[id];\n                if(layer._icon) {\n                    jQuery(layer._icon).toggleClass('invisible');\n                }\n            }\n        }\n\n        //non-clustered features\n        if(this._layers) {\n            for(let id in this._layers)\n                this._layers[id].toggleVisibility();\n        }\n    },\n\n    setVisibility: function(bool) {\n\n        //clustered features\n        if(this.cluster && this.cluster._featureGroup && this.cluster._featureGroup._layers) {\n            for(let id in this.cluster._featureGroup._layers) {\n                let layer = this.cluster._featureGroup._layers[id];\n                if(layer._icon) {\n                    //probably is a more efficient way to do this,\n                    // but this works currently.\n                    // TODO look at using\n                    //  markerCluster.refreshIconOptions({className:'invisible'});\n                    var icon = jQuery(layer._icon);\n                    if(bool) icon.removeClass('invisible');\n                    else icon.addClass('invisible');\n                }\n            }\n        }\n\n        //non-clustered features\n        if(this._layers) {\n            for(let id in this._layers) {\n                let layer = this._layers[id];\n                if(layer.setVisibility)\n                    layer.setVisibility(bool);\n                else if(layer.setStyle)\n                    layer.setStyle({display: bool ? '':'none'});\n            }\n        }\n    },\n\n    setOpacity: function(opacity) {\n\n        //clustered features\n        if(this.cluster && this.cluster._featureGroup && this.cluster._featureGroup._layers) {\n            for(let id in this.cluster._featureGroup._layers) {\n                let layer = this.cluster._featureGroup._layers[id];\n                if(layer._icon) {\n                    jQuery(layer._icon).css({opacity: opacity});\n                }\n            }\n        }\n\n        //non-clustered features\n        if(this._layers) {\n            for(let id in this._layers) {\n                let layer = this._layers[id];\n                if(layer.setOpacity)\n                    layer.setOpacity(opacity);\n            }\n        }\n    },\n\n    setStyle: function(style) {\n        this.eachFeature(function (layer) {\n            this.setFeatureStyle(layer.feature.id, style);\n        }, this);\n    },\n\n    loadStyle: function(gpLayerId) {\n\n        if(this.options.styleLoader) {\n            this.options.styleLoader(gpLayerId)\n            .then( json => {\n\n                if(!json) return;\n\n                let style = null;\n\n                if(json && json.styles) {\n\n                    let styleFn = L.Util.bind(function(feature) {\n\n                        let property = this.property || this.field1;\n                        let v = feature[property] || (feature.properties ? feature.properties[property] : null);\n                        let style = null;\n                        if(this.styles) {\n                            let wrapper = this.styles.find( sw => sw.value === v );\n                            if(wrapper) {\n                                style = wrapper.style;\n                                style.radius = style['stroke-width'] || style.radius || 4;\n                                style.weight = style['stroke-width'] || style.weight || 2;\n                                style.color = style.stroke || style.color || '#03f';\n                                style.opacity = style['stroke-opacity'] || style.opacity || 0.9;\n                                style.fillOpacity = style['fill-opacity'] || style.opacity || 0.3;\n                                style.fillColor = style.fill || style.color || '#03f';\n                            } else {\n                                console.log(\"No matching style for \" + JSON.stringify(feature.properties));\n                            }\n                        }\n                        // console.log(\"Using style: \" + JSON.stringify(style));\n                        return style;\n                    }, json);\n                    this.options.style = styleFn;\n                    setTimeout( (layer, style) => { layer.setStyle(style); }, 1000, this, styleFn);\n                    return;\n\n                } else if(json && typeof(json.push) !== 'undefined') {\n                    //multiple styles returned\n                    style = json[0];  //use first for now\n\n                } else if(json) {\n                    style = json;\n\n                } else {\n                    return; //unrecognizable style\n                }\n\n                if(style.shape) {\n                    var obj = jQuery.extend({}, style);\n                    obj.style = style;\n                    this._gpStyle = style;\n\n                    //setStyle on Cluster.FeatureLayer doesn't appear to work consistently for\n                    // non-clustered features.\n                    // this.setStyle(obj);\n                    //So instead, we manually set it on all features of the layer (that aren't clustered)\n                    for(let id in this._layers)\n                        this._layers[id].setStyle(obj);\n\n                }\n            })\n            .catch( e => {\n                console.log(\"Error fetching feature layer style\");\n                console.log(e);\n            });\n        }\n    }\n});\n\n\n\nfunction clusteredFeatures(layer) {\n\n    let service = layer.services && layer.services.length ?\n        layer.services[0] : null;\n    if(!service) {\n        let msg = `clusteredFeatures() -\n                  Cannot create leaflet layer for GP Layer:\n                  layer has no service`;\n        throw new Error(msg);\n    }\n\n    let url     = service.href,\n        format  = layer.supportedFormats ? layer.supportedFormats[0] : null;\n\n    return new ClusteredFeatureLayer({\n        url: url + '/' + layer.layerName,\n        styleLoader: featureStyleResolver,\n        layerId: layer.id,\n        pane: Config.leafletPane\n    });\n}\n\n\nfunction geoJsonFeed(layer) {\n\n    let service = layer.services && layer.services.length ?\n        layer.services[0] : null;\n    if(!service) {\n        let msg = `geoJsonFeed() -\n                  Cannot create leaflet layer for GP Layer:\n                  layer has no service`;\n        throw new Error(msg);\n    }\n\n    let url     = service.href,\n        format  = layer.supportedFormats ? layer.supportedFormats[0] : null;\n\n    let layerUrl = url + (url[url.length-1]==='/'?'':'/') +\n        layer.id + '/FeatureServer/' + layer.layerName;\n\n    let styleUrl = url.replace('feeds','styles') +\n        (url[url.length-1]==='/'?'':'/') + layer.id;\n\n    let styleLoaderFactory = function(url) {\n        return function (layerId) {\n            let deferred = Q.defer();\n            jQuery.ajax(url, {\n                dataType:'json',\n                success: function(data) {\n                    deferred.resolve(data);\n                },\n                error: function(xhr, status, message) {\n                    let em = `geoJsonFeed() -\n                        Error loading style information for layer ${layerId} : ${message}`;\n                    let error = new Error(em);\n                    deferred.reject(error);\n                }\n            });\n            return deferred.promise;          //uses jQuery promise\n        };\n    };\n\n    return new ClusteredFeatureLayer({\n        url: layerUrl,\n        isModern: true,         //force to use GeoJSON\n        layerId: layer.id,    //used by style loader\n        styleLoader: styleLoaderFactory(styleUrl),\n        pane: Config.leafletPane\n    });\n\n}\n\n\nexport {\n    ClusteredFeatureLayer as default,\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed\n};\n","\nimport jQuery from \"jquery\";\nimport Q from \"q\";\nimport {Config} from 'geoplatform.client';\n\n\n\nvar WMS = !L || !L.TileLayer ? null : L.TileLayer.WMS.extend({\n\n    enableGetFeatureInfo: function () {\n        this._map.on('click', this.getFeatureInfo, this);\n        this._enabled = true;\n    },\n\n    disableGetFeatureInfo: function() {\n        this._map.off('click', this.getFeatureInfo, this);\n        this._enabled = false;\n    },\n\n    isGetFeatureInfoEnabled: function() {\n        return this._enabled;\n    },\n\n    onRemove: function (map) {\n\n        //if GFI is enabled, disable it before removing\n        if(this.isGetFeatureInfoEnabled())\n        this.disableGetFeatureInfo();\n\n        // Triggered when the layer is removed from a map.\n        //   Unregister a click listener, then do all the upstream WMS things\n        L.TileLayer.WMS.prototype.onRemove.call(this, map);\n    },\n\n    getFeatureInfo: function (evt) {\n        // Make an AJAX request to the server and hope for the best\n        var url = this.getFeatureInfoUrl(evt.latlng),\n        showResults = L.Util.bind(this.showGetFeatureInfo, this),\n        parseGetFeatureInfo = this.parseGetFeatureInfo;\n        jQuery.ajax({\n            url: url,\n            success: function (data, status, xhr) {\n                // var err = typeof data === 'string' ? null : data;\n                if(typeof(data) !== 'string')\n                data = parseGetFeatureInfo(data);\n                showResults(null, evt.latlng, data);\n            },\n            error: function (xhr, status, error) {\n                showResults(error);\n            }\n        });\n    },\n\n    getFeatureInfoUrl: function (latlng) {\n        // Construct a GetFeatureInfo request URL given a point\n        var point = this._map.latLngToContainerPoint(latlng, this._map.getZoom()),\n        size = this._map.getSize(),\n\n        params = {\n            srs: 'EPSG:4326',\n            bbox: this._map.getBounds().toBBoxString(),\n            height: size.y,\n            width: size.x,\n            // layers: this.wmsParams.layers,\n            // query_layers: this.wmsParams.layers,\n            info_format: 'text/xml',\n            x: point.x,\n            y: point.y,\n            i: point.x, //1.3.0\n            j: point.y  //1.3.0\n        };\n\n        // return this._url + L.Util.getParamString(params, this._url, true);\n        var url = '/api/layers/' + this.wmsParams.wmvId + '/feature';\n        return Config.ualUrl + url + L.Util.getParamString(params, url, true);\n    },\n\n    parseGetFeatureInfo: function(content) {\n        var fields = [];\n        for(var field in content) {\n            fields.push(['<div><strong>', field, ': </strong>', content[field], '</div>'].join(' '));\n        }\n        if(fields.length == 0)\n        fields.push('<em>No data available</em>');\n        return '<div>' + fields.join(' ') + '</div>';\n    },\n\n    showGetFeatureInfo: function (err, latlng, content) {\n        if (err) { console.log(err); return; } // do nothing if there's an error\n\n        // Otherwise show the content in a popup, or something.\n        L.popup({ maxWidth: 800})\n        .setLatLng(latlng)\n        .setContent(content)\n        .openOn(this._map);\n    }\n\n});\n\n\nfunction wms(layer) {\n\n    let service = layer.services && layer.services.length ?\n        layer.services[0] : null;\n    if(!service) {\n        let msg = `wms() -\n                  Cannot create leaflet layer for GP Layer:\n                  layer has no service`;\n        throw new Error(msg);\n    }\n\n    let url = service.href;\n    let format  = layer.supportedFormats ? layer.supportedFormats[0] : \"image/png\";\n\n    let opts = {\n        layers: layer.layerName,\n        transparent: true,\n        format: format,\n        wmvId: layer.id\n    };\n    if(Config.leafletPane)\n        opts.pane = Config.leafletPane;\n\n    return new WMS(url, opts);\n\n}\n\nif(L) {\n    L.TileLayer.WMS = WMS;\n    L.tileLayer.wms = wms;\n}\n\nexport {\n    WMS as default,\n    WMS,\n    wms\n};\n","\n\nimport jQuery from \"jquery\";\nimport Q from \"q\";\nimport {Config} from 'geoplatform.client';\n\n\nvar WMST = !L || !L.TimeDimension ? null : L.TimeDimension.Layer.WMS.extend({\n\n    //override default parser to query all Layers (whether queryable or not)\n    _parseTimeDimensionFromCapabilities: function(xml) {\n        var layers = xml.querySelectorAll('Layer');\n        var layerName = this._baseLayer.wmsParams.layers;\n        var layer = null;\n        var times = null;\n\n        layers.forEach(function(current) {\n            if (current.querySelector(\"Name\").innerHTML === layerName) {\n                layer = current;\n            }\n        });\n        if (layer) {\n            times = this._getTimesFromLayerCapabilities(layer);\n            if (!times) {\n                times = this._getTimesFromLayerCapabilities(layer.parentNode);\n            }\n        }\n\n        return times;\n    },\n\n    //override default parser to fall back if Dimension is provided but has no values\n    _getTimesFromLayerCapabilities: function(layer) {\n        var times = null;\n        var dimensions = layer.querySelectorAll(\"Dimension[name='time']\");\n        if (dimensions && dimensions.length && dimensions[0].textContent.length) {\n            times = dimensions[0].textContent.trim();\n        }\n        if(!times || !times.length) {\n            var extents = layer.querySelectorAll(\"Extent[name='time']\");\n            if (extents && extents.length && extents[0].textContent.length) {\n                times = extents[0].textContent.trim();\n            }\n        }\n        if(times && ~times.indexOf(\"current\")) {\n            times = times.replace('current', new Date().toISOString());\n        }\n        return times;\n    }\n\n});\n\n\n\n\nfunction wmst(gpLayer) {\n\n    let service = gpLayer.services[0];\n    let url = service.href;\n\n    let opts = {\n        layers: gpLayer.layerName,\n        transparent: true,\n        format: \"image/png\",\n        wmvId: gpLayer.layerId\n    };\n    if(Config.leafletPane)\n        opts.pane = Config.leafletPane;\n\n    let leafletLayer = new L.TileLayer.CustomWMS( url, opts );\n\n    let proxyUrl = Config.ualUrl + '/api/services/' +\n        service.id + '/proxy/capabilities';\n\n    let tdOpts = {};\n\n    if(gpLayer.temporal) {\n\n        let d1 = gpLayer.temporal.startDate ?\n            new Date(gpLayer.temporal.startDate) : new Date();\n        let d2 = gpLayer.temporal.endDate ?\n            new Date(gpLayer.temporal.endDate) : new Date();\n\n        tdOpts.times = d1.toISOString() + '/' + d2.toISOString() + '/P1D';\n    }\n\n    return new WMST(leafletLayer, {\n        timeDimension: L.timeDimension(tdOpts),\n        proxy: proxyUrl\n    });\n}\n\n\nif(L) {\n    L.TileLayer.WMST = WMST;\n    L.tileLayer.wmst = wmst;\n}\n\nexport {\n    WMST as default,\n    WMST,\n    wmst\n};\n","\n\nimport jQuery from \"jquery\";\nimport Q from \"q\";\nimport {Config} from 'geoplatform.client';\n\n\nif (typeof Object.assign != 'function') {\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, \"assign\", {\n        value: function assign(target, varArgs) { // .length of function is 2\n            'use strict';\n            if (target == null) { // TypeError if undefined or null\n                throw new TypeError('Cannot convert undefined or null to object');\n            }\n\n            var to = Object(target);\n\n            for (var index = 1; index < arguments.length; index++) {\n                var nextSource = arguments[index];\n\n                if (nextSource != null) { // Skip over if undefined or null\n                    for (var nextKey in nextSource) {\n                        // Avoid bugs when hasOwnProperty is shadowed\n                        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                            to[nextKey] = nextSource[nextKey];\n                        }\n                    }\n                }\n            }\n            return to;\n        },\n        writable: true,\n        configurable: true\n    });\n}\n\n\nconst paramRe = /\\{ *([\\w_-]+) *\\}/g;\n\n// @function template(str: String, data: Object): String\n// Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\n// and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\n// `('Hello foo, bar')`. You can also specify functions instead of strings for\n// data values  they will be evaluated passing `data` as an argument.\nfunction template(str, data) {\n\treturn str.replace(paramRe, function (str, key) {\n\t\tvar value = data[key];\n        if (value === undefined) {\n            value = data[key.toLowerCase()];\n        }\n        if (value === undefined) {\n        \tthrow new Error('No value provided for variable ' + str);\n\t\t} else if (typeof value === 'function') {\n\t\t\tvalue = value(data);\n\t\t}\n\t\treturn value;\n\t});\n}\n\n\n/*\n * inspired by and uses code from https://github.com/mylen/leaflet.TileLayer.WMTS\n */\nvar WMTS = !L || !L.TileLayer ? null : L.TileLayer.extend({\n\n    defaultWmtsParams: {\n\n        service: 'WMTS',\n        request: 'GetTile',\n        version: '1.0.0',\n        layers: '',\n        styles: '',\n        tileMatrixSet: '',\n        format: 'image/png'\n    },\n\n    initialize: function (url, options) { // (String, Object)\n        this._url = url;\n        var wmtsParams = L.extend({}, this.defaultWmtsParams);\n        var tileSize = options.tileSize || this.options.tileSize;\n        if (options.detectRetina && L.Browser.retina) {\n            wmtsParams.width = wmtsParams.height = tileSize * 2;\n        } else {\n            wmtsParams.width = wmtsParams.height = tileSize;\n        }\n        for (var i in options) {\n            // all keys that are not TileLayer options go to WMTS params\n            if (!this.options.hasOwnProperty(i) && i!=\"matrixIds\") {\n                wmtsParams[i] = options[i];\n            }\n        }\n        this.wmtsParams = wmtsParams;\n        this.matrixIds = options.matrixIds||this.getDefaultMatrix();\n        L.setOptions(this, options);\n    },\n\n    onAdd: function (map) {\n        this._crs = this.options.crs || map.options.crs;\n        L.TileLayer.prototype.onAdd.call(this, map);\n    },\n\n    getTileUrl: function (coords) { // (Point, Number) -> String\n        var tileSize = this.options.tileSize;\n        var nwPoint = coords.multiplyBy(tileSize);\n        nwPoint.x+=1;\n        nwPoint.y-=1;\n        var sePoint = nwPoint.add(new L.Point(tileSize, tileSize));\n        var zoom = this._tileZoom;\n        var nw = this._crs.project(this._map.unproject(nwPoint, zoom));\n        var se = this._crs.project(this._map.unproject(sePoint, zoom));\n        var tilewidth = se.x-nw.x;\n        //zoom = this._map.getZoom();\n        var ident = this.matrixIds[zoom].identifier;\n        var tileMatrix = this.wmtsParams.tileMatrixSet + \":\" + ident;\n        var X0 = this.matrixIds[zoom].topLeftCorner.lng;\n        var Y0 = this.matrixIds[zoom].topLeftCorner.lat;\n        var tilecol=Math.floor((nw.x-X0)/tilewidth);\n        var tilerow=-Math.floor((nw.y-Y0)/tilewidth);\n\n\n        let url = this._url;\n        let isTileMatrixTemplated = url.indexOf('{TileMatrix}');\n        let isTileRowTemplated = url.indexOf('{TileRow}');\n        let isTileColTemplated = url.indexOf('{TileCol}');\n\n        let o = Object.assign({ s: this._getSubdomain(coords) }, this.wmtsParams);\n        if(isTileMatrixTemplated>0) o.TileMatrix = ident;\n        if(isTileRowTemplated>0) o.TileRow = tilerow;\n        if(isTileColTemplated>0) o.TileCol = tilecol;\n        for(let k in o) {\n            o[k.toLowerCase()] = o[k];\n        }\n        // url = L.Util.template(url.toLowerCase(), o);\n        url = template(url, o);\n\n        let qsi = url.indexOf(\"?\");\n        if(qsi<0 || (isTileMatrixTemplated<qsi && isTileRowTemplated<qsi || isTileColTemplated<qsi)) {\n            //if the TM,TR,TC variables are templated but not as querystring parameters\n            // (ie, no '?' present or those params are before the '?'),\n            // then the URL must not be OGC WMTS, so no need for WMTS parameters\n\n        } else {\n            url = url + L.Util.getParamString(this.wmtsParams, url);\n            if(isTileMatrixTemplated<0)\n                url += \"&TileMatrix=\" + ident; //tileMatrixSet\n            if(isTileRowTemplated<0)\n                url += \"&TileRow=\" + tilerow;\n            if(isTileColTemplated<0)\n                url += \"&TileCol=\" + tilecol;\n        }\n\n        return url;\n    },\n\n    setParams: function (params, noRedraw) {\n        L.extend(this.wmtsParams, params);\n        if (!noRedraw) {\n            this.redraw();\n        }\n        return this;\n    },\n\n    getDefaultMatrix : function () {\n        /**\n         * the matrix3857 represents the projection\n         * for in the IGN WMTS for the google coordinates.\n         */\n        var matrixIds3857 = new Array(22);\n        for (var i= 0; i<22; i++) {\n            matrixIds3857[i]= {\n                identifier    : \"\" + i,\n                topLeftCorner : new L.LatLng(20037508.3428,-20037508.3428)\n            };\n        }\n        return matrixIds3857;\n    }\n});\n\n\n\n\nfunction wmts(layer) {\n\n    let url = layer.services && layer.services.length ? layer.services[0].href : null;\n\n    let options = {\n        layer: layer.layerName,\n        style: 'default',\n        tileMatrixSet: \"default\",\n        format: \"image/png\"\n    };\n    if(Config.leafletPane)\n        options.pane = Config.leafletPane;\n\n    let distro = (layer.distributions || []).find( dist => {\n        return dist.href && ( dist.mediaType==='image/png' || dist.mediaType==='image/jpeg' );\n    });\n    if(distro) {\n        url = distro.href;\n        options.format = distro.mediaType;\n\n        let params = distro.parameters || [];\n        params.each( param => {\n            let value = param.defaultValue || param.values && param.values.length && param.values[0];\n            if(value !== null && value !== undefined) {\n                url = url.replace('{' + param.name + '}', value);\n            }\n        });\n\n    }\n\n    if(!url) throw new Error(\"Unable to get URL for layer \" + layer.id);\n\n    return new WMTS( url, options );\n\n}\n\nif(L) {\n    L.TileLayer.WMTS = WMTS;\n    L.tileLayer.wmts = wmts;\n}\n\nexport {\n    WMTS as default,\n    WMTS,\n    wmts\n};\n","\n\nimport jQuery from \"jquery\";\nimport Q from \"q\";\nimport {Config} from 'geoplatform.client';\n\n\nvar esriTileLayer = !L || !L.TileLayer ? null : L.TileLayer.extend({\n\n    defaultESRIParams: {\n        layers:       '', //=show:0,1,2\n        transparent:  true,\n        format:       'png32',\n        // srs:          '4326',\n        // bboxsr:       '4326',\n        // bbox:         null,\n        // size:         '256,256',\n        f:            'image'\n        // imagesr:      '4326'\n    },\n\n    initialize: function (url, options) { // (String, Object)\n\n        if(url.indexOf(\"/export\") < 0) {\n            let qidx = url.indexOf(\"?\");\n            if(qidx > 0) {\n                url = url.substring(0, qidx) + '/export' + url.substring(qidx);\n            } else {\n                url += '/export';\n            }\n        }\n        this._url = url;\n\n        let esriParams = L.extend({}, this.defaultESRIParams),\n            tileSize = options.tileSize || this.options.tileSize;\n\n        let dim;\n        if (options.detectRetina && L.Browser.retina) {\n            dim = esriParams.height = tileSize * 2;\n        } else {\n            dim = esriParams.height = tileSize;\n        }\n        esriParams.size = dim + ',' + dim;\n\n        for (var i in options) {\n            // all keys that are not TileLayer options go to WMS params\n            if (!this.options.hasOwnProperty(i) && i !== 'crs') {\n                esriParams[i] = options[i];\n            }\n        }\n\n        //layer ids\n        // esriParams.layers = \"show:\" + esriParams.layers;\n\n        this.esriParams = esriParams;\n\n        L.setOptions(this, options);\n\n    },\n\n    onAdd: function (map) {\n        this._crs = this.options.crs || map.options.crs;\n        this.esriParams.srs = this.esriParams.imagesr = this.esriParams.bboxsr = this._crs.code;\n        L.TileLayer.prototype.onAdd.call(this, map);\n    },\n\n    getTileUrl: function (tilePoint) { // (Point, Number) -> String\n\n        let map = this._map,\n            tileSize = this.options.tileSize,\n\n        nwPoint = tilePoint.multiplyBy(tileSize),\n        sePoint = nwPoint.add([tileSize, tileSize]),\n\n        nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\n        se = this._crs.project(map.unproject(sePoint, tilePoint.z)),\n        bbox = [nw.x, se.y, se.x, nw.y].join(','),\n\n        url = L.Util.template(this._url, {s: this._getSubdomain(tilePoint)});\n\n        let params = L.extend({}, this.esriParams);\n        params.layers = \"show:\" + params.layers;\n\n        //convert to esri-special SR for spherical mercator\n        if(params.bboxsr === 'EPSG:3857')\n            params.bboxsr = '102100';\n        if(params.imagesr === 'EPSG:3857')\n            params.imagesr = '102100';\n\n        return url + L.Util.getParamString(params, url, true) + '&BBOX=' + bbox;\n    },\n\n    setParams: function (params, noRedraw) {\n        L.extend(this.esriParams, params);\n        if (!noRedraw) {\n            this.redraw();\n        }\n        return this;\n    }\n});\n\nif(L && L.TileLayer) {\n    L.TileLayer.ESRI = esriTileLayer;\n    L.tileLayer.esri = function (url, options) {\n        return new L.TileLayer.ESRI(url, options);\n    };\n}\n\n\nexport default esriTileLayer;\n","\n/**\n * @param {Object} layer - GeoPlatform Layer\n * @return {L.TileLayer}\n */\nfunction OSMLayerFactory(layer) {\n\n    if(!L || !L.TileLayer) throw new Error(\"Leaflet is not available\");\n\n    return new L.TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        minZoom: 1, maxZoom: 19,\n        attribution: 'Map data (c) <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors'\n    });\n}\n\nexport default OSMLayerFactory;\n","\nimport Q from \"q\";\nimport * as L from \"leaflet\";\nimport ServiceTypes from \"../service/types\";\nimport OSM from \"./osm\";\nimport FeatureLayer from './feature';\nimport {\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed\n} from './cluster-feature';\nimport {WMS, wms} from './wms';\nimport {WMST, wmst} from './wmst';\nimport {WMTS, wmts} from './wmts';\nimport ESRITileLayer from './L.TileLayer.ESRI';\nimport OSMLayerFactory from './osm-factory';\nimport { Config } from 'geoplatform.client';\n\n\n/**\n * @param {Object} layer - GeoPlatform Layer object\n * @return {L.Layer} Leaflet layer instance\n */\nvar LayerFactory = function(layer) {\n\n    if(!layer) {\n        throw new Error(`\n            L.GeoPlatform.LayerFactory() -\n            Invalid argument: must provide a layer object\n        `);\n    }\n\n    //OSM layers have no \"services\" so we have to treat them differently\n    if(OSM.test(layer)) {\n        return OSMLayerFactory();\n    }\n\n    if(!layer.services || !layer.services.length) {\n        throw new Error(`\n            L.GeoPlatform.LayerFactory() -\n            Cannot create Leaflet layer for GP Layer ${layer.id},\n            layer has no services defined!\n        `);\n    }\n\n    let service = layer.services[0],\n        url     = service.href,\n        typeUri = service.serviceType.uri,\n        srs     = layer.supportedCRS ? layer.supportedCRS[0] : null,\n        format  = layer.supportedFormats ? layer.supportedFormats[0] : null,\n        opts = {};\n\n\n    if(ServiceTypes.ESRI_MAP_SERVER &&\n        ServiceTypes.ESRI_MAP_SERVER.uri === typeUri) {\n        opts = {\n            layers: layer.layerName,\n            transparent: true,\n            format: format || \"png32\"\n        };\n        if(srs) opts.srs = srs;\n        if(Config.leafletPane)\n            opts.pane = Config.leafletPane;\n        return new ESRITileLayer(url, opts);\n\n    } else if(ServiceTypes.ESRI_FEATURE_SERVER &&\n        ServiceTypes.ESRI_FEATURE_SERVER.uri === typeUri) {\n        return clusteredFeatures(layer);\n\n    } else if(ServiceTypes.ESRI_TILE_SERVER &&\n        ServiceTypes.ESRI_TILE_SERVER.uri === typeUri) {\n        opts = { url: url, useCors: true };\n        if(Config.leafletPane)\n            opts.pane = Config.leafletPane;\n        return L.esri.tiledMapLayer(opts);\n\n    } else if(ServiceTypes.FEED && ServiceTypes.FEED.uri === typeUri) {\n        return geoJsonFeed(layer);\n\n    } else if(ServiceTypes.WMS && ServiceTypes.WMS.uri === typeUri) {\n        return wms(layer);\n\n    } else if(ServiceTypes.WMST && ServiceTypes.WMST.uri === typeUri) {\n        return wmst(layer);\n\n    } else if(ServiceTypes.WMTS && ServiceTypes.WMTS.uri === typeUri) {\n        return wmts(layer);\n\n    } else {\n        console.log(\"LayerFactory() - Could not create Leaflet layer for \" +\n            \"GeoPlatform Layer with service type: \" + typeUri);\n        return null;\n    }\n};\n\nexport default LayerFactory;\n","\n\nimport jQuery from \"jquery\";\nimport Q from \"q\";\nimport GeoPlatformClient from 'geoplatform.client';\n\nimport LayerFactory from '../layer/factory';\nimport OSM from \"../layer/osm\";\n\nconst ItemTypes = GeoPlatformClient.ItemTypes;\nconst ServiceFactory = GeoPlatformClient.ServiceFactory;\nconst HttpClient = GeoPlatformClient.JQueryHttpClient;\nconst Config = GeoPlatformClient.Config;\n\n\nclass Listener {\n\n    constructor() {\n        //listeners to be unregistered upon destroy\n        this._listeners = {};\n    }\n\n    on (type, listener) {\n        if(!this._listeners[type])\n            this._listeners[type] = [];\n        this._listeners[type].push(listener);\n    }\n\n    off (type, listener) {\n        if(!type) this._listeners = {};\n        if(!this._listeners[type]) return;\n        if(!listener) this._listeners[type] = [];\n        else {\n            var idx = this._listeners[type].indexOf(listener);\n            if(idx >= 0)\n                this._listeners[type].splice(idx, 1);\n        }\n    }\n\n    notify(type) {\n        if(!this._listeners[type]) return;\n        var args = Array.prototype.slice.call(arguments, 1);\n        this._listeners[type].each(function(l) { l.apply(null, args); });\n    }\n\n}\n\n\n\nclass MapInstance extends Listener {\n\n    constructor(key) {\n        super();\n\n        this.setHttpClient(new HttpClient());\n        this.setServiceFactory(ServiceFactory);\n\n        //generate random key (see factory below)\n        this._key = key || Math.ceil(Math.random()*9999);\n\n        //registry id of current map if available\n        this._mapId = null,\n\n        //definition of map (ie, from server)\n        this._mapDef = this.initializeMapDefinition(),\n\n        //primary map instance (ie, leaflet)\n        this._mapInstance = null,\n\n        //default map extent (if map doesn't have one for being saved)\n        this._defaultExtent = null,\n\n        //current base layer object and leaflet instance\n        this._baseLayerDef = null,\n        this._baseLayer = null,\n\n        //set definitions of layer states (including layer info) on map\n        this._layerStates = [],\n\n        //map layer def ids with leaflet instances\n        this._layerCache = {},\n\n        //errors generated by layers loading\n        this._layerErrors= [],\n\n        //layer used to store features on map\n        this._featureLayer = null,\n        this._featureLayerVisible = true,\n\n        //set of registered map tools\n        this._tools = [],\n\n        //state management\n        this.state = { dirty: false }; // jshint ignore:line\n\n\n        this._geoJsonLayerOpts = {\n            style: function(feature) {\n                if(feature.properties.style)\n                    return feature.properties.style;\n            },\n            onEachFeature: function(feature, layer) {\n\n                var style = { weight: 2, color: '#03f', opacity: 0.9, radius: 4, fillColor: '#03f', fillOpacity: 0.5 };\n                if(~feature.geometry.type.indexOf('Point')) {\n                    style.fillOpacity = 0.9;\n                }\n\n                var props = feature.properties = feature.properties || {};\n                feature.properties.id = Math.floor(Math.random()*999999);\n                feature.properties.label = props.label || props.title || props.name || \"Untitled \" + feature.geometry.type + \" Feature\";\n                feature.properties.description = props.description || props.desc || \"This feature needs a description!\";\n                feature.properties.style = props.style || style;\n\n                layer.bindTooltip(props.label);\n                /*\n                toggle: setLabelNoHide(bool)\n                it may only exist on markers!\n                */\n            },\n            pointToLayer: function (feature, latlng) {\n\n                var style = feature.properties.style || {};\n                style.radius = style.radius || 4;\n                style.weight = style.weight || 2;\n                style.color = style.color || '#03f';\n                style.opacity = style.opacity || 0.9;\n                style.fillOpacity = style.opacity;\n                style.fillColor = style.color;\n\n                if(!L) {\n                    throw new Error(\"Leaflet is not available\");\n                }\n                return L.circleMarker(latlng, style);\n            }\n        };\n\n    }\n\n    dispose () {\n        this.destroyMap();\n        this.svcCache = null;\n        this.serviceFactory = null;\n        this.httpClient = null;\n        this._key = null;\n        this._mapId = null;\n        this._mapDef = null;\n        this._mapInstance = null;\n        this._defaultExtent = null;\n        this._baseLayerDef = null;\n        this._baseLayer = null;\n        this._layerStates = null;\n        this._layerCache = null;\n        this._layerErrors= null;\n        this._featureLayer = null;\n        this._featureLayerVisible = true;\n        this._tools = null;\n        this.state = null;\n        this._geoJsonLayerOpts = null;\n    }\n\n\n    getKey () {\n        return this._key;\n    }\n\n    /**\n     * Override default (JQuery-based) map service used by this instance\n     * @param {ItemService} mapService - service to use to CRUD map objects\n     * @deprecated use setServiceFactory instead\n     */\n    setService(mapService) {\n        // this.mapService = mapService;\n    }\n\n    /**\n     * @param {ServiceFactory} factory - GeoPlatform ServiceFactory to instantiate services for maps and layers\n     */\n    setServiceFactory(factory) {\n        this.svcCache = {}; //wipe out cached services\n        this.serviceFactory = factory;\n    }\n\n    /**\n     * @param {HttpClient} httpClient - HttpClient impl to use with the new factory\n     */\n    setHttpClient(httpClient) {\n        this.svcCache = {}; //wipe out cached services\n        this.httpClient = httpClient;\n    }\n\n    /**\n     * @param {string} type - GeoPlatform Object model type to support (\"Map\", \"Layer\", etc)\n     * @return {ItemService} item service implementation for the requested type\n     */\n    getService(type) {\n        if(!this.svcCache[type])\n            this.svcCache[type] = this.serviceFactory(type, Config.ualUrl, this.httpClient);\n        return this.svcCache[type];\n    }\n\n\n    //-----------------\n    getLayerStateIndex (layerId) {\n        if(!layerId) return -1;\n        for(let i=0; i<this._layerStates.length; ++i) {\n            if(this._layerStates[i].layer && layerId === this._layerStates[i].layer.id) {\n                return i;\n            }\n        }\n        return -1;\n        // return this._layerStates.indexOfObj(layerId, (id, state) => state.layer.id === id );\n    }\n\n    getLayerState (layerId) {\n        let index = this.getLayerStateIndex(layerId);\n        return index >= 0 ? this._layerStates[index] : null;\n    }\n    //-----------------\n\n\n    initializeMapDefinition() {\n        return {\n            type: ItemTypes.MAP,\n            title: \"My New Map\",\n            label: \"My New Map\",\n            description: \"This map needs a description\",\n            createdBy: null,\n            baseLayer: this._baseLayerDef,\n            layers: [],\n            keywords: [],\n            themes: [],\n            resourceTypes: ['http://www.geoplatform.gov/ont/openmap/GeoplatformMap']\n        };\n    }\n\n    /**\n     * @param metadata object\n     * @return object definition of the current map suitable for sending to WMVR\n     */\n    getMapResourceContent(metadata) {\n\n        metadata = metadata || {};\n\n        //map layers\n        metadata.layers = this._layerStates.slice(0);\n        // ... UAL should support accepting just an id here, so we'll do just that\n        metadata.baseLayer = this._baseLayerDef;\n\n        metadata.annotations = this._featureLayer ?\n            { title: \"Map Features\", geoJSON: this._featureLayer.toGeoJSON() } : null;\n\n        //geographic extent\n        let extent = this._mapInstance.getBounds();\n        metadata.extent = {\n            minx: extent.getWest(),\n            miny: extent.getSouth(),\n            maxx: extent.getEast(),\n            maxy: extent.getNorth()\n        };\n\n        return metadata;\n    }\n\n    /**\n     * @return Leaflet toolbar\n     */\n    getDrawControlToolbar() {\n        if(!this._mapInstance.drawControl) return null;\n        var toolbars = this._mapInstance.drawControl._toolbars;\n        var toolbar = null;\n        for(var key in toolbars) {\n            if(toolbars.hasOwnProperty(key)) {\n                if(toolbars[key]._modes) {\n                    toolbar = toolbars[key];\n                    break;\n                }\n            }\n        }\n        return toolbar;\n    }\n\n    /**\n     * @param error Leaflet tile load error (.target is layer, .tile is image)\n     */\n    handleLayerError(error) {\n        var layer = error.target;\n        for(var id in this._layerCache) {\n            if(this._layerCache[id] === layer) {\n                this.processLayerError(error, id);\n                break;\n            }\n        }\n    }\n\n    /**\n     * Given a Leaflet tile load error and the responsible layer id,\n     * Try to isolate the cause of the error using the proxy\n     * and notify listeners that an error has occurred\n     */\n    processLayerError(error, id) {\n\n        var finder = function(l){return l.id === id;};\n\n        if(!this._layerErrors.find(finder)) {\n\n            // console.log(\"Logging error for layer \"  + id);\n            var obj = {\n                id: id,\n                message: \"Layer failed to completely load. \" +\n                    \"It may be inaccessible or misconfigured.\"\n            };\n            this._layerErrors.push(obj);\n\n            var url = error.tile.src;\n            var params = {id:id};\n            url.substring(url.indexOf(\"?\")+1, url.length).split('&').each(function(param) {\n                var p = param.split('=');\n                params[p[0]] = p[1];\n            });\n\n            this.layerService.validate(id, params)\n            .catch(e => {\n                var def = this._layerStates.find(finder);\n                obj.message = \"Layer '\" + def.label + \"' failed to completely load. \" +\n                        \"It may be inaccessible or misconfigured. Reported cause: \" + e.message;\n                this.notify('layer:error', obj);\n            });\n        }\n    }\n\n\n    /* -- State Management of internal model -- */\n\n    touch (event) {\n        this.state.dirty = true;\n        if(event) {\n            if(arguments.length > 1) {\n                this.notify.apply(this, Array.prototype.slice.call(arguments));\n            } else\n                this.notify(event);\n            // console.log(\"Dirtying map for \" + event);\n        }\n        // else console.log(\"Dirtying map\");\n    }\n    clean() {\n        // console.log(\"Cleaning map\");\n        this.state.dirty = false;\n    }\n    /* --------------------------------------- */\n\n\n\n\n    /* ==============================================\n        Map manipulation operations\n       ============================================== */\n\n    setMap (map) {\n        this._mapInstance = map;\n    }\n\n    /**\n     * @return {L.Map} map instance\n     */\n    getMap () { return this._mapInstance; }\n\n    /** @return {object} definition of map */\n    getMapDefinition () { return this._mapDef; }\n\n    /** @return {string} identifier of map */\n    getMapId () { return this._mapId; }\n\n    /**\n     * Focuses the map on the specified lat/lng coordinate\n     * @param lat number\n     * @param lng number\n     * @param zoom number (optional)\n     */\n    setView (lat, lng, zoom) {\n        let z = zoom;\n        if(typeof(z) === 'undefined')\n            z = this._mapInstance.getZoom();\n        this._mapInstance.setView([lat,lng], z);\n        this.touch('map:view:changed');\n    }\n\n    /**\n     * Retrieve the current center of the map\n     * @return [lat,lng]\n     */\n    getView () {\n        var latLng = this._mapInstance.getCenter();\n        return [latLng.lat, latLng.lng];\n    }\n\n    /**\n     * @return integer current zoom level of the map\n     */\n    getZoom () {\n        return this._mapInstance.getZoom();\n    }\n\n    /**\n     * Zoom to the map's default extent\n     * If the map is saved, this will be the saved viewport\n     * otherwise, it will be CONUS\n     */\n    zoomToDefault () {\n        if(!this._mapInstance) return;\n        if(this._defaultExtent) {\n            this._mapInstance.fitBounds([\n                [this._defaultExtent.miny, this._defaultExtent.minx],\n                [this._defaultExtent.maxy, this._defaultExtent.maxx]\n            ]);\n        } else {\n            console.log(\"MapInstance.zoomToDefault() - No default extent specified\");\n            this._mapInstance.setView([38, -96], 5);\n        }\n        try {\n            this.touch('map:view:changed');\n        } catch(e) { }\n    }\n\n    /**\n     * @param {Object} extent - either a GP extent object or Leaflet LatLngBounds object\n     */\n    setExtent(extent) {\n        if(!extent) return;\n        if( typeof(extent.minx) !== 'undefined' &&\n            typeof(extent.miny) !== 'undefined' &&\n            typeof(extent.maxx) !== 'undefined' &&\n            typeof(extent.maxy) !== 'undefined' ) {\n            //GP model extent\n            this._mapInstance.fitBounds([\n                [extent.miny, extent.minx],\n                [extent.maxy, extent.maxx]\n            ]);\n        } else if(typeof(extent.getWest) !== 'undefined') {\n            //L.LatLngBounds\n            this._mapInstance.fitBounds(extent);\n        } else {\n\n        }\n    }\n\n\n    /* ==============================================\n        Layer operations\n       ============================================== */\n\n\n    /**\n     * @param layer Leaflet Layer instance or object definition\n     */\n    setBaseLayer (layer) {\n\n        let promise = null;\n        if(!layer) {\n            promise = OSM.get();\n        } else\n            promise = Q.resolve(layer);\n\n        promise.then( layer => {\n\n            let leafletLayer = LayerFactory(layer);\n            if(!leafletLayer) return;\n\n            this._mapInstance.addLayer(leafletLayer);\n            leafletLayer.setZIndex(0);  //set at bottom\n\n            let oldBaseLayer = this._baseLayer;\n            if(oldBaseLayer) {\n                this._mapInstance.removeLayer(oldBaseLayer);\n            }\n\n            //remember new base layer\n            this._baseLayer = leafletLayer;\n            this._baseLayerDef = layer;\n            this.touch('baselayer:changed', layer);\n\n        })\n        .catch(e => {\n            console.log(`MapInstance.setBaseLayer() - Error getting base layer for map : ${e.message}`);\n            this._layerErrors.push({id:layer.id, message: e.message});\n        });\n    }\n\n    /**\n     * @return array of base layers definitions that can be used\n     */\n    // getBaseLayerOptions () {\n    //     return this._baseLayerOptions;\n    // },\n\n    getBaseLayer () { return this._baseLayerDef; }\n\n    /**\n     * @return {array[object]} list of layer states containing layer information\n     */\n    getLayers () { return this._layerStates; }\n\n    getLayerErrors () { return this._layerErrors; }\n\n    clearLayerErrors () {\n        this._layerErrors = [];\n        this.notify('layer:error');\n    }\n\n    clearOverlays () {\n        for(var i=this._layerStates.length-1; i>=0; --i) {\n            var state = this._layerStates[i];\n            var layerInstance = this._layerCache[state.layer.id];\n            if(layerInstance) {\n                layerInstance.off(\"layer:error\");\n                this._layerCache[state.layer.id] = null;\n                this._mapInstance.removeLayer(layerInstance);\n            }\n        }\n        this._layerStates = [];\n        this.touch('layers:changed');\n\n        //TODO stop listening for layer events\n    }\n\n    /**\n     * @param {array[object]} layers - list of layers (NOTE: not wrapped by layer states, this method applies that)\n     */\n    addLayers (layers) {\n\n        layers.each( (obj,index) => {\n\n            let layer = null, state = null;\n\n            if(obj.id) {            //is a layer\n                layer = obj;\n            } else if(obj.layer) {  //is layer state\n                layer = obj.layer;  // containing a layer\n                state = obj;\n            }\n\n            if(!layer) return;  //layer info is missing, skip it\n\n            //DT-442 prevent adding layer that already exists on map\n            if(this._layerCache[layer.id]) return;\n\n            if(!state) {\n                state = {\n                    opacity: 1,\n                    visibility: true,\n                    layer: JSON.parse(JSON.stringify(layer))\n                };\n            }\n\n            let z = layers.length - index;\n            state.zIndex = z;\n\n            this.addLayerWithState(layer, state);\n\n        });\n\n        this.touch('layers:changed');\n    }\n\n    /**\n     * @param {Object} layer - GeoPlatform Layer instance\n     * @param {Object} state - GeoPlatform Layer State\n     */\n    addLayerWithState(layer, state) {\n\n        var leafletLayer = null;\n        try {\n            if(!layer || !state)\n                throw new Error(\"Invalid argument, missing layer and or state\");\n\n            leafletLayer = LayerFactory(layer);\n\n            if(!leafletLayer)\n                throw new Error(\"Layer factory returned nothing\");\n\n        } catch(e) {\n            this._layerErrors.push({\n                id:layer.id,\n                message: 'MapInstance.addLayerWithState() - ' +\n                    'Could not create a Leaflet layer: ' + e.message\n            });\n        }\n\n        if(!leafletLayer) return;\n\n        //listen for layer errors so we can inform the user\n        // that a layer hasn't been loaded in a useful way\n        leafletLayer.on('tileerror', this.handleLayerError);\n\n        this._layerCache[layer.id] = leafletLayer;\n        this._mapInstance.addLayer(leafletLayer);\n\n        if( !isNaN(state.zIndex) && leafletLayer.setZIndex )\n            leafletLayer.setZIndex(state.zIndex);\n\n        this._layerStates.push(state);\n\n\n        // if layer is initially \"off\" or...\n        // if layer is initially not 100% opaque\n        if(!state.visibility || state.opacity < 1) {\n            // initialize layer visibility and opacity async, or else\n            // some of the layers won't get properly initialized\n            setTimeout( (layer, state) => {\n                this.setLayerVisibility(layer, state.visibility);\n                this.setLayerOpacity(layer, state.opacity);\n                //TODO notify of change\n            }, 500, leafletLayer, state);\n        }\n    }\n\n    /**\n     * @param {integer} from - position of layer being moved\n     * @param {integer} to - desired position to move layer to\n     */\n    moveLayer (from, to) {\n\n        if(isNaN(from)) return;\n\n        //end of list\n        if(isNaN(to)) to = this._layerStates.length-1;\n\n        let copy = this._layerStates.splice(from, 1)[0];    //grab layer being moved\n        this._layerStates.splice(to, 0, copy);\n\n        for(let z=1, i=this._layerStates.length-1; i>=0; --i,++z) {\n            let layerState = this._layerStates[i];\n            let layerInstance = this._layerCache[ layerState.layer.id ];\n            if(layerInstance) {\n                layerInstance.setZIndex(z);\n                layerState.zIndex = z;\n            }\n        }\n\n        this.touch('layers:changed', this.getLayers());\n    }\n\n    /**\n     *\n     */\n    removeLayer (id) {\n\n        var layerInstance = this._layerCache[id];\n        if(layerInstance) {\n\n            //remove layer from tracked defs array\n            let index = this.getLayerStateIndex(id);\n            this._layerStates.splice(index, 1);\n\n            //stop listening for errors\n            layerInstance.off(\"layer:error\");\n\n            //remove layer from map\n            this._mapInstance.removeLayer(layerInstance);\n\n            //remove layer from cache\n            this._layerCache[id] = null;\n        }\n        this.touch('layers:changed');\n    }\n\n    /**\n     *\n     */\n    toggleLayerVisibility (id) {\n        var layerInstance = this._layerCache[id];\n        if(layerInstance) {\n            let state = this.getLayerState(id);\n            state.visibility = !state.visibility;\n\n            if(layerInstance._currentImage) {\n                //ESRI Image Service layers have an IMG element\n                // that gets modified and replaced every map event (zoom/pan)\n                // so we can't just toggle classes like on other layers.\n                //Instead, we need to use the ESRI setOpacity method to toggle\n                // but need to update layer state as well.\n                layerInstance.setOpacity(state.visibility ? 1 : 0);\n                state.opacity = layerInstance.getOpacity();\n                return;\n            }\n\n            this.setLayerVisibility(layerInstance, state.visibility);\n        }\n    }\n\n    /**\n     * Note: this does not update layer definition state. Use\n     * MapInstance.toggleLayerVisibility to do that and adjust\n     * rendered layer's visibility.\n     *\n     * @param {L.Layer} layerInstance - leaflet layer instance\n     * @param {boolean} visible - flag indicating visibility of layer\n     */\n    setLayerVisibility (layerInstance, visible) {\n\n        if(layerInstance.setVisibility) {\n            //using custom method provided in src/layer/module.js\n            layerInstance.setVisibility(visible);\n\n        } else if(layerInstance._container) {\n            //otherwise, using jquery on dom directly\n            let el = jQuery(layerInstance._container);\n            if(visible) el.removeClass(\"invisible\");\n            else el.addClass('invisible');\n\n        }\n\n        this.touch('map:layer:changed');\n    }\n\n    /**\n     *\n     */\n    updateLayerOpacity (id, opacity) {\n\n        var layerInstance = this._layerCache[id];\n\n        //if layer id is for base layer...\n        if(!layerInstance && this._baseLayerDef.id === id) {\n            layerInstance = this._baseLayer;\n        }\n\n        //adjust rendered leaflet layer\n        opacity = this.setLayerOpacity(layerInstance, opacity);\n\n        // if overlay layer, update state value\n        let state = this.getLayerState(id);\n        if(state) state.opacity = opacity;\n\n    }\n\n    /**\n     * Note: this method does not update the associated Layer Definition\n     * state value for opacity. Use MapInstance.updateLayerOpacity() to\n     * both update state and adjust rendered layer.\n     *\n     * @param {L.Layer} layerInstance - leaflet layer instance\n     * @param {number} opacity - value between 0 and 1.0 or 0 and 100\n     * @return {number} normalized opacity value between 0 and 1.0\n     */\n    setLayerOpacity (layerInstance, opacity) {\n        if(layerInstance && layerInstance.setOpacity) {\n            if(opacity > 1.0) opacity = opacity / 100.0;\n            layerInstance.setOpacity(opacity);\n            this.touch('map:layer:changed');\n        }\n        return opacity;\n    }\n\n    /**\n     * @param {Object} GeoPlatform Layer instance\n     * @return {L.Layer} Leaflet layer instance representing that layer or null\n     */\n    getLeafletLayerFor (gpLayer) {\n        if(!gpLayer) return null;\n        let leafletLayer = this._layerCache[gpLayer.id];\n        return leafletLayer || null;\n    }\n\n    /**\n     *\n     */\n    toggleGetFeatureInfo (layerId) {\n        var layerInstance = this._layerCache[layerId];\n        if(layerInstance) {\n            if(typeof(layerInstance.enableGetFeatureInfo) !== 'undefined') {\n                if(layerInstance.isGetFeatureInfoEnabled()) {\n                    layerInstance.disableGetFeatureInfo();\n                    jQuery(_mapInstance._container).removeClass('selectable-cursor');\n                } else {\n                    layerInstance.enableGetFeatureInfo();\n                    jQuery(_mapInstance._container).addClass('selectable-cursor');\n                }\n            }\n\n        }\n    }\n\n\n    /* ==============================================\n       Feature operations\n       ============================================== */\n\n\n    /**\n     * @return array of features on the map\n     */\n    getFeatures () {\n        if(this._featureLayer) {\n            return this._featureLayer.toGeoJSON().features;\n        }\n        return [];\n    }\n\n    /**\n     * @param json geojson object or array of geojson objects\n     */\n    addFeatures (json) {\n\n        if(!json) return;\n\n        if(typeof(json.push) !== 'undefined') {\n            //array of features\n            for(var i=0; i<json.length; ++i)\n                this.addFeature(json[i], false);\n            this.touch('features:changed');\n\n        } else if(json.features) {\n            this.addFeatures(json.features);\n\n        } else { //single feature\n            this.addFeature(json, true);\n        }\n\n    }\n\n    /**\n     * @param json geojson object\n     */\n    addFeature (json, fireEvent) {\n        // var type = json.type;\n        // var coordinates = json.coordinates;\n\n        if(!L) {\n            throw new Error(\"Leaflet is not available\");\n        }\n\n        if(!this._featureLayer) {\n\n            // _featureLayer = L.geoJson([], _geoJsonLayerOpts).addTo(_mapInstance);\n            this._featureLayer = L.featureGroup().addTo(this._mapInstance);\n\n        }\n\n        // _featureLayer.addData(json);\n        var opts = jQuery.extend({}, this._geoJsonLayerOpts);\n        L.geoJson(json, opts).eachLayer((l)=>this.addFeatureLayer(l));\n\n        if(typeof(fireEvent) === 'undefined' || fireEvent === true)\n            this.touch('features:changed');\n        else this.touch();\n\n        // console.log(JSON.stringify(_featureLayer.toGeoJSON()));\n\n    }\n\n    /**\n     * @param featureJson object defining a GeoJSON feature\n     */\n    updateFeature (featureJson) {\n        var layer = this.getFeatureLayer(featureJson.properties.id);\n        if(layer) {\n\n            layer.feature = featureJson;\n\n            //update style\n            layer.setStyle(featureJson.properties.style);\n\n            //rebind label in case that changed\n            var label = featureJson.properties.label ||\n                \"Untitled \" + featureJson.geometry.type + \" Feature\";\n            layer.bindTooltip(label);\n\n            // layer.redraw();\n            this.touch(\"map:feature:changed\");\n        }\n    }\n\n    /**\n     * Replace an existing L.Path-based layer with one using\n     * the supplied Feature GeoJSON object.  Removes the existing\n     * layer and adds a new one created from the GeoJSON.\n     *\n     * @param featureJson object defining GeoJSON feature\n     */\n    replaceFeature (featureJson) {\n\n        if(!L) {\n            throw new Error(\"Leaflet is not available\");\n        }\n\n        //find existing layer for this feature\n        var layer = this.getFeatureLayer(featureJson.properties.id);\n        if(layer) {\n\n            //remove existing\n            this._featureLayer.removeLayer(layer);\n\n            //add replacement\n            L.geoJson(featureJson, this._geoJsonLayerOpts)\n                .eachLayer((l)=>this.addFeatureLayer(l));\n\n            this.touch(\"map:feature:changed\");\n        }\n    }\n\n    /**\n     * @param featureId identifier of feature to focus the map on\n     */\n    focusFeature (featureId) {\n        var layer = this.getFeatureLayer(featureId);\n        if(layer) {\n            if( typeof(layer.getBounds) !== 'undefined') {\n                let extent = layer.getBounds();\n                this._mapInstance.fitBounds(extent);\n            } else if(typeof(layer.getLatLng) !== 'undefined') {\n                let latLng = layer.getLatLng();\n                this._mapInstance.panTo(latLng);\n            } else {\n                console.log(\"MapInstance.focusFeature() - Cannot focus feature because it has no bounds or lat/lng\");\n            }\n        } else {\n            console.log(\"MapInstance.focusFeature() - Cannot focus feature because it has no layer\");\n        }\n    }\n\n    /**\n     * @param\n     */\n    removeFeature (featureId) {\n        var layer = this.getFeatureLayer(featureId);\n        if(layer && this._featureLayer) {\n            this._featureLayer.removeLayer(layer);\n            this.touch('features:changed');\n        }\n    }\n\n    /**\n     *\n     */\n    removeFeatures () {\n        if(this._featureLayer) {\n            this._featureLayer.clearLayers();\n            this.touch(\"features:changed\");\n        }\n    }\n\n    /**\n     *\n     */\n    getFeatureLayer (featureId) {\n        if(!this._featureLayer) return null;\n\n        var features = this._featureLayer.getLayers();\n        for(var i=0; i<features.length; ++i) {\n            if(features[i].feature.properties.id === featureId) {\n                return features[i];\n            }\n        }\n        return null;\n    }\n\n    toggleFeaturesLayer () {\n        if(!this._featureLayer) return false;    //ignore if not rendered yet\n\n        this._featureLayerVisible = !this._featureLayerVisible;\n        this.setFeatureLayerVisibility(this._featureLayer, this._featureLayerVisible);\n        return this._featureLayerVisible;\n    }\n\n    /**\n     * @param {L.Feature} feature - Leaflet feature instance\n     * @param {boolean} visibility - flag\n     */\n    setFeatureVisibility (feature, visibility) {\n        this.setFeatureLayerVisibility(feature, visibility);\n    }\n\n    getFeaturesLayerVisibility () {\n        return this._featureLayerVisible;\n    }\n\n\n    /*\n     * method for adding feature layers to the map\n     * when these layers may be layer groups.\n     * finds leaf node layers and adds them to the\n     * map's feature group\n     */\n    addFeatureLayer(layer) {\n        this._addFeatureLayer(layer);\n        this.touch(\"features:changed\");\n    }\n\n    /**\n     * Internal method, use 'addFeatureLayer' instead\n     * @param {Object} layer\n     */\n    _addFeatureLayer(layer) {\n        if(!L) {\n            throw new Error(\"Leaflet is not available\");\n        }\n        if(!layer.feature && layer instanceof L.LayerGroup) {\n            layer.eachLayer( (child) => {\n                this._addFeatureLayer(child);\n            });\n        } else {\n            this._featureLayer.addLayer(layer);\n        }\n    }\n\n\n    //toggle visibility of parent feature layer\n    setFeatureLayerVisibility(layer, visibility) {\n        if(!layer) return;\n        this._featureLayerVisible = visibility;\n\n        if(layer.getLayers) {\n            layer.getLayers().each( (child) => {\n                this.setFeatureLayerVisibility(child, visibility);\n            });\n\n        } else {\n            let container = layer._container || layer._path;\n            if(container)\n                container.style.display = visibility ? '' : 'none';\n        }\n    }\n\n\n\n    /* ==============================================\n       Map lifecycle operations\n       ============================================== */\n\n    /**\n     * @param {Object} metadata\n     * @return {Promise} resolving persisted map\n     */\n    save (metadata) {\n        return this.saveMap(metadata);\n    }\n\n    /**\n     * @param md object containing metadata properties for map\n     */\n    saveMap (md) {\n\n        let metadata = md || {};\n\n        //add GeoPlatformMap resource type if not already present\n        const gpMapType = 'http://www.geoplatform.gov/ont/openmap/GeoplatformMap';\n        metadata.resourceTypes = metadata.resourceTypes || [];\n        if(metadata.resourceTypes.indexOf(gpMapType) < 0)\n            metadata.resourceTypes.push(gpMapType);\n\n        var content = this.getMapResourceContent(metadata);\n\n        //ensure the two name properties line up\n        if(content.title && content.title !== content.label) {\n            content.label = content.title;\n        } else if(content.label && !content.title) {\n            content.title = content.label;\n        }\n\n        // console.log(\"Updating: \" + JSON.stringify(map));\n        return this.getService(ItemTypes.MAP)\n        .save(content)\n        .then( result => {\n\n            //track new map's info so we can update it with next save\n            if(!this._mapId)\n                this._mapId = result.id;\n\n            this._mapDef = result;\n            this._defaultExtent = result.extent;\n            this.clean();\n            return result;\n        })\n        .catch(err=>{\n            let e = new Error(\"MapInstance.saveMap() - \" +\n                \"The requested map could not be saved because: \" +\n                err.message);\n            return Q.reject(e);\n        });\n\n    }\n\n    /**\n     * Retrieve a map's descriptor from the registry\n     * @param {string} mapId identifier of map\n     * @return {Promise} resolving the map object\n     */\n    fetchMap (mapId) {\n        //Having to send cache busting parameter to avoid CORS header cache\n        // not sending correct Origin value\n        return this.getService(ItemTypes.MAP).get(mapId);\n    }\n\n    /**\n     * Retrieve a map's descriptor and load it as the\n     * current map managed by this service\n     * @param {string} mapId identifier of map\n     * @return {Promise} resolving the map object\n     */\n    loadMap (mapId) {\n\n        return this.fetchMap(mapId).then(map => {\n\n            if(!map) {\n                throw new Error(\"The requested map came back null\");\n\n            } else if(typeof(map) === 'string') {\n                throw new Error(\"The requested map came back as a string\");\n\n            } else if(map.message) {\n                throw new Error(\"There was an error loading the requested map: \" + map.message);\n            }\n\n\n            //loading a map by its ID, so we need to increment it's view count\n            if('development' !== Config.env) {\n\n                setTimeout( (map) => {\n                    //update view count\n                    let views = map.statistics ? (map.statistics.numViews||0) : 0;\n                    let patch = [ { op: 'replace', path: '/statistics/numViews', value: views+1 } ];\n                    this.getService(ItemTypes.MAP).patch(map.id, patch)\n                    // this.mapService.patch(map.id, patch)\n                    .then( updated => { map.statistics = updated.statistics; })\n                    .catch( e => { console.log(\"Error updating view count for map: \" + e); });\n                }, 1000, map);\n\n            }\n\n            //load the map into the viewer\n            this.loadMapFromObj(map);\n\n            return map;\n        })\n        .catch( err => {\n            let e = new Error(\"MapInstance.loadMap() - \" +\n                \"The requested map could not be loaded because \" + err.message);\n            return Q.reject(e);\n        });\n    }\n\n    /**\n     * Load a map from its descriptor as the current\n     * map managed by this service\n     * @param map object\n     */\n    loadMapFromObj (map) {\n\n        // console.log(map);\n\n        this._mapId = map.id;\n        this._mapDef = map;\n\n        //ensure x,y is ordered correctly\n        var t;\n        t = Math.min(map.extent.minx, map.extent.maxx);\n            map.extent.maxx = Math.max(map.extent.minx, map.extent.maxx);\n            map.extent.minx = t;\n        t = Math.min(map.extent.miny, map.extent.maxy);\n            map.extent.maxy = Math.max(map.extent.miny, map.extent.maxy);\n            map.extent.miny = t;\n\n        //prevent out-of-bounds extents\n        if(map.extent.minx < -180.0) map.extent.minx = -179.0;\n        if(map.extent.maxx > 180.0) map.extent.maxx = 179.0;\n        if(map.extent.miny < -90.0) map.extent.miny = -89.0;\n        if(map.extent.maxy > 90.0) map.extent.maxy = 89.0;\n\n        //set extent from loaded map\n        this._defaultExtent = map.extent;\n        var extent = map.extent;\n\n        //remove existing layers\n        this._mapInstance.eachLayer((l) => {\n            this._mapInstance.removeLayer(l);\n        });\n        this._layerCache = {};\n        this._layerStates = [];\n\n        //set new base layer\n        this.setBaseLayer(map.baseLayer);\n\n        //add layers from loaded map\n        this.addLayers(map.layers);\n\n        //add features\n        if(map.annotations && map.annotations.geoJSON) {\n            let fc = map.annotations.geoJSON;\n            if(fc.features)\n                this.addFeatures(fc.features);\n            else\n                this.addFeatures([fc]);\n        }\n\n        this._mapInstance.fitBounds([\n            [extent.miny, extent.minx],\n            [extent.maxy, extent.maxx]\n        ]);\n\n        this.clean();\n        this.notify('map:loaded', map);\n\n    }\n\n\n    /**\n     *\n     */\n    destroyMap () {\n        this._mapInstance = null;\n        this._layerCache = null;\n        this._layerStates = null;\n        this._featureLayer = null;\n    }\n\n    /**\n     * Used to take an existing map that is already persisted on the\n     * server and unlink it here in the client so that it will be saved\n     * as a completely new map when mapService.saveMap(...) is next called\n     */\n    setAsNewMap (mapToUse) {\n        this._mapId = null;\n        this._mapDef = mapToUse || this.initializeMapDefinition();\n    }\n\n\n    /* ==============================================\n        Tool operations\n       ============================================== */\n\n    registerTool (id, tool) {\n        this._tools[id] = tool;\n    }\n\n    unregisterTool (id) {\n        this._tools[id] = null;\n    }\n\n    enableTool (id, finish) {\n        if(!this._tools[id]) return false;\n        this._tools[id].activate(function() {\n            this.notify('tool:disabled', id);\n        });\n        this.notify('tool:enabled', id);\n    }\n\n\n    /* ----------- MISC ------------ */\n\n    //https://github.com/gsklee/ngStorage\n    cacheMap () {\n\n        if(state.dirty) {\n            var map = this.getMapResourceContent();\n            //use exploded layer info\n            map.layers = this._layerStates.slice(0);\n            // $sessionStorage.map = map;\n        }\n    }\n\n    restoreMap () {\n        // if($sessionStorage.map) {\n        //     console.log(\"Restoring cached map\");\n        //     let map = $sessionStorage.map;\n        //     // console.log(JSON.stringify(map));\n        //     $sessionStorage.map = null;\n        //     this.loadMapFromObj(map);\n        // }\n    }\n    /* ---------------------------- */\n}\n\nexport default MapInstance;\n","\nimport MapInstance from './instance';\n\nvar cache = {};\n\nexport default {\n\n    get: function(key) {\n        if(key && cache[key])\n            return cache[key];\n\n        let instance = new MapInstance(key);\n        cache[instance._key] = instance;\n        return instance;\n    },\n\n    dispose: function(key) {\n        if(key) {\n            cache[key].destroyMap();\n            delete cache[key];\n        } else {\n            cache = null;\n        }\n    }\n};\n","\nimport LoadingControl from './control/L.Control.Loading';\nimport MeasureControl from './control/L.Control.MeasureControl';\nimport MousePositionControl from './control/L.Control.MousePosition';\n\nimport DefaultBaseLayer from './layer/baselayer-default';\nimport LayerFactory from './layer/factory';\nimport OSMLayerFactory from './layer/osm-factory';\nimport ESRIClusterFeatureLayer from './layer/L.esri.Cluster.FeatureLayer';\nimport {\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed\n} from './layer/cluster-feature';\nimport FeatureLayer from './layer/feature';\nimport {WMS, wms} from './layer/wms';\nimport {WMST, wmst} from './layer/wmst';\nimport {WMTS, wmts} from './layer/wmts';\nimport ESRITileLayer from './layer/L.TileLayer.ESRI';\nimport OSM from './layer/osm';\n\nimport MapInstance from './map/instance';\nimport MapFactory from './map/factory';\n\nimport ServiceTypes from './service/types';\n\nimport PopupTemplate from './shared/popup-template';\nimport StyleResolver from './shared/style-resolver';\n\n\n\nif(typeof(Array.prototype.each) === 'undefined') {\n    Array.prototype.each = function(fn) {\n        let arr = this, len = arr.length;\n        for(let i=0; i<len; ++i) {\n            try {\n                fn(arr[i]);\n            } catch(e) { }\n        }\n    };\n}\n\n\n\n\n\nexport default {\n    LoadingControl,\n    MeasureControl,\n    MousePositionControl,\n    DefaultBaseLayer,\n    LayerFactory,\n    OSMLayerFactory,\n    ESRIClusterFeatureLayer,\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed,\n    FeatureLayer,\n    WMS,\n    wms,\n    WMST,\n    wmst,\n    WMTS,\n    wmts,\n    ESRITileLayer,\n    OSM,\n    MapInstance,\n    MapFactory,\n    ServiceTypes,\n    PopupTemplate,\n    StyleResolver\n};\n"],"names":["loadingControl","L","Control","extend","options","position","separate","zoomControl","spinjs","spin","lines","length","width","radius","rotate","top","initialize","setOptions","_dataLoaders","onAdd","map","Spinner","console","error","_addLayerListeners","_addMapListeners","zoomsliderControl","classes","container","_container","DomUtil","create","_indicator","_spinner","appendChild","el","onRemove","_removeLayerListeners","_removeMapListeners","removeFrom","removeChild","_map","prototype","call","addLoader","id","updateIndicator","removeLoader","isLoading","_showIndicator","_hideIndicator","_countLoaders","size","key","hasOwnProperty","addClass","Zoom","removeClass","_zoomOutButton","Zoomslider","_ui","zoomOut","_handleLoading","e","getEventId","_handleLoad","layer","_leaflet_id","target","_layerAdd","on","loading","load","exception","warn","eachLayer","off","dataloading","dataload","layerremove","Loading","Map","addInitHook","addControl","measureControl","className","_createButton","_toggleMeasure","html","title","fn","context","link","innerHTML","href","DomEvent","stopPropagation","preventDefault","_measuring","_startMeasuring","_stopMeasuring","_oldCursor","style","cursor","_doubleClickZoom","doubleClickZoom","enabled","disable","_mouseMove","_mouseClick","_finishPath","document","_onKeyDown","_layerPaint","layerGroup","addTo","_points","enable","clearLayers","_restartPath","latlng","_lastPoint","_layerPaintPathTemp","polyline","color","weight","clickable","dashArray","spliceLatLngs","_tooltip","_distance","_updateTooltipPosition","distance","distanceTo","_updateTooltipDistance","_createTooltip","_layerPaintPath","addLatLng","_lastCircle","removeLayer","CircleMarker","opacity","fill","fillOpacity","undefined","icon","divIcon","iconAnchor","marker","setLatLng","total","difference","totalRound","_round","differenceRound","text","_icon","val","Math","round","keyCode","Measure","control","measure","mergeOptions","positionControl","separator","emptyString","lngFirst","numDigits","lngFormatter","latFormatter","prefix","disableClickPropagation","_onMouseMove","lng","Util","formatNum","lat","value","prefixAndValue","MousePosition","mousePosition","QueryFactory","GeoPlatformClient","LayerService","HttpClient","JQueryHttpClient","Config","test","resourceTypes","indexOf","get","layerService","query","fields","ualUrl","search","then","response","results","catch","Q","reject","url","baseLayerId","defaultBaseLayerId","OSM","resolve","ItemService","ogcExpr","esriExpr","keyFn","expr","str","m","exec","types","refresh","updateList","log","pageSize","i","data","type","label","supported","toUpperCase","message","featurePopupTemplate","feature","props","Object","keys","properties","pFn","list","names","find","match","lc","name","toLowerCase","titleProp","descProp","description","result","modified","Date","toDateString","date","toTimeString","linkProp","prop","p","FeatureLayer","esri","_gpStyle","fillColor","pointToLayerFn","shape","height","iconUrl","content","iconSize","popupAnchor","pane","leafletPane","stroke","renderer","circleMarker","popupTemplate","bindPopup","eachFeatureFn","geometry","getGPStyle","svgOpts","SVG","svg","Canvas","canvas","pointToLayer","bind","onEachFeature","zIndex","setZIndex","index","_layers","toggleVisibility","setOpacity","loadStyle","gpLayerId","styleLoader","json","styles","styleFn","property","field1","v","wrapper","sw","setStyle","push","obj","jQuery","Cluster","FeatureManager","statics","EVENTS","CLUSTEREVENTS","esriLeaflet","_leafletIds","cluster","markerClusterGroup","_key","random","toString","replace","addEventParent","addLayer","createLayers","features","markers","geojson","newLayer","GeoJSON","geometryToLayer","asFeature","defaultOptions","resetStyle","fire","timeField","_featureWithinTimeRange","addLayers","ids","layersToAdd","removeLayers","permanent","layersToRemove","setFeatureStyle","eachFeature","getFeature","featureLayer","featureStyleResolver","deferred","defer","ajax","dataType","success","xhr","status","em","Error","promise","ClusteredFeatureLayer","EsriClusterFeatureLayer","spiderfyDistanceMultiplier","styleResolver","layerId","_featureGroup","toggleClass","setVisibility","bool","display","css","JSON","stringify","setTimeout","clusteredFeatures","service","services","msg","format","supportedFormats","layerName","geoJsonFeed","layerUrl","styleUrl","styleLoaderFactory","isModern","WMS","TileLayer","enableGetFeatureInfo","getFeatureInfo","_enabled","disableGetFeatureInfo","isGetFeatureInfoEnabled","evt","getFeatureInfoUrl","showResults","showGetFeatureInfo","parseGetFeatureInfo","point","latLngToContainerPoint","getZoom","getSize","params","srs","bbox","getBounds","toBBoxString","y","x","info_format","j","wmsParams","wmvId","getParamString","field","join","err","popup","maxWidth","setContent","openOn","wms","opts","layers","transparent","tileLayer","WMST","TimeDimension","Layer","_parseTimeDimensionFromCapabilities","xml","querySelectorAll","_baseLayer","times","forEach","current","querySelector","_getTimesFromLayerCapabilities","parentNode","dimensions","textContent","trim","extents","toISOString","wmst","gpLayer","leafletLayer","CustomWMS","proxyUrl","tdOpts","temporal","d1","startDate","d2","endDate","timeDimension","proxy","assign","defineProperty","varArgs","TypeError","to","arguments","nextSource","nextKey","writable","configurable","paramRe","template","WMTS","defaultWmtsParams","request","version","tileMatrixSet","_url","wmtsParams","tileSize","detectRetina","Browser","retina","matrixIds","getDefaultMatrix","_crs","crs","getTileUrl","coords","nwPoint","multiplyBy","sePoint","add","Point","zoom","_tileZoom","nw","project","unproject","se","tilewidth","ident","identifier","tileMatrix","X0","topLeftCorner","Y0","tilecol","floor","tilerow","isTileMatrixTemplated","isTileRowTemplated","isTileColTemplated","o","s","_getSubdomain","TileMatrix","TileRow","TileCol","k","qsi","setParams","noRedraw","redraw","matrixIds3857","Array","LatLng","wmts","distro","distributions","dist","mediaType","parameters","each","param","defaultValue","values","esriTileLayer","defaultESRIParams","f","qidx","substring","esriParams","dim","imagesr","bboxsr","code","tilePoint","z","ESRI","OSMLayerFactory","minZoom","maxZoom","attribution","LayerFactory","typeUri","serviceType","uri","supportedCRS","ServiceTypes","ESRI_MAP_SERVER","ESRITileLayer","ESRI_FEATURE_SERVER","ESRI_TILE_SERVER","useCors","tiledMapLayer","FEED","ItemTypes","ServiceFactory","Listener","_listeners","listener","idx","splice","args","slice","l","apply","MapInstance","setHttpClient","setServiceFactory","ceil","_mapId","_mapDef","initializeMapDefinition","_mapInstance","_defaultExtent","_baseLayerDef","_layerStates","_layerCache","_layerErrors","_featureLayer","_featureLayerVisible","_tools","state","dirty","_geoJsonLayerOpts","desc","bindTooltip","destroyMap","svcCache","serviceFactory","httpClient","mapService","factory","getLayerStateIndex","MAP","createdBy","baseLayer","keywords","themes","metadata","annotations","geoJSON","toGeoJSON","extent","minx","getWest","miny","getSouth","maxx","getEast","maxy","getNorth","drawControl","toolbars","_toolbars","toolbar","_modes","processLayerError","finder","tile","src","split","validate","def","notify","event","setView","touch","latLng","getCenter","fitBounds","oldBaseLayer","layerInstance","visibility","parse","addLayerWithState","handleLayerError","isNaN","setLayerVisibility","setLayerOpacity","from","copy","layerState","getLayers","getLayerState","_currentImage","getOpacity","visible","addFeature","addFeatures","fireEvent","featureGroup","geoJson","addFeatureLayer","featureJson","getFeatureLayer","featureId","getLatLng","panTo","setFeatureLayerVisibility","_addFeatureLayer","LayerGroup","child","_path","saveMap","md","gpMapType","getMapResourceContent","getService","save","clean","mapId","fetchMap","env","views","statistics","numViews","patch","op","path","updated","loadMapFromObj","t","min","max","setBaseLayer","fc","mapToUse","tool","finish","activate","cache","instance","dispose","arr","len","LoadingControl","MeasureControl","MousePositionControl","DefaultBaseLayer","ESRIClusterFeatureLayer","MapFactory","PopupTemplate","StyleResolver"],"mappings":"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"}