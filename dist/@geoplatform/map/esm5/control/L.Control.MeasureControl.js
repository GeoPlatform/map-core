/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Control, Map, DomUtil, DomEvent, layerGroup, polyline, CircleMarker, divIcon, marker } from 'leaflet';
var ɵ0 = function (map) {
    /** @type {?} */
    var className = 'leaflet-control-zoom leaflet-bar leaflet-control';
    /** @type {?} */
    var container = DomUtil.create('div', className);
    this._createButton('&#8674;', 'Measure', 'leaflet-control-measure leaflet-bar-part leaflet-bar-part-top-and-bottom', container, this._toggleMeasure, this);
    return container;
}, ɵ1 = function (html, title, className, container, fn, context) {
    /** @type {?} */
    var link = DomUtil.create('a', className, container);
    link.innerHTML = html;
    (/** @type {?} */ (link)).href = '#';
    link.title = title;
    DomEvent
        .on(link, 'click', DomEvent.stopPropagation)
        .on(link, 'click', DomEvent.preventDefault)
        .on(link, 'click', fn, context)
        .on(link, 'dblclick', DomEvent.stopPropagation);
    return link;
}, ɵ2 = function () {
    this._measuring = !this._measuring;
    if (this._measuring) {
        DomUtil.addClass(this._container, 'leaflet-control-measure-on');
        this._startMeasuring();
    }
    else {
        DomUtil.removeClass(this._container, 'leaflet-control-measure-on');
        this._stopMeasuring();
    }
}, ɵ3 = function () {
    this._oldCursor = this._map._container.style.cursor;
    this._map._container.style.cursor = 'crosshair';
    this._doubleClickZoom = this._map.doubleClickZoom.enabled();
    this._map.doubleClickZoom.disable();
    DomEvent
        .on(this._map, 'mousemove', this._mouseMove, this)
        .on(this._map, 'click', this._mouseClick, this)
        .on(this._map, 'dblclick', this._finishPath, this);
    //.on( (document as Document), 'keydown', this._onKeyDown, this);
    if (!this._layerPaint) {
        this._layerPaint = layerGroup().addTo(this._map);
    }
    if (!this._points) {
        this._points = [];
    }
}, ɵ4 = function () {
    this._map._container.style.cursor = this._oldCursor;
    DomEvent
        //.off((document as Document), 'keydown', this._onKeyDown, this)
        .off(this._map, 'mousemove', this._mouseMove, this)
        .off(this._map, 'click', this._mouseClick, this)
        .off(this._map, 'dblclick', this._mouseClick, this);
    if (this._doubleClickZoom) {
        this._map.doubleClickZoom.enable();
    }
    if (this._layerPaint) {
        this._layerPaint.clearLayers();
    }
    this._restartPath();
}, ɵ5 = function (e) {
    if (!e.latlng || !this._lastPoint) {
        return;
    }
    if (!this._layerPaintPathTemp) {
        /** @type {?} */
        var opts = /** @type {?} */ ({
            color: 'black',
            weight: 1.5,
            clickable: false,
            dashArray: '6,3'
        });
        this._layerPaintPathTemp = polyline([this._lastPoint, e.latlng], opts)
            .addTo(this._layerPaint);
    }
    else {
        this._layerPaintPathTemp.spliceLatLngs(0, 2, this._lastPoint, e.latlng);
    }
    if (this._tooltip) {
        if (!this._distance) {
            this._distance = 0;
        }
        this._updateTooltipPosition(e.latlng);
        /** @type {?} */
        var distance = e.latlng.distanceTo(this._lastPoint);
        this._updateTooltipDistance(this._distance + distance, distance);
    }
}, ɵ6 = function (e) {
    // Skip if no coordinates
    if (!e.latlng) {
        return;
    }
    // If we have a tooltip, update the distance and create a new tooltip, leaving the old one exactly where it is (i.e. where the user has clicked)
    if (this._lastPoint && this._tooltip) {
        if (!this._distance) {
            this._distance = 0;
        }
        this._updateTooltipPosition(e.latlng);
        /** @type {?} */
        var distance = e.latlng.distanceTo(this._lastPoint);
        this._updateTooltipDistance(this._distance + distance, distance);
        this._distance += distance;
    }
    this._createTooltip(e.latlng);
    // If this is already the second click, add the location to the fix path (create one first if we don't have one)
    if (this._lastPoint && !this._layerPaintPath) {
        /** @type {?} */
        var opts = /** @type {?} */ ({
            color: 'black',
            weight: 2,
            clickable: false
        });
        this._layerPaintPath = polyline([this._lastPoint], opts).addTo(this._layerPaint);
    }
    if (this._layerPaintPath) {
        this._layerPaintPath.addLatLng(e.latlng);
    }
    // Upate the end marker to the current location
    if (this._lastCircle) {
        this._layerPaint.removeLayer(this._lastCircle);
    }
    /** @type {?} */
    var markerOpts = /** @type {?} */ ({
        color: 'black',
        opacity: 1,
        weight: 1,
        fill: true,
        fillOpacity: 1,
        radius: 2,
        clickable: this._lastCircle ? true : false
    });
    this._lastCircle = new CircleMarker(e.latlng, markerOpts).addTo(this._layerPaint);
    this._lastCircle.on('click', function () { this._finishPath(); }, this);
    // Save current location as last location
    this._lastPoint = e.latlng;
}, ɵ7 = function () {
    // Remove the last end marker as well as the last (moving tooltip)
    if (this._lastCircle) {
        this._layerPaint.removeLayer(this._lastCircle);
    }
    if (this._tooltip) {
        this._layerPaint.removeLayer(this._tooltip);
    }
    if (this._layerPaint && this._layerPaintPathTemp) {
        this._layerPaint.removeLayer(this._layerPaintPathTemp);
    }
    // Reset everything
    this._restartPath();
}, ɵ8 = function () {
    this._distance = 0;
    this._tooltip = undefined;
    this._lastCircle = undefined;
    this._lastPoint = undefined;
    this._layerPaintPath = undefined;
    this._layerPaintPathTemp = undefined;
}, ɵ9 = function (position) {
    /** @type {?} */
    var icon = divIcon({
        className: 'leaflet-measure-tooltip',
        iconAnchor: [-5, -5]
    });
    this._tooltip = marker(position, {
        icon: icon,
        clickable: false
    }).addTo(this._layerPaint);
}, ɵ10 = function (position) {
    this._tooltip.setLatLng(position);
}, ɵ11 = function (total, difference) {
    /** @type {?} */
    var totalRound = this._round(total);
    /** @type {?} */
    var differenceRound = this._round(difference);
    /** @type {?} */
    var text = '<div class="leaflet-measure-tooltip-total">' + totalRound + ' nm</div>';
    if (differenceRound > 0 && totalRound != differenceRound) {
        text += '<div class="leaflet-measure-tooltip-difference">(+' + differenceRound + ' nm)</div>';
    }
    this._tooltip._icon.innerHTML = text;
}, ɵ12 = function (val) {
    return Math.round((val / 1852) * 10) / 10;
}, ɵ13 = function (e) {
    if (e.keyCode == 27) {
        // If not in path exit measuring mode, else just finish path
        if (!this._lastPoint) {
            this._toggleMeasure();
        }
        else {
            this._finishPath();
        }
    }
};
/** @type {?} */
var measureControl = Control.extend({
    options: {
        position: 'topleft'
    },
    onAdd: ɵ0,
    _createButton: ɵ1,
    _toggleMeasure: ɵ2,
    _startMeasuring: ɵ3,
    _stopMeasuring: ɵ4,
    _mouseMove: ɵ5,
    _mouseClick: ɵ6,
    _finishPath: ɵ7,
    _restartPath: ɵ8,
    _createTooltip: ɵ9,
    _updateTooltipPosition: ɵ10,
    _updateTooltipDistance: ɵ11,
    _round: ɵ12,
    _onKeyDown: ɵ13
});
if ((/** @type {?} */ (window)).L) {
    /** @type {?} */
    var L_1 = (/** @type {?} */ (window)).L;
    L_1.Control.Measure = measureControl;
    L_1.control.measure = function (options) {
        return new L_1.Control.Measure(options);
    };
}
Map.mergeOptions({
    measureControl: false
});
Map.addInitHook(function () {
    if (this.options.measureControl) {
        this.measureControl = new measureControl();
        this.addControl(this.measureControl);
    }
});
export default measureControl;
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9, ɵ10, ɵ11, ɵ12, ɵ13 };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTC5Db250cm9sLk1lYXN1cmVDb250cm9sLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdlb3BsYXRmb3JtL21hcC8iLCJzb3VyY2VzIjpbImNvbnRyb2wvTC5Db250cm9sLk1lYXN1cmVDb250cm9sLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQ0gsT0FBTyxFQUNQLEdBQUcsRUFDSCxPQUFPLEVBQUUsUUFBUSxFQUNqQixVQUFVLEVBQ1YsUUFBUSxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUUxQyxNQUFNLFNBQVMsQ0FBQztTQVFOLFVBQVUsR0FBRzs7SUFDaEIsSUFBSSxTQUFTLEdBQUcsa0RBQWtELENBQ2pCOztJQURqRCxJQUNJLFNBQVMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQztJQUVqRCxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsMEVBQTBFLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFFM0osT0FBTyxTQUFTLENBQUM7Q0FDcEIsT0FFYyxVQUFVLElBQUksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsT0FBTzs7SUFDbkUsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3JELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO0lBQ3RCLG1CQUFDLElBQXlCLEVBQUMsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO0lBQ3ZDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBRW5CLFFBQVE7U0FDSCxFQUFFLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUMsZUFBZSxDQUFDO1NBQzNDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLFFB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QUFjLEVBQUUsQ0FBQztRQUMzQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztLQUN4QztDQUNKLENBQUMsQ0FBQztBQUdILGVBQWUsY0FBYyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQge1xuICAgIENvbnRyb2wsIGNvbnRyb2wsXG4gICAgTWFwLFxuICAgIERvbVV0aWwsIERvbUV2ZW50LFxuICAgIGxheWVyR3JvdXAsXG4gICAgcG9seWxpbmUsIENpcmNsZU1hcmtlciwgZGl2SWNvbiwgbWFya2VyLFxuICAgIFBvbHlsaW5lT3B0aW9ucywgQ2lyY2xlTWFya2VyT3B0aW9uc1xufSBmcm9tICdsZWFmbGV0JztcblxuXG52YXIgbWVhc3VyZUNvbnRyb2wgPSBDb250cm9sLmV4dGVuZCh7XG4gICAgb3B0aW9uczoge1xuICAgICAgICBwb3NpdGlvbjogJ3RvcGxlZnQnXG4gICAgfSxcblxuICAgIG9uQWRkOiBmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIHZhciBjbGFzc05hbWUgPSAnbGVhZmxldC1jb250cm9sLXpvb20gbGVhZmxldC1iYXIgbGVhZmxldC1jb250cm9sJyxcbiAgICAgICAgICAgIGNvbnRhaW5lciA9IERvbVV0aWwuY3JlYXRlKCdkaXYnLCBjbGFzc05hbWUpO1xuXG4gICAgICAgIHRoaXMuX2NyZWF0ZUJ1dHRvbignJiM4Njc0OycsICdNZWFzdXJlJywgJ2xlYWZsZXQtY29udHJvbC1tZWFzdXJlIGxlYWZsZXQtYmFyLXBhcnQgbGVhZmxldC1iYXItcGFydC10b3AtYW5kLWJvdHRvbScsIGNvbnRhaW5lciwgdGhpcy5fdG9nZ2xlTWVhc3VyZSwgdGhpcyk7XG5cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICB9LFxuXG4gICAgX2NyZWF0ZUJ1dHRvbjogZnVuY3Rpb24gKGh0bWwsIHRpdGxlLCBjbGFzc05hbWUsIGNvbnRhaW5lciwgZm4sIGNvbnRleHQpIHtcbiAgICAgICAgdmFyIGxpbmsgPSBEb21VdGlsLmNyZWF0ZSgnYScsIGNsYXNzTmFtZSwgY29udGFpbmVyKTtcbiAgICAgICAgbGluay5pbm5lckhUTUwgPSBodG1sO1xuICAgICAgICAobGluayBhcyBIVE1MQW5jaG9yRWxlbWVudCkuaHJlZiA9ICcjJztcbiAgICAgICAgbGluay50aXRsZSA9IHRpdGxlO1xuXG4gICAgICAgIERvbUV2ZW50XG4gICAgICAgICAgICAub24obGluaywgJ2NsaWNrJywgRG9tRXZlbnQuc3RvcFByb3BhZ2F0aW9uKVxuICAgICAgICAgICAgLm9uKGxpbmssICdjbGljaycsIERvbUV2ZW50LnByZXZlbnREZWZhdWx0KVxuICAgICAgICAgICAgLm9uKGxpbmssICdjbGljaycsIGZuLCBjb250ZXh0KVxuICAgICAgICAgICAgLm9uKGxpbmssICdkYmxjbGljaycsIERvbUV2ZW50LnN0b3BQcm9wYWdhdGlvbik7XG5cbiAgICAgICAgcmV0dXJuIGxpbms7XG4gICAgfSxcblxuICAgIF90b2dnbGVNZWFzdXJlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX21lYXN1cmluZyA9ICF0aGlzLl9tZWFzdXJpbmc7XG5cbiAgICAgICAgaWYodGhpcy5fbWVhc3VyaW5nKSB7XG4gICAgICAgICAgICBEb21VdGlsLmFkZENsYXNzKHRoaXMuX2NvbnRhaW5lciwgJ2xlYWZsZXQtY29udHJvbC1tZWFzdXJlLW9uJyk7XG4gICAgICAgICAgICB0aGlzLl9zdGFydE1lYXN1cmluZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgRG9tVXRpbC5yZW1vdmVDbGFzcyh0aGlzLl9jb250YWluZXIsICdsZWFmbGV0LWNvbnRyb2wtbWVhc3VyZS1vbicpO1xuICAgICAgICAgICAgdGhpcy5fc3RvcE1lYXN1cmluZygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9zdGFydE1lYXN1cmluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuX29sZEN1cnNvciA9IHRoaXMuX21hcC5fY29udGFpbmVyLnN0eWxlLmN1cnNvcjtcbiAgICAgICAgdGhpcy5fbWFwLl9jb250YWluZXIuc3R5bGUuY3Vyc29yID0gJ2Nyb3NzaGFpcic7XG5cbiAgICAgICAgdGhpcy5fZG91YmxlQ2xpY2tab29tID0gdGhpcy5fbWFwLmRvdWJsZUNsaWNrWm9vbS5lbmFibGVkKCk7XG4gICAgICAgIHRoaXMuX21hcC5kb3VibGVDbGlja1pvb20uZGlzYWJsZSgpO1xuXG4gICAgICAgIERvbUV2ZW50XG4gICAgICAgICAgICAub24odGhpcy5fbWFwLCAnbW91c2Vtb3ZlJywgdGhpcy5fbW91c2VNb3ZlLCB0aGlzKVxuICAgICAgICAgICAgLm9uKHRoaXMuX21hcCwgJ2NsaWNrJywgdGhpcy5fbW91c2VDbGljaywgdGhpcylcbiAgICAgICAgICAgIC5vbih0aGlzLl9tYXAsICdkYmxjbGljaycsIHRoaXMuX2ZpbmlzaFBhdGgsIHRoaXMpXG4gICAgICAgICAgICAvLy5vbiggKGRvY3VtZW50IGFzIERvY3VtZW50KSwgJ2tleWRvd24nLCB0aGlzLl9vbktleURvd24sIHRoaXMpO1xuXG4gICAgICAgIGlmKCF0aGlzLl9sYXllclBhaW50KSB7XG4gICAgICAgICAgICB0aGlzLl9sYXllclBhaW50ID0gbGF5ZXJHcm91cCgpLmFkZFRvKHRoaXMuX21hcCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZighdGhpcy5fcG9pbnRzKSB7XG4gICAgICAgICAgICB0aGlzLl9wb2ludHMgPSBbXTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfc3RvcE1lYXN1cmluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuX21hcC5fY29udGFpbmVyLnN0eWxlLmN1cnNvciA9IHRoaXMuX29sZEN1cnNvcjtcblxuICAgICAgICBEb21FdmVudFxuICAgICAgICAgICAgLy8ub2ZmKChkb2N1bWVudCBhcyBEb2N1bWVudCksICdrZXlkb3duJywgdGhpcy5fb25LZXlEb3duLCB0aGlzKVxuICAgICAgICAgICAgLm9mZih0aGlzLl9tYXAsICdtb3VzZW1vdmUnLCB0aGlzLl9tb3VzZU1vdmUsIHRoaXMpXG4gICAgICAgICAgICAub2ZmKHRoaXMuX21hcCwgJ2NsaWNrJywgdGhpcy5fbW91c2VDbGljaywgdGhpcylcbiAgICAgICAgICAgIC5vZmYodGhpcy5fbWFwLCAnZGJsY2xpY2snLCB0aGlzLl9tb3VzZUNsaWNrLCB0aGlzKTtcblxuICAgICAgICBpZih0aGlzLl9kb3VibGVDbGlja1pvb20pIHtcbiAgICAgICAgICAgIHRoaXMuX21hcC5kb3VibGVDbGlja1pvb20uZW5hYmxlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0aGlzLl9sYXllclBhaW50KSB7XG4gICAgICAgICAgICB0aGlzLl9sYXllclBhaW50LmNsZWFyTGF5ZXJzKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9yZXN0YXJ0UGF0aCgpO1xuICAgIH0sXG5cbiAgICBfbW91c2VNb3ZlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmKCFlLmxhdGxuZyB8fCAhdGhpcy5fbGFzdFBvaW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZighdGhpcy5fbGF5ZXJQYWludFBhdGhUZW1wKSB7XG4gICAgICAgICAgICBsZXQgb3B0cyA9IHtcbiAgICAgICAgICAgICAgICBjb2xvcjogJ2JsYWNrJyxcbiAgICAgICAgICAgICAgICB3ZWlnaHQ6IDEuNSxcbiAgICAgICAgICAgICAgICBjbGlja2FibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRhc2hBcnJheTogJzYsMydcbiAgICAgICAgICAgIH0gYXMgUG9seWxpbmVPcHRpb25zO1xuICAgICAgICAgICAgdGhpcy5fbGF5ZXJQYWludFBhdGhUZW1wID0gcG9seWxpbmUoW3RoaXMuX2xhc3RQb2ludCwgZS5sYXRsbmddLCBvcHRzKVxuICAgICAgICAgICAgICAgIC5hZGRUbyh0aGlzLl9sYXllclBhaW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2xheWVyUGFpbnRQYXRoVGVtcC5zcGxpY2VMYXRMbmdzKDAsIDIsIHRoaXMuX2xhc3RQb2ludCwgZS5sYXRsbmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYodGhpcy5fdG9vbHRpcCkge1xuICAgICAgICAgICAgaWYoIXRoaXMuX2Rpc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGlzdGFuY2UgPSAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl91cGRhdGVUb29sdGlwUG9zaXRpb24oZS5sYXRsbmcpO1xuXG4gICAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBlLmxhdGxuZy5kaXN0YW5jZVRvKHRoaXMuX2xhc3RQb2ludCk7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVUb29sdGlwRGlzdGFuY2UodGhpcy5fZGlzdGFuY2UgKyBkaXN0YW5jZSwgZGlzdGFuY2UpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9tb3VzZUNsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vIFNraXAgaWYgbm8gY29vcmRpbmF0ZXNcbiAgICAgICAgaWYoIWUubGF0bG5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgdG9vbHRpcCwgdXBkYXRlIHRoZSBkaXN0YW5jZSBhbmQgY3JlYXRlIGEgbmV3IHRvb2x0aXAsIGxlYXZpbmcgdGhlIG9sZCBvbmUgZXhhY3RseSB3aGVyZSBpdCBpcyAoaS5lLiB3aGVyZSB0aGUgdXNlciBoYXMgY2xpY2tlZClcbiAgICAgICAgaWYodGhpcy5fbGFzdFBvaW50ICYmIHRoaXMuX3Rvb2x0aXApIHtcbiAgICAgICAgICAgIGlmKCF0aGlzLl9kaXN0YW5jZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3RhbmNlID0gMDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlVG9vbHRpcFBvc2l0aW9uKGUubGF0bG5nKTtcblxuICAgICAgICAgICAgdmFyIGRpc3RhbmNlID0gZS5sYXRsbmcuZGlzdGFuY2VUbyh0aGlzLl9sYXN0UG9pbnQpO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlVG9vbHRpcERpc3RhbmNlKHRoaXMuX2Rpc3RhbmNlICsgZGlzdGFuY2UsIGRpc3RhbmNlKTtcblxuICAgICAgICAgICAgdGhpcy5fZGlzdGFuY2UgKz0gZGlzdGFuY2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3JlYXRlVG9vbHRpcChlLmxhdGxuZyk7XG5cblxuICAgICAgICAvLyBJZiB0aGlzIGlzIGFscmVhZHkgdGhlIHNlY29uZCBjbGljaywgYWRkIHRoZSBsb2NhdGlvbiB0byB0aGUgZml4IHBhdGggKGNyZWF0ZSBvbmUgZmlyc3QgaWYgd2UgZG9uJ3QgaGF2ZSBvbmUpXG4gICAgICAgIGlmKHRoaXMuX2xhc3RQb2ludCAmJiAhdGhpcy5fbGF5ZXJQYWludFBhdGgpIHtcbiAgICAgICAgICAgIGxldCBvcHRzID0ge1xuICAgICAgICAgICAgICAgIGNvbG9yOiAnYmxhY2snLFxuICAgICAgICAgICAgICAgIHdlaWdodDogMixcbiAgICAgICAgICAgICAgICBjbGlja2FibGU6IGZhbHNlXG4gICAgICAgICAgICB9IGFzIFBvbHlsaW5lT3B0aW9ucztcbiAgICAgICAgICAgIHRoaXMuX2xheWVyUGFpbnRQYXRoID0gcG9seWxpbmUoW3RoaXMuX2xhc3RQb2ludF0sIG9wdHMpLmFkZFRvKHRoaXMuX2xheWVyUGFpbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYodGhpcy5fbGF5ZXJQYWludFBhdGgpIHtcbiAgICAgICAgICAgIHRoaXMuX2xheWVyUGFpbnRQYXRoLmFkZExhdExuZyhlLmxhdGxuZyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGF0ZSB0aGUgZW5kIG1hcmtlciB0byB0aGUgY3VycmVudCBsb2NhdGlvblxuICAgICAgICBpZih0aGlzLl9sYXN0Q2lyY2xlKSB7XG4gICAgICAgICAgICB0aGlzLl9sYXllclBhaW50LnJlbW92ZUxheWVyKHRoaXMuX2xhc3RDaXJjbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1hcmtlck9wdHMgPSB7XG4gICAgICAgICAgICBjb2xvcjogJ2JsYWNrJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB3ZWlnaHQ6IDEsXG4gICAgICAgICAgICBmaWxsOiB0cnVlLFxuICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXG4gICAgICAgICAgICByYWRpdXM6MixcbiAgICAgICAgICAgIGNsaWNrYWJsZTogdGhpcy5fbGFzdENpcmNsZSA/IHRydWUgOiBmYWxzZVxuICAgICAgICB9IGFzIENpcmNsZU1hcmtlck9wdGlvbnM7XG4gICAgICAgIHRoaXMuX2xhc3RDaXJjbGUgPSBuZXcgQ2lyY2xlTWFya2VyKGUubGF0bG5nLCBtYXJrZXJPcHRzKS5hZGRUbyh0aGlzLl9sYXllclBhaW50KTtcblxuICAgICAgICB0aGlzLl9sYXN0Q2lyY2xlLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgeyB0aGlzLl9maW5pc2hQYXRoKCk7IH0sIHRoaXMpO1xuXG4gICAgICAgIC8vIFNhdmUgY3VycmVudCBsb2NhdGlvbiBhcyBsYXN0IGxvY2F0aW9uXG4gICAgICAgIHRoaXMuX2xhc3RQb2ludCA9IGUubGF0bG5nO1xuICAgIH0sXG5cbiAgICBfZmluaXNoUGF0aDogZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgbGFzdCBlbmQgbWFya2VyIGFzIHdlbGwgYXMgdGhlIGxhc3QgKG1vdmluZyB0b29sdGlwKVxuICAgICAgICBpZih0aGlzLl9sYXN0Q2lyY2xlKSB7XG4gICAgICAgICAgICB0aGlzLl9sYXllclBhaW50LnJlbW92ZUxheWVyKHRoaXMuX2xhc3RDaXJjbGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMuX3Rvb2x0aXApIHtcbiAgICAgICAgICAgIHRoaXMuX2xheWVyUGFpbnQucmVtb3ZlTGF5ZXIodGhpcy5fdG9vbHRpcCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpcy5fbGF5ZXJQYWludCAmJiB0aGlzLl9sYXllclBhaW50UGF0aFRlbXApIHtcbiAgICAgICAgICAgIHRoaXMuX2xheWVyUGFpbnQucmVtb3ZlTGF5ZXIodGhpcy5fbGF5ZXJQYWludFBhdGhUZW1wKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlc2V0IGV2ZXJ5dGhpbmdcbiAgICAgICAgdGhpcy5fcmVzdGFydFBhdGgoKTtcbiAgICB9LFxuXG4gICAgX3Jlc3RhcnRQYXRoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5fZGlzdGFuY2UgPSAwO1xuICAgICAgICB0aGlzLl90b29sdGlwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9sYXN0Q2lyY2xlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9sYXN0UG9pbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX2xheWVyUGFpbnRQYXRoID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9sYXllclBhaW50UGF0aFRlbXAgPSB1bmRlZmluZWQ7XG4gICAgfSxcblxuICAgIF9jcmVhdGVUb29sdGlwOiBmdW5jdGlvbihwb3NpdGlvbikge1xuICAgICAgICB2YXIgaWNvbiA9IGRpdkljb24oe1xuICAgICAgICAgICAgY2xhc3NOYW1lOiAnbGVhZmxldC1tZWFzdXJlLXRvb2x0aXAnLFxuICAgICAgICAgICAgaWNvbkFuY2hvcjogWy01LCAtNV1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3Rvb2x0aXAgPSBtYXJrZXIocG9zaXRpb24sIHtcbiAgICAgICAgICAgIGljb246IGljb24sXG4gICAgICAgICAgICBjbGlja2FibGU6IGZhbHNlXG4gICAgICAgIH0pLmFkZFRvKHRoaXMuX2xheWVyUGFpbnQpO1xuICAgIH0sXG5cbiAgICBfdXBkYXRlVG9vbHRpcFBvc2l0aW9uOiBmdW5jdGlvbihwb3NpdGlvbikge1xuICAgICAgICB0aGlzLl90b29sdGlwLnNldExhdExuZyhwb3NpdGlvbik7XG4gICAgfSxcblxuICAgIF91cGRhdGVUb29sdGlwRGlzdGFuY2U6IGZ1bmN0aW9uKHRvdGFsLCBkaWZmZXJlbmNlKSB7XG4gICAgICAgIHZhciB0b3RhbFJvdW5kID0gdGhpcy5fcm91bmQodG90YWwpLFxuICAgICAgICAgICAgZGlmZmVyZW5jZVJvdW5kID0gdGhpcy5fcm91bmQoZGlmZmVyZW5jZSk7XG5cbiAgICAgICAgdmFyIHRleHQgPSAnPGRpdiBjbGFzcz1cImxlYWZsZXQtbWVhc3VyZS10b29sdGlwLXRvdGFsXCI+JyArIHRvdGFsUm91bmQgKyAnIG5tPC9kaXY+JztcbiAgICAgICAgaWYoZGlmZmVyZW5jZVJvdW5kID4gMCAmJiB0b3RhbFJvdW5kICE9IGRpZmZlcmVuY2VSb3VuZCkge1xuICAgICAgICAgICAgdGV4dCArPSAnPGRpdiBjbGFzcz1cImxlYWZsZXQtbWVhc3VyZS10b29sdGlwLWRpZmZlcmVuY2VcIj4oKycgKyBkaWZmZXJlbmNlUm91bmQgKyAnIG5tKTwvZGl2Pic7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl90b29sdGlwLl9pY29uLmlubmVySFRNTCA9IHRleHQ7XG4gICAgfSxcblxuICAgIF9yb3VuZDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKCh2YWwgLyAxODUyKSAqIDEwKSAvIDEwO1xuICAgIH0sXG5cbiAgICBfb25LZXlEb3duOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZihlLmtleUNvZGUgPT0gMjcpIHtcbiAgICAgICAgICAgIC8vIElmIG5vdCBpbiBwYXRoIGV4aXQgbWVhc3VyaW5nIG1vZGUsIGVsc2UganVzdCBmaW5pc2ggcGF0aFxuICAgICAgICAgICAgaWYoIXRoaXMuX2xhc3RQb2ludCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3RvZ2dsZU1lYXN1cmUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZmluaXNoUGF0aCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSk7XG5cblxuaWYoICh3aW5kb3cgYXMgYW55KS5MKSB7XG4gICAgY29uc3QgTCA9ICh3aW5kb3cgYXMgYW55KS5MO1xuICAgIEwuQ29udHJvbC5NZWFzdXJlID0gbWVhc3VyZUNvbnRyb2w7XG4gICAgTC5jb250cm9sLm1lYXN1cmUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gbmV3IEwuQ29udHJvbC5NZWFzdXJlKG9wdGlvbnMpO1xuICAgIH07XG59XG5cbk1hcC5tZXJnZU9wdGlvbnMoe1xuICAgIG1lYXN1cmVDb250cm9sOiBmYWxzZVxufSk7XG5cbk1hcC5hZGRJbml0SG9vayhmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5tZWFzdXJlQ29udHJvbCkge1xuICAgICAgICB0aGlzLm1lYXN1cmVDb250cm9sID0gbmV3IG1lYXN1cmVDb250cm9sKCk7XG4gICAgICAgIHRoaXMuYWRkQ29udHJvbCh0aGlzLm1lYXN1cmVDb250cm9sKTtcbiAgICB9XG59KTtcblxuXG5leHBvcnQgZGVmYXVsdCBtZWFzdXJlQ29udHJvbDtcbiJdfQ==