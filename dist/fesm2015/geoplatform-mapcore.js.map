{"version":3,"file":"geoplatform-mapcore.js.map","sources":["ng://@geoplatform/mapcore/polyfills.ts","ng://@geoplatform/mapcore/control/loading.ts","ng://@geoplatform/mapcore/control/measure.ts","ng://@geoplatform/mapcore/control/mouse-position.ts","ng://@geoplatform/mapcore/control/feature-editor.ts","ng://@geoplatform/mapcore/shared/resource-types.ts","ng://@geoplatform/mapcore/layer/osm.ts","ng://@geoplatform/mapcore/layer/baselayer-default.ts","ng://@geoplatform/mapcore/service/types.ts","ng://@geoplatform/mapcore/layer/base-clustered-feature-layer.ts","ng://@geoplatform/mapcore/shared/style-resolver.ts","ng://@geoplatform/mapcore/shared/popup-template.ts","ng://@geoplatform/mapcore/layer/cluster-feature.ts","ng://@geoplatform/mapcore/layer/wms.ts","ng://@geoplatform/mapcore/layer/wmst.ts","ng://@geoplatform/mapcore/layer/wmts.ts","ng://@geoplatform/mapcore/layer/esri-tile-layer.ts","ng://@geoplatform/mapcore/layer/osm-factory.ts","ng://@geoplatform/mapcore/layer/factory.ts","ng://@geoplatform/mapcore/layer/feature.ts","ng://@geoplatform/mapcore/map/instance.ts","ng://@geoplatform/mapcore/map/factory.ts","ng://@geoplatform/mapcore/index.ts"],"sourcesContent":["\n\nexport default function() {\n\n    if (typeof Object.assign != 'function') {\n        // Must be writable: true, enumerable: false, configurable: true\n        Object.defineProperty(Object, \"assign\", {\n            value: function assign(target, varArgs) { // .length of function is 2\n                'use strict';\n                if (target == null) { // TypeError if undefined or null\n                    throw new TypeError('Cannot convert undefined or null to object');\n                }\n\n                var to = Object(target);\n\n                for (var index = 1; index < arguments.length; index++) {\n                    var nextSource = arguments[index];\n\n                    if (nextSource != null) { // Skip over if undefined or null\n                        for (var nextKey in nextSource) {\n                            // Avoid bugs when hasOwnProperty is shadowed\n                            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                                to[nextKey] = nextSource[nextKey];\n                            }\n                        }\n                    }\n                }\n                return to;\n            },\n            writable: true,\n            configurable: true\n        });\n    }\n\n}\n","\nimport { Control, Util, DomUtil, Map } from 'leaflet';\n\nvar loadingControl = Control.extend({\n    options: {\n        position: 'topleft',\n        separate: false,\n        zoomControl: null,\n        spinjs: false,\n        spin: {\n          lines: 7,\n          length: 3,\n          width: 3,\n          radius: 5,\n          rotate: 13,\n          top: \"83%\"\n        }\n    },\n\n    initialize: function(options) {\n        Util.setOptions(this, options);\n        this._dataLoaders = {};\n\n        // Try to set the zoom control this control is attached to from the\n        // options\n        if (this.options.zoomControl !== null) {\n            this.zoomControl = this.options.zoomControl;\n        }\n    },\n\n    onAdd: function(map) {\n\n        this._addLayerListeners(map);\n        this._addMapListeners(map);\n\n        // Try to set the zoom control this control is attached to from the map\n        // the control is being added to\n        if (!this.options.separate && !this.zoomControl) {\n            if (map.zoomControl) {\n                this.zoomControl = map.zoomControl;\n            } else if (map.zoomsliderControl) {\n                this.zoomControl = map.zoomsliderControl;\n            }\n        }\n\n        // Create the loading indicator\n        var classes = 'leaflet-control-loading';\n        var container;\n        if (this.zoomControl && !this.options.separate) {\n            // If there is a zoom control, hook into the bottom of it\n            container = this.zoomControl._container;\n            // These classes are no longer used as of Leaflet 0.6\n            classes += ' leaflet-bar-part-bottom leaflet-bar-part last';\n        }\n        else {\n            // Otherwise, create a container for the indicator\n            container = DomUtil.create('div', 'leaflet-control-zoom leaflet-bar');\n        }\n        this._indicator = DomUtil.create('a', classes, container);\n        return container;\n    },\n\n    onRemove: function(map) {\n        this._removeLayerListeners(map);\n        this._removeMapListeners(map);\n    },\n\n    removeFrom: function (map) {\n        if (this.zoomControl && !this.options.separate) {\n            // Override Control.removeFrom() to avoid clobbering the entire\n            // _container, which is the same as zoomControl's\n            this._container.removeChild(this._indicator);\n            this._map = null;\n            this.onRemove(map);\n            return this;\n        }\n        else {\n            // If this control is separate from the zoomControl, call the\n            // parent method so we don't leave behind an empty container\n            return Control.prototype.remove.call(this);\n        }\n    },\n\n    addLoader: function(id) {\n        this._dataLoaders[id] = true;\n        this.updateIndicator();\n    },\n\n    removeLoader: function(id) {\n        delete this._dataLoaders[id];\n        this.updateIndicator();\n    },\n\n    updateIndicator: function() {\n        if (this.isLoading()) {\n            this._showIndicator();\n        }\n        else {\n            this._hideIndicator();\n        }\n    },\n\n    isLoading: function() {\n        return this._countLoaders() > 0;\n    },\n\n    _countLoaders: function() {\n        var size = 0, key;\n        for (key in this._dataLoaders) {\n            if (this._dataLoaders.hasOwnProperty(key)) size++;\n        }\n        return size;\n    },\n\n    _showIndicator: function() {\n        // Show loading indicator\n        DomUtil.addClass(this._indicator, 'is-loading');\n\n        // If zoomControl exists, make the zoom-out button not last\n        if (!this.options.separate) {\n            if (this.zoomControl instanceof Control.Zoom) {\n                DomUtil.removeClass(this.zoomControl._zoomOutButton, 'leaflet-bar-part-bottom');\n            }\n        }\n    },\n\n    _hideIndicator: function() {\n        // Hide loading indicator\n        DomUtil.removeClass(this._indicator, 'is-loading');\n\n        // If zoomControl exists, make the zoom-out button last\n        if (!this.options.separate) {\n            if (this.zoomControl instanceof Control.Zoom) {\n                DomUtil.addClass(this.zoomControl._zoomOutButton, 'leaflet-bar-part-bottom');\n            }\n        }\n    },\n\n    _handleLoading: function(e) {\n        this.addLoader(this.getEventId(e));\n    },\n\n    _handleLoad: function(e) {\n        this.removeLoader(this.getEventId(e));\n    },\n\n    getEventId: function(e) {\n        if (e.id) {\n            return e.id;\n        }\n        else if (e.layer) {\n            return e.layer._leaflet_id;\n        }\n        return e.target._leaflet_id;\n    },\n\n    _layerAdd: function(e) {\n        if (!e.layer || !e.layer.on) return;\n        try {\n            e.layer.on({\n                loading: this._handleLoading,\n                load: this._handleLoad\n            }, this);\n        }\n        catch (exception) {\n            console.warn('L.Control.Loading: Tried and failed to add ' +\n                         ' event handlers to layer', e.layer);\n            console.warn('L.Control.Loading: Full details', exception);\n        }\n    },\n\n    _addLayerListeners: function(map) {\n        // Add listeners for begin and end of load to any layers already on the\n        // map\n        map.eachLayer(function(layer) {\n            if (!layer.on) return;\n            layer.on({\n                loading: this._handleLoading,\n                load: this._handleLoad\n            }, this);\n        }, this);\n\n        // When a layer is added to the map, add listeners for begin and end\n        // of load\n        map.on('layeradd', this._layerAdd, this);\n    },\n\n    _removeLayerListeners: function(map) {\n        // Remove listeners for begin and end of load from all layers\n        map.eachLayer(function(layer) {\n            if (!layer.off) return;\n            layer.off({\n                loading: this._handleLoading,\n                load: this._handleLoad\n            }, this);\n        }, this);\n\n        // Remove layeradd listener from map\n        map.off('layeradd', this._layerAdd, this);\n    },\n\n    _addMapListeners: function(map) {\n        // Add listeners to the map for (custom) dataloading and dataload\n        // events, eg, for AJAX calls that affect the map but will not be\n        // reflected in the above layer events.\n        map.on({\n            dataloading: this._handleLoading,\n            dataload: this._handleLoad,\n            layerremove: this._handleLoad\n        }, this);\n    },\n\n    _removeMapListeners: function(map) {\n        map.off({\n            dataloading: this._handleLoading,\n            dataload: this._handleLoad,\n            layerremove: this._handleLoad\n        }, this);\n    }\n});\n\n\nif( (window as any).L) {\n    const L = (window as any).L;\n    L.Control.Loading = loadingControl;\n    L.Control.loading = function(options) {\n        return new L.Control.Loading(options);\n    };\n}\n\nMap.addInitHook(function () {\n    if (this.options.loadingControl) {\n        this.loadingControl = new loadingControl();\n        this.addControl(this.loadingControl);\n    }\n});\n\nexport default loadingControl;\n","\nimport {\n    Control, control,\n    Map,\n    DomUtil, DomEvent,\n    layerGroup,\n    polyline, CircleMarker, divIcon, marker,\n    PolylineOptions, CircleMarkerOptions\n} from 'leaflet';\n\n\nvar measureControl = Control.extend({\n    options: {\n        position: 'topleft'\n    },\n\n    onAdd: function (map) {\n        var className = 'leaflet-control-zoom leaflet-bar leaflet-control',\n            container = DomUtil.create('div', className);\n\n        this._createButton('&#8674;', 'Measure', 'leaflet-control-measure leaflet-bar-part leaflet-bar-part-top-and-bottom', container, this._toggleMeasure, this);\n\n        return container;\n    },\n\n    _createButton: function (html, title, className, container, fn, context) {\n        var link = DomUtil.create('a', className, container);\n        link.innerHTML = html;\n        (link as HTMLAnchorElement).href = '#';\n        link.title = title;\n\n        DomEvent\n            .on(link, 'click', DomEvent.stopPropagation)\n            .on(link, 'click', DomEvent.preventDefault)\n            .on(link, 'click', fn, context)\n            .on(link, 'dblclick', DomEvent.stopPropagation);\n\n        return link;\n    },\n\n    _toggleMeasure: function () {\n        this._measuring = !this._measuring;\n\n        if(this._measuring) {\n            DomUtil.addClass(this._container, 'leaflet-control-measure-on');\n            this._startMeasuring();\n        } else {\n            DomUtil.removeClass(this._container, 'leaflet-control-measure-on');\n            this._stopMeasuring();\n        }\n    },\n\n    _startMeasuring: function() {\n        this._oldCursor = this._map._container.style.cursor;\n        this._map._container.style.cursor = 'crosshair';\n\n        this._doubleClickZoom = this._map.doubleClickZoom.enabled();\n        this._map.doubleClickZoom.disable();\n\n        DomEvent\n            .on(this._map, 'mousemove', this._mouseMove, this)\n            .on(this._map, 'click', this._mouseClick, this)\n            .on(this._map, 'dblclick', this._finishPath, this)\n            //.on( (document as Document), 'keydown', this._onKeyDown, this);\n\n        if(!this._layerPaint) {\n            this._layerPaint = layerGroup().addTo(this._map);\n        }\n\n        if(!this._points) {\n            this._points = [];\n        }\n    },\n\n    _stopMeasuring: function() {\n        this._map._container.style.cursor = this._oldCursor;\n\n        DomEvent\n            //.off((document as Document), 'keydown', this._onKeyDown, this)\n            .off(this._map, 'mousemove', this._mouseMove, this)\n            .off(this._map, 'click', this._mouseClick, this)\n            .off(this._map, 'dblclick', this._mouseClick, this);\n\n        if(this._doubleClickZoom) {\n            this._map.doubleClickZoom.enable();\n        }\n\n        if(this._layerPaint) {\n            this._layerPaint.clearLayers();\n        }\n\n        this._restartPath();\n    },\n\n    _mouseMove: function(e) {\n        if(!e.latlng || !this._lastPoint) {\n            return;\n        }\n\n        if(!this._layerPaintPathTemp) {\n            let opts = {\n                color: 'black',\n                weight: 1.5,\n                clickable: false,\n                dashArray: '6,3'\n            } as PolylineOptions;\n            this._layerPaintPathTemp = polyline([this._lastPoint, e.latlng], opts)\n                .addTo(this._layerPaint);\n        } else {\n            this._layerPaintPathTemp.spliceLatLngs(0, 2, this._lastPoint, e.latlng);\n        }\n\n        if(this._tooltip) {\n            if(!this._distance) {\n                this._distance = 0;\n            }\n\n            this._updateTooltipPosition(e.latlng);\n\n            var distance = e.latlng.distanceTo(this._lastPoint);\n            this._updateTooltipDistance(this._distance + distance, distance);\n        }\n    },\n\n    _mouseClick: function(e) {\n        // Skip if no coordinates\n        if(!e.latlng) {\n            return;\n        }\n\n        // If we have a tooltip, update the distance and create a new tooltip, leaving the old one exactly where it is (i.e. where the user has clicked)\n        if(this._lastPoint && this._tooltip) {\n            if(!this._distance) {\n                this._distance = 0;\n            }\n\n            this._updateTooltipPosition(e.latlng);\n\n            var distance = e.latlng.distanceTo(this._lastPoint);\n            this._updateTooltipDistance(this._distance + distance, distance);\n\n            this._distance += distance;\n        }\n        this._createTooltip(e.latlng);\n\n\n        // If this is already the second click, add the location to the fix path (create one first if we don't have one)\n        if(this._lastPoint && !this._layerPaintPath) {\n            let opts = {\n                color: 'black',\n                weight: 2,\n                clickable: false\n            } as PolylineOptions;\n            this._layerPaintPath = polyline([this._lastPoint], opts).addTo(this._layerPaint);\n        }\n\n        if(this._layerPaintPath) {\n            this._layerPaintPath.addLatLng(e.latlng);\n        }\n\n        // Upate the end marker to the current location\n        if(this._lastCircle) {\n            this._layerPaint.removeLayer(this._lastCircle);\n        }\n\n        let markerOpts = {\n            color: 'black',\n            opacity: 1,\n            weight: 1,\n            fill: true,\n            fillOpacity: 1,\n            radius:2,\n            clickable: this._lastCircle ? true : false\n        } as CircleMarkerOptions;\n        this._lastCircle = new CircleMarker(e.latlng, markerOpts).addTo(this._layerPaint);\n\n        this._lastCircle.on('click', function() { this._finishPath(); }, this);\n\n        // Save current location as last location\n        this._lastPoint = e.latlng;\n    },\n\n    _finishPath: function() {\n        // Remove the last end marker as well as the last (moving tooltip)\n        if(this._lastCircle) {\n            this._layerPaint.removeLayer(this._lastCircle);\n        }\n        if(this._tooltip) {\n            this._layerPaint.removeLayer(this._tooltip);\n        }\n        if(this._layerPaint && this._layerPaintPathTemp) {\n            this._layerPaint.removeLayer(this._layerPaintPathTemp);\n        }\n\n        // Reset everything\n        this._restartPath();\n    },\n\n    _restartPath: function() {\n        this._distance = 0;\n        this._tooltip = undefined;\n        this._lastCircle = undefined;\n        this._lastPoint = undefined;\n        this._layerPaintPath = undefined;\n        this._layerPaintPathTemp = undefined;\n    },\n\n    _createTooltip: function(position) {\n        var icon = divIcon({\n            className: 'leaflet-measure-tooltip',\n            iconAnchor: [-5, -5]\n        });\n        this._tooltip = marker(position, {\n            icon: icon,\n            clickable: false\n        }).addTo(this._layerPaint);\n    },\n\n    _updateTooltipPosition: function(position) {\n        this._tooltip.setLatLng(position);\n    },\n\n    _updateTooltipDistance: function(total, difference) {\n        var totalRound = this._round(total),\n            differenceRound = this._round(difference);\n\n        var text = '<div class=\"leaflet-measure-tooltip-total\">' + totalRound + ' nm</div>';\n        if(differenceRound > 0 && totalRound != differenceRound) {\n            text += '<div class=\"leaflet-measure-tooltip-difference\">(+' + differenceRound + ' nm)</div>';\n        }\n\n        this._tooltip._icon.innerHTML = text;\n    },\n\n    _round: function(val) {\n        return Math.round((val / 1852) * 10) / 10;\n    },\n\n    _onKeyDown: function (e) {\n        if(e.keyCode == 27) {\n            // If not in path exit measuring mode, else just finish path\n            if(!this._lastPoint) {\n                this._toggleMeasure();\n            } else {\n                this._finishPath();\n            }\n        }\n    }\n});\n\n\nif( (window as any).L) {\n    const L = (window as any).L;\n    L.Control.Measure = measureControl;\n    L.control.measure = function (options) {\n        return new L.Control.Measure(options);\n    };\n}\n\nMap.mergeOptions({\n    measureControl: false\n});\n\nMap.addInitHook(function () {\n    if (this.options.measureControl) {\n        this.measureControl = new measureControl();\n        this.addControl(this.measureControl);\n    }\n});\n\n\nexport default measureControl;\n","\nimport {\n    Control, control, DomUtil, DomEvent, Util, Map\n} from 'leaflet';\n\n\nvar positionControl = Control.extend({\n  options: {\n    position: 'bottomleft',\n    separator: ' : ',\n    emptyString: 'Unavailable',\n    lngFirst: false,\n    numDigits: 6,\n    lngFormatter: undefined,\n    latFormatter: undefined,\n    prefix: \"\"\n  },\n\n  onAdd: function (map) {\n    this._container = DomUtil.create('div', 'leaflet-control-mouseposition');\n    DomEvent.disableClickPropagation(this._container);\n    map.on('mousemove', this._onMouseMove, this);\n    this._container.innerHTML=this.options.emptyString;\n    return this._container;\n  },\n\n  onRemove: function (map) {\n    map.off('mousemove', this._onMouseMove);\n  },\n\n  _onMouseMove: function (e) {\n    var lng = this.options.lngFormatter ? this.options.lngFormatter(e.latlng.lng) : Util.formatNum(e.latlng.lng, this.options.numDigits);\n    var lat = this.options.latFormatter ? this.options.latFormatter(e.latlng.lat) : Util.formatNum(e.latlng.lat, this.options.numDigits);\n    var value = this.options.lngFirst ? lng + this.options.separator + lat : lat + this.options.separator + lng;\n    var prefixAndValue = this.options.prefix + ' ' + value;\n    this._container.innerHTML = prefixAndValue;\n  }\n\n});\n\n// if( (window as any).L) {\n//     const L = (window as any).L;\n//     L.Control.MousePosition =  positionControl;\n//     L.control.mousePosition = function (options) {\n//         return new L.Control.MousePosition(options);\n//     };\n// }\n(Control as any).MousePosition =  positionControl;\n(control as any).mousePosition = function (options) {\n    return new (Control as any).MousePosition(options);\n};\n\nMap.mergeOptions({\n    positionControl: false\n});\n\nMap.addInitHook(function () {\n    if (this.options.positionControl) {\n        this.positionControl = new positionControl();\n        this.addControl(this.positionControl);\n    }\n});\n\nexport default positionControl;\n","\n\nimport {\n    Map, Layer, FeatureGroup, Control, GeoJSON, popup,\n    Util, DomUtil, DomEvent, Evented, ControlOptions\n} from 'leaflet';\nimport { Draw } from 'leaflet-draw';\n// import * as L from 'leaflet';   //for Leaflet.Draw\n// const Draw = L.Draw;\n// const EditHandler = Draw.EditToolbar.Edit;\n\n\n\nimport MapInstance from '../map/instance';\n\n\n\ninterface EditControlOptions extends ControlOptions {\n    featureGroup : FeatureGroup\n}\n\ninterface FeatureLayer extends Layer {\n    feature : any;\n    geometry : any;\n    properties : {\n        [key:string]: any;\n        id : string;\n    }\n    toGeoJSON() : any;\n    setStyle( args : any );\n}\n\n\nexport default class FeatureEditor {\n\n\n    private map : MapInstance;\n    private feature : FeatureLayer;\n    private originalFeature: FeatureLayer;\n    private editingLayer : FeatureGroup;\n    private tool : EditFeature;\n    private visible : boolean;\n\n\n    constructor( map : MapInstance, feature : FeatureLayer, options ?: any ) {\n        this.map = map;\n        this.feature = feature;\n        this.visible = false;\n    }\n\n\n    /**\n     *\n     */\n    disable () {\n        this.doneEditing(false);\n        this.unregisterTool();\n    }\n\n    /**\n     *\n     */\n    unregisterTool() {\n        if(this.tool) {\n            this.tool.deactivate();\n            let map = this.map.getMap();\n            map.removeControl(this.tool);\n            map.removeLayer(this.editingLayer);\n        }\n    }\n\n    /**\n     * @param bool - flag specifying the visibility of the original feature being edited\n     */\n    showOriginalLayer(bool) {\n        if(!this.feature) return;\n        let id = this.feature.properties.id;\n        let layer = this.map.getFeatureLayer(id);\n        this.map.setFeatureVisibility(layer, bool);\n    }\n\n    /**\n     *\n     */\n    beginEditing() {\n\n        if(!this.visible) return;\n\n        this.originalFeature = GeoJSON.geometryToLayer(this.feature.toGeoJSON()) as FeatureLayer;\n        this.feature.properties._editing=true;\n\n        // get Leaflet.Map from instance\n        let map = this.map.getMap();\n\n        // find feature layer for specific feature\n        let feature = this.map.getFeatureLayer(this.feature.properties.id);\n        if(!feature) return;\n\n        //clone feature layer and wrap with FeatureGroup\n        // because Leaflet.Draw requires edited features\n        // be within a FeatureGroup\n        let editingLayer = this.editingLayer = new FeatureGroup().addTo(map);\n\n        //if the feature being edited is a multi-geometry\n        // (\"MultiPoint\", \"MultiLineString\", \"MultiPolygon\", \"GeometryCollection\")\n        // then we need to split them up into individual geometries and\n        // add them as separate layers which will all be editable\n        if (this.feature.geometry.type.indexOf(\"Multi\")===0) {\n            let type = this.feature.geometry.type.replace(\"Multi\",\"\");\n            this.feature.geometry.coordinates.each( (childCoords) => {\n                let shape = {type:type, coordinates: childCoords};\n                new GeoJSON(shape, {\n                    onEachFeature: (feature, layer) => {\n                        editingLayer.addLayer(layer);\n                    }\n                });\n            });\n\n        } else if(this.feature.geometry.type === 'GeometryCollection') {\n            this.feature.geometry.geometries.each( (childGeometry) => {\n                new GeoJSON(childGeometry, {\n                    onEachFeature:   (feature, layer) => {\n                        editingLayer.addLayer(layer);\n                    }\n                });\n            });\n\n        } else {\n            new GeoJSON(feature.toGeoJSON()).eachLayer( (layer) => {\n                editingLayer.addLayer(layer);\n            });\n        }\n\n        //make this feature invisible\n        this.showOriginalLayer(false);\n\n        //register LeafletDraw control with Edit mode only\n        // using just the feature layer identified\n        this.tool = new EditFeature({\n            featureGroup: editingLayer\n        } as ControlOptions).addTo(map);\n        this.tool.activate();\n\n    }\n\n    /**\n     * @param save - flag specifying whether to persist changes to the feature\n     */\n    doneEditing( save ?: boolean ) {\n\n        this.feature.properties._editing = false;\n\n        if(typeof(save) === 'undefined' || save) {\n\n            //if geometry changed\n            if(this.tool && this.tool.hasBeenEdited()) {\n\n                let isMulti = ~this.feature.geometry.type.indexOf(\"Multi\");\n                let isGeomColl = this.feature.geometry.type === 'GeometryCollection';\n                let geoms = [], coords = [], geometry;\n                this.editingLayer.eachLayer( (layer : Layer) => {\n                    let feature = (layer as FeatureLayer).toGeoJSON();\n                    geometry = feature.geometry;\n                    if(isMulti) {\n                        coords[coords.length] = geometry.coordinates;\n                    } else if(isGeomColl) {\n                        geoms[geoms.length] = feature;\n                    }\n                });\n\n                //update existing feature with edited information\n                if(isMulti)\n                    this.feature.geometry.coordinates = coords;\n                else if(isGeomColl)\n                    this.feature.geometry.geometries = geoms;\n                else\n                    this.feature.geometry = geometry;\n\n                //inform Map of change\n                this.map.replaceFeature(this.feature);\n\n            } else {\n                //restore original layer\n                this.showOriginalLayer(true);\n\n                //redraw feature with new style info\n                this.map.updateFeature(this.feature);\n            }\n\n        } else {\n            //restore original layer (only if feature is to be visible)\n            this.showOriginalLayer(this.visible);\n\n            //Redraw feature which has been updated with\n            // original style information (reset)\n            this.map.updateFeature(this.feature);\n        }\n\n        //lastly, break down the editing tool\n        if(this.tool) this.unregisterTool();\n\n    }\n\n    /**\n     *\n     */\n    addProperty() {\n\n    }\n\n    /**\n     *\n     */\n    highlightFeature() {\n        this.map.focusFeature(this.feature.properties.id);\n    }\n\n    /**\n     *\n     */\n    deleteFeature() {\n        this.map.removeFeature(this.feature.properties.id);\n    }\n\n    /**\n     * update rendered feature with latest info\n     */\n    updateFeature() {\n\n        //if not editing a temporary feature...\n        if(!this.editingLayer)\n            this.map.updateFeature(this.feature);\n\n        else {\n\n            //don't need to update existing rendered feature\n            // because it's been hidden and a temporary 'editing' version\n            // is on the map. So we need to update that instead.\n            // this.map.updateFeature(this.feature);\n\n\n            //update 'editing' version of the feature in question\n\n            let style = this.feature.properties.style;\n            this.editingLayer.eachLayer( (layer : Layer) => {\n                //do nothing for markers\n                if((layer as FeatureLayer).feature.geometry.type !== 'Point') {\n                    (layer as FeatureLayer).setStyle(style);\n                }\n            });\n\n        }\n\n    }\n\n    /**\n     *\n     */\n    cancelEditing () {\n        this.feature = this.originalFeature;\n        this.doneEditing(false);\n    }\n\n}\n\n\n\n\n\n\n\n\n\n/**\n *\n */\nclass EditFeature extends Control {\n\n    private map : Map;\n    private enabled : boolean;\n    private handler : Draw.EditToolbar.Edit;\n\n    constructor( options ?: any ) {\n        super( Object.assign( {\n                position: 'bottomright',\n                draw: false,\n                edit: false\n            }, options || {})\n        );\n    }\n\n    onAdd (map : Map) {\n        this.map = map;\n        this.enabled = false;\n\n        let opts = { };\n        //needed or else L.EditToolbar.Edit fails to addHooks for PolyLine features\n        (opts as any).selectedPathOptions = {\n            dashArray: '10, 10',\n            fill: true,\n            fillColor: '#fe57a1',\n            fillOpacity: 0.1,\n            // Whether to user the existing layers color\n            maintainColor: false\n        };\n        (opts as any).featureGroup = (this.options as any).featureGroup;\n\n        this.handler = new Draw.EditToolbar.Edit(map, opts);\n\n        var container = DomUtil.create('div', 'leaflet-edit-feature');\n        return container;\n    }\n\n    onRemove (map : Map) {\n        this.deactivate();\n    }\n\n    activate() {\n        this.enabled = true;\n        this.handler.enable();\n    }\n\n    deactivate() {\n        this.enabled = false;\n        this.handler.disable();\n    }\n\n    hasBeenEdited() {\n        var result = false;\n        if((this.options as any).featureGroup) {\n            (this.options as any).featureGroup.eachLayer(function(layer) {\n                result = result || layer.edited;\n            });\n        }\n        return result;\n    }\n\n}\n\n\n\n\n\n\n\n\n\n\n\n// import {\n//     Map, Layer, FeatureGroup, Control, GeoJSON, popup,\n//     Util, DomUtil, DomEvent, Evented\n// } from 'leaflet';\n// import * as Editable from \"leaflet-editable\";\n//\n// import MapInstance from '../map/instance';\n//\n//\n//\n//\n//\n// const CALLBACKS = {\n//     'marker'    : 'startMarker',\n//     'line'      : 'startPolyline',\n//     'polygon'   : 'startPolygon',\n//     'rectangle' : 'startRectangle',\n//     'circle'    : 'startCircle'\n// };\n//\n//\n// export const Events = {\n//     FEATURE_CREATED: 'feature:created',\n//     FEATURE_REMOVED: 'feature:removed',\n//     FEATURE_EDITED: 'feature:edited'\n// };\n//\n//\n// export default class FeatureEditor extends Evented {\n//\n//     private map : MapInstance;\n//     private editor : Editable;\n//     private editLayer : FeatureGroup;\n//     private featuresLayer : FeatureGroup;\n//\n//     constructor(map : MapInstance, options ?: any) {\n//         super();\n//\n//         this.map = map;\n//\n//         let leafletMap : Map = map.getMap();\n//         if(!leafletMap) throw new Error(\"No Leaflet map is configured\");\n//\n//         this.featuresLayer = map.getFeatureLayer();\n//\n//         this.editLayer = new FeatureGroup();\n//         this.editLayer.addTo(leafletMap);\n//\n//         let opts : any = {};\n//         Object.assign(opts, options||{}, {\n//             //editLayer : ...\n//             featuresLayer : this.editLayer //map.getFeatureLayer()\n//             // drawingCSSClass: 'leaflet-editable-drawing',\n//             // drawingCursor: 'crosshair',\n//             // skipMiddleMarkers: true\n//         });\n//\n//         //create and register editable instance on leaflet map\n//         let editor = new Editable(leafletMap, opts);\n//         (leafletMap as any).editTools = editor;\n//         this.editor = editor;\n//\n//         this.editor.on('editable:drawing:end', (event : any) => {\n//             //have to wrap handler in a timeout in order to not inadvertently\n//             // block the clean up of event handlers within Editable\n//             setTimeout(() => { this.onFeatureCreated(event) },50);\n//         });\n//         // this.editor.on('editable:editing', (event : any) => { this.onFeatureEdited(event) })\n//\n//         this.editor.on('editable:drawing:start', (event: any) => console.log(\"Drawing Start\") );\n//         this.editor.on('editable:drawing:end', (event: any) => console.log(\"Drawing End\") );\n//         this.editor.on('editable:drawing:cancel', (event: any) => console.log(\"Drawing Cancel\") );\n//         this.editor.on('editable:drawing:commit', (event: any) => console.log(\"Drawing Commit\") );\n//\n//         this.editor.on(\n//             'editable:drawing:start editable:drawing:end ' +\n//             'editable:drawing:cancel editable:drawing:commit ' +\n//             'editable:drawing:mousedown editable:drawing:mouseup ' +\n//             'editable:drawing:click editable:drawing:move ' +\n//             'editable:drawing:clicked',\n//             (event : any) => {\n//                 console.log(\"Editor event: \" + event.type);\n//                 if(event.layer && event.layer.options.popup) {\n//                     this.updateFeaturePopup(event.layer, event.layer.options.popup);\n//                 }\n//             }\n//         );\n//\n//         this.editor.on(\n//             'editable:vertex:new editable:vertex:click ' +\n//             'editable:vertex:clicked editable:vertex:rawclick ' +\n//             'editable:vertex:deleted editable:vertex:ctrlclick ' +\n//             'editable:vertex:shiftclick editable:vertex:metakeyclick ' +\n//             'editable:vertex:altclick editable:vertex:contextmenu ' +\n//             'editable:vertex:mousedown editable:vertex:drag ' +\n//             'editable:vertex:dragstart editable:vertex:dragend ' +\n//             'editable:middlemarker:mousedown',\n//             (event : any) => {\n//                 console.log(\"Vertex event: \" + event.type);\n//                 // if(event.layer && event.layer.options.popup) {\n//                 //     this.updateFeaturePopup(event.layer, event.layer.options.popup);\n//                 // }\n//             }\n//         );\n//\n//         if(opts.marker) {\n//             leafletMap.addControl(new EditControl({\n//                 position: opts.position || 'topleft',\n//                 callback: editor[CALLBACKS.marker],\n//                 kind: 'marker',\n//                 html: opts.marker.icon ? opts.marker.icon : 'ð'\n//             }));\n//         }\n//         if(opts.line) {\n//             leafletMap.addControl(new EditControl({\n//                 position: opts.position || 'topleft',\n//                 callback: editor[CALLBACKS.line],\n//                 kind: 'line',\n//                 html: opts.line.icon ? opts.line.icon : '\\\\/\\\\'\n//             }));\n//         }\n//         if(opts.polygon) {\n//             leafletMap.addControl(new EditControl({\n//                 position: opts.position || 'topleft',\n//                 callback: editor[CALLBACKS.polygon],\n//                 kind: 'polygon',\n//                 html: opts.polygon.icon ? opts.polygon.icon : 'â°'\n//             }));\n//         }\n//         if(opts.rectangle) {\n//             leafletMap.addControl(new EditControl({\n//                 position: opts.position || 'topleft',\n//                 callback: editor[CALLBACKS.rectangle],\n//                 kind: 'rectangle',\n//                 html: opts.rectangle.icon ? opts.rectangle.icon : 'â¬'\n//             }));\n//         }\n//         if(opts.circle) {\n//             leafletMap.addControl(new EditControl({\n//                 position: opts.position || 'topleft',\n//                 callback: editor[CALLBACKS.circle],\n//                 kind: 'circle',\n//                 html: opts.circle.icon ? opts.circle.icon : 'â¬¤'\n//             }));\n//         }\n//     }\n//\n//     isDrawing() : boolean {\n//         return this.editor ? this.editor.drawing() : false;\n//     }\n//\n//     cancel() {\n//         if(this.editor) this.editor.stopDrawing();\n//     }\n//\n//     /**\n//      * @param feature Feature to be edited\n//      */\n//     enableFeatureEdit( feature : any ) {\n//         if(!feature) return;\n//\n//         if(!feature.properties) feature.properties = {};\n//\n//         let fid =  this.getFeatureId(feature, true);\n//\n//         //make a clone of the feature to be edited\n//         let json = (feature as any).toGeoJSON();\n//         let editedLayer = GeoJSON.geometryToLayer(json);\n//         Util.setOptions(editedLayer, { originalLayerId : fid });\n//\n//         //hide that feature on featuresLayer\n//         this.map.setFeatureVisibility(feature, false);\n//\n//         //and add the editble clone of it to the edit layer\n//         this.editLayer.addLayer(editedLayer);\n//         (editedLayer as any).toggleEdit();\n//     }\n//\n//     /**\n//      * @param feature Feature being edited\n//      */\n//     applyFeatureEdit( feature : any ) {\n//\n//         let editedLayer = this.findEditedFeatureLayer(feature);\n//         if(!editedLayer) return;\n//\n//         (editedLayer as any).toggleEdit();                   //turn off editor\n//\n//         let json = (editedLayer as any).toGeoJSON();\n//         this.editLayer.removeLayer(editedLayer);    //remove from edit layer\n//\n//         // let updatedLayer = GeoJSON.geometryToLayer(json);\n//         this.map.replaceFeature(json);\n//         this.map.setFeatureVisibility(feature, true);\n//\n//     }\n//\n//     /**\n//      * @param feature Feature being edited\n//      */\n//     cancelFeatureEdit( feature : any ) {\n//\n//         let editedLayer = this.findEditedFeatureLayer(feature);\n//         if(!editedLayer) return;\n//\n//         (editedLayer as any).toggleEdit();                   //turn off editor\n//         this.editLayer.removeLayer(editedLayer);    //and remove from edit layer\n//\n//         //re-show the original feature layer\n//         this.map.setFeatureVisibility(feature, true);\n//\n//     }\n//\n//     /**\n//      * @param feature Feature Layer associated with an editable feature\n//      * @return editable Feature Layer assocaited with the specified parameter Feature Layer\n//      */\n//     findEditedFeatureLayer( feature : any ) : Layer {\n//         let editedLayer : Layer = null;\n//         this.editLayer.eachLayer( (layer : any) => {\n//             let fid = this.getFeatureId(layer);\n//             if( !editedLayer && fid == layer.originalLayerId ) {\n//                 editedLayer = layer as Layer;\n//             }\n//         });\n//         return editedLayer;\n//     }\n//\n//     /**\n//      * @param feature Feature\n//      * @param createAsNeeded flag indicating whether to create an ID if feature has none\n//      * @return feature id or null\n//      */\n//     getFeatureId( feature : any , createAsNeeded ?: boolean) : string {\n//         if(!feature) return null;\n//         if(!feature.properties) feature.properties = {};\n//         let featureId = feature.properties.id || null;\n//         if(!featureId && true === createAsNeeded)\n//             featureId = feature.properties.id = Math.round(Math.random()*9999);\n//         return featureId;\n//     }\n//\n//\n//\n//\n//     onFeatureCreated(event : any) {\n//         let feature : any = event.layer;\n//\n//         if( typeof(feature.editEnabled) !== 'undefined' && feature.editEnabled() ) {\n//             feature.toggleEdit();\n//         }\n//\n//         this.editLayer.removeLayer(feature);\n//         if(this.featuresLayer) {\n//             this.featuresLayer.addLayer(feature);\n//             feature.on('dblclick', DomEvent.stop).on('dblclick', () => {\n//\n//                 (feature as any).toggleEdit();\n//\n//                 if(feature.editEnabled()) { //'editable:enable'\n//                     //add a save and cancel btn...\n//\n//                     let latLng = null;\n//                     if(typeof(feature.getLatLng) !== 'undefined') {\n//                         latLng = feature.getLatLng();\n//                     } else if(typeof(feature.getCenter()) !== 'undefined') {\n//                         latLng = feature.getCenter();\n//                     }\n//\n//                     let fp = popup({\n//                         autoClose: false,\n//                         closeButton: false,\n//                         closeOnEscapeKey: false,\n//                         closeOnClick: false\n//                     }).setLatLng(latLng)\n//                     .setContent('<button type=\"button\">Save</button> &nbsp;&nbsp;&nbsp; <button type=\"button\">Cancel</button>')\n//                     .openOn(this.map.getMap());\n//\n//                     Util.setOptions(feature, {popup : fp});\n//\n//                 } else if( feature.options.popup ) {\n//                     feature.options.popup.remove();\n//                     // feature.editor.off('editable:drawing:start,editable:drawing:end,editable:drawing:cancel,editable:drawing:commit,editable:drawing:mousedown,editable:drawing:mouseup,editable:drawing:click,editable:drawing:move,editable:drawing:clicked');\n//\n//                 }\n//             });\n//         }\n//         this.fire(Events.FEATURE_CREATED, feature);\n//     }\n//\n//     onFeatureEdited(event : any) {\n//         let feature = event.layer;\n//         this.fire(Events.FEATURE_EDITED, feature);\n//     }\n//\n//\n//     updateFeaturePopup(feature, popup) {\n//         let latLng = null;\n//         if(typeof(feature.getLatLng) !== 'undefined') {\n//             latLng = feature.getLatLng();\n//         } else if(typeof(feature.getCenter()) !== 'undefined') {\n//             latLng = feature.getCenter();\n//         }\n//         if(latLng)\n//             popup.setLatLng(latLng);\n//     }\n// }\n//\n//\n//\n//\n//\n// class EditControl extends Control {\n//\n//     constructor(options ?: any) {\n//         super(options);\n//     }\n//\n//     initialize (options ?: any) {\n// \t\tUtil.setOptions(this, options);\n//     }\n//\n//     onAdd (map : Map) {\n//         let container : HTMLElement = DomUtil.create('div', 'leaflet-control leaflet-bar'),\n//             activateBtn : HTMLAnchorElement = DomUtil.create('a', '', container) as HTMLAnchorElement;\n//\n//         activateBtn.href = '#';\n//         activateBtn.title = 'Create a new ' + (this.options as any).kind;\n//         activateBtn.innerHTML = (this.options as any).html;\n//\n//         DomEvent.on(activateBtn, 'click', DomEvent.stop)\n//         .on(activateBtn, 'click', function () {\n//             (window as any).LAYER = this.options.callback.call( (map as any).editTools );\n//         }, this);\n//\n//         return container;\n//     }\n//\n// }\n","\nconst MapResourceTypes = {\n    GeoPlatformMap: \"http://www.geoplatform.gov/ont/openmap/GeoplatformMap\",\n    AGOL: 'http://www.geoplatform.gov/ont/openmap/AGOLMap'\n};\n\nconst LayerResourceTypes = {\n    MapBoxVectorTile : 'http://www.geoplatform.gov/ont/openlayer/MapBoxVectorTileLayer',\n    OSM: 'http://www.geoplatform.gov/ont/openlayer/OSMLayer',\n    BaseLayer: 'http://www.geoplatform.gov/ont/openlayer/BaseLayer'\n};\n\nconst ServiceResourceTypes = {\n    WMS: 'http://opengis.net/spec/wms',\n    WMTS: 'http://opengis.net/spec/wmts',\n    WMST: 'http://www.geoplatform.gov/spec/ogc-wms-t',\n    WFS: 'http://opengis.net/spec/wfs',\n    WCS: 'http://opengis.net/spec/wcs',\n    CSW: 'http://opengis.net/spec/csw',\n    FEED: 'http://www.geoplatform.gov/spec/feed',\n    EsriTile: 'http://www.geoplatform.gov/spec/esri-tile-rest',\n    EsriMap: 'http://www.geoplatform.gov/spec/esri-map-rest',\n    EsriImage: 'http://www.geoplatform.gov/spec/esri-image-rest',\n    EsriFeature: 'http://www.geoplatform.gov/spec/esri-feature-rest'\n};\n\nexport {\n    MapResourceTypes,\n    LayerResourceTypes,\n    ServiceResourceTypes\n}\n","\nimport * as Q from \"q\";\nimport { LayerResourceTypes } from \"../shared/resource-types\";\nimport {\n    QueryFactory, LayerService, XHRHttpClient, Config\n}  from '@geoplatform/client';\n\n\n/**\n * @param {LayerService} layerService - optional, GeoPlatform Layer service to use to fetch the layer\n * @return {Promise} resolving OpenStreet Map GeoPlatform Layer\n */\nexport default {\n\n    /**\n     * @param {Object} layer - GeoPlatform Layer object\n     * @return {boolean} true if is an OSM layer\n     */\n    test : function(layer) {\n        return  layer &&\n                layer.resourceTypes &&\n                layer.resourceTypes.length &&\n                ~layer.resourceTypes.indexOf(LayerResourceTypes.OSM);\n    },\n\n    get : function(layerService ?: LayerService) : any {\n        let query = QueryFactory()\n            .fields('*')\n            .resourceTypes(LayerResourceTypes.OSM);\n        if(!layerService)\n            layerService = new LayerService(Config.ualUrl, new XHRHttpClient());\n        return layerService.search(query)\n        .then( response => response.results.length ? response.results[0] : null);\n    }\n\n};\n","\nimport * as Q from 'q';\nimport OSM from './osm';\nimport { Config, LayerService, XHRHttpClient } from '@geoplatform/client';\n\n\nconst WORLD_STREET_LAYER = '86a8babde086689e21248669ba4ed579';\n\nvar DefaultBaseLayer = {\n\n    get: function(layerService : LayerService) {\n        if(!layerService) {\n            layerService = new LayerService(Config.ualUrl, new XHRHttpClient());\n        }\n        let baseLayerId = Config.defaultBaseLayerId || WORLD_STREET_LAYER;\n        return layerService.get(baseLayerId)\n            .catch( (e : Error) => {\n                return OSM.get();\n            });\n    },\n\n    set: function(layer : any) {\n        let id = null;\n        if(layer && layer.id) id = layer.id;\n        else if(layer && typeof(layer) === 'string') id = layer;\n        if(id) {\n            Config.configure({'defaultBaseLayerId': layer.id});\n        }\n    }\n};\n\nexport default DefaultBaseLayer;\n","\nimport * as Q from \"q\";\nimport {\n    ItemService, XHRHttpClient, QueryFactory, Config\n} from '@geoplatform/client';\n\n\n\nconst ogcExpr = /OGC.+\\(([A-Z\\-]+)\\)/;\nconst esriExpr = /Esri REST ([A-Za-z]+) Service/;\nconst keyFn = (expr, str) => {\n    let m = expr.exec(str);\n    return (m && m.length) ? m[1] : null;\n};\n\nvar types = {\n\n    ESRI_FEATURE_SERVER: {\n        \"id\":\"48980c5bad0c8d4666b393874eb5279a\",\n        \"uri\":\"http://www.geoplatform.gov/spec/esri-feature-rest\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"Esri ArcGIS Feature Server REST API\",\n        \"label\":\"Esri REST Feature Service\"\n    },\n\n    ESRI_IMAGE_SERVER: {\n        \"id\":\"bcdf764e52064c84323f3f1baea7e245\",\n        \"uri\":\"http://www.geoplatform.gov/spec/esri-image-rest\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"Esri ArcGIS Image Server REST API\",\n        \"label\":\"Esri REST Image Service\"\n    },\n\n    ESRI_MAP_SERVER: {\n        \"id\":\"370cf6ca5d91c07b63329b8384fe76c7\",\n        \"uri\":\"http://www.geoplatform.gov/spec/esri-map-rest\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"Esri ArcGIS Map Server REST API\",\n        \"label\":\"Esri REST Map Service\"\n    },\n\n    ESRI_TILE_SERVER: {\n        \"id\": \"c75570ff2523b1a1631afe7ddac27beb\",\n        \"uri\": \"http://www.geoplatform.gov/spec/esri-tile-rest\",\n        \"type\": \"dct:Standard\",\n        \"description\": \"Esri ArcGIS Tile Server REST API\",\n        \"label\": \"Esri REST Tile Service\"\n    },\n\n    KML: {\n        \"id\":\"c0b39ca2049ba2184472ff27408ffd7e\",\n        \"uri\":\"http://opengis.net/spec/kml\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"OGC Keyhole Markup Language (KML)\",\n        \"label\":\"OGC Keyhole Markup Language (KML)\"\n    },\n\n    CSW: {\n        \"id\":\"60de6a422475493b7901ae453d6f4562\",\n        \"uri\":\"http://opengis.net/spec/csw\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"OGC Web Catalog Service (CSW)\",\n        \"label\":\"OGC Web Catalog Service (CSW)\"\n    },\n\n    WCS: {\n        \"id\":\"a7e5a2d81a83d4eae9bf9138f24d0a32\",\n        \"uri\":\"http://opengis.net/spec/wcs\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"OGC Web Coverage Service (WCS)\",\n        \"label\":\"OGC Web Coverage Service (WCS)\"\n    },\n\n    WFS: {\n        \"id\":\"e70e43ed52f83634285a09e959734bff\",\n        \"uri\":\"http://opengis.net/spec/wfs\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"OGC Web Feature Service (WFS)\",\n        \"label\":\"OGC Web Feature Service (WFS)\"\n    },\n\n    WMS: {\n        \"id\":\"abed5a00c536fb2d7019092c37ed634c\",\n        \"uri\":\"http://opengis.net/spec/wms\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"OGC Web Map Service (WMS)\",\n        \"label\":\"OGC Web Map Service (WMS)\"\n    },\n\n    WMTS: {\n        \"id\":\"757858ae77cf8c602b39294c27632dd7\",\n        \"uri\":\"http://opengis.net/spec/wmts\",\n        \"type\":\"dct:Standard\",\n        \"description\":\"OGC Web Map Tile Service (WMTS)\",\n        \"label\":\"OGC Web Map Tile Service (WMTS)\"\n    },\n\n    WMST: {\n        \"id\": \"faae5bff49b1144d500380cbc055c1e5\",\n        \"uri\": \"http://www.geoplatform.gov/spec/ogc-wms-t\",\n        \"type\": \"dct:Standard\",\n        \"description\": \"OGC WMS support for temporal according to OGC Best Practice guidance\",\n        \"label\": \"OGC WMS-T Service\"\n    },\n\n    FEED: {\n        \"id\": \"8edc61870e534a1f23dc967753da3b72\",\n        \"uri\": \"http://www.geoplatform.gov/spec/feed\",\n        \"type\": \"dct:Standard\",\n        \"description\": \"GeoPlatform GeoJSON Feed Service converts an Atom/RSS feed (including GeoRSS and CAP extensions) to GeoJSON\",\n        \"label\": \"GeoPlatform GeoJSON Feed Service\"\n    },\n\n    //\n    //method to allow refreshing list later\n    refresh: updateList\n};\n\nfunction updateList(service : ItemService) {\n\n    let url = Config.ualUrl;\n    if(!url) {\n        console.log(\"WARN : ServiceTypes - no GeoPlatform API URL configured, unable to load service types\");\n    } else {\n\n        let query = QueryFactory()\n            .types('dct:Standard')\n            .resourceTypes('ServiceType')\n            .pageSize(50);\n\n\n        let svc = null;\n        //if a service was provided to be used, use it\n        if(service && typeof(service.search) !== 'undefined') {\n            svc = service;\n        } else { // otherwise, use defaults\n            svc = new ItemService(url, new XHRHttpClient());\n        }\n\n        svc.search(query).then( data => {\n\n            for(let i=0; i<data.results.length; ++i) {\n\n                let type = data.results[i],\n                    key = null,\n                    label = type.label;\n\n                if(~label.indexOf(\"WMS-T\")) {\n                    key = 'WMST';\n                    type.supported = true;\n\n                } else if(~label.indexOf('OGC')) {\n                    key = keyFn(ogcExpr, label);\n                    type.supported = 'WMS' === key || 'WMTS' === key;\n\n                } else if(~label.indexOf('Esri')) {\n                    key = keyFn(esriExpr, label);\n                    type.supported = true;\n                    key = 'ESRI_' + key.toUpperCase() + '_SERVER';\n\n                } else if(~label.indexOf(\"Feed\")) {\n                    key = \"FEED\";\n                    type.supported = true;\n\n                } else {\n                    key = label;\n\n                }\n\n                types[key] = type;\n            }\n            // console.log(types);\n        })\n        .catch( error => {\n            console.log(\"Error loading supported service types: \" + error.message);\n        });\n    }\n}\n\nexport default types;\n","\n/* jshint ignore:start */\nimport * as MarkerCluster from 'leaflet.markercluster';\nimport \"leaflet.markercluster\";\nimport { Util, MarkerClusterGroup, GeoJSON } from 'leaflet';\nimport * as esri from \"esri-leaflet\";\n\n/* esri-leaflet-cluster - v2.0.0 - Thu Aug 18 2016 17:12:43 GMT-0700 (PDT)\n * Copyright (c) 2016 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nvar version = \"2.0.0\";\n\nvar BaseClusteredFeatureLayer = esri.FeatureManager.extend({\n\n  statics: {\n    EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose',\n    CLUSTEREVENTS: 'clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu'\n  },\n\n  /**\n   * Constructor\n   */\n\n  initialize: function (options) {\n    esri.FeatureManager.prototype.initialize.call(this, options);\n\n    options = Util.setOptions(this, options);\n\n    this._layers = {};\n    this._leafletIds = {};\n\n    this.cluster = new MarkerClusterGroup(options);\n    this._key = 'c' + (Math.random() * 1e9).toString(36).replace('.', '_');\n\n    this.cluster.addEventParent(this);\n  },\n\n  /**\n   * Layer Interface\n   */\n\n  onAdd: function (map) {\n    esri.FeatureManager.prototype.onAdd.call(this, map);\n    this._map.addLayer(this.cluster);\n\n    // NOTE !!!!!!!\n    // Using this type of layer requires map.maxZoom to be set during map creation!\n    // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n  },\n\n  onRemove: function (map) {\n    esri.FeatureManager.prototype.onRemove.call(this, map);\n    this._map.removeLayer(this.cluster);\n  },\n\n  /**\n   * Feature Management Methods\n   */\n\n  createLayers: function (features) {\n    var markers = [];\n\n    for (var i = features.length - 1; i >= 0; i--) {\n      var geojson = features[i];\n      var layer = this._layers[geojson.id];\n\n      if (!layer) {\n        var newLayer : any = GeoJSON.geometryToLayer(geojson, this.options);\n        newLayer.feature = GeoJSON.asFeature(geojson);\n        newLayer.defaultOptions = newLayer.options;\n        newLayer._leaflet_id = this._key + '_' + geojson.id;\n\n        this.resetStyle(newLayer.feature.id);\n\n        // cache the layer\n        this._layers[newLayer.feature.id] = newLayer;\n\n        this._leafletIds[newLayer._leaflet_id] = geojson.id;\n\n        if (this.options.onEachFeature) {\n          this.options.onEachFeature(newLayer.feature, newLayer);\n        }\n\n        this.fire('createfeature', {\n          feature: newLayer.feature\n        });\n\n        // add the layer if it is within the time bounds or our layer is not time enabled\n        if (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson))) {\n          markers.push(newLayer);\n        }\n      }\n    }\n\n    if (markers.length) {\n      this.cluster.addLayers(markers);\n    }\n  },\n\n  addLayers: function (ids) {\n    var layersToAdd = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var layer = this._layers[ids[i]];\n      this.fire('addfeature', {\n        feature: layer.feature\n      });\n      layersToAdd.push(layer);\n    }\n    this.cluster.addLayers(layersToAdd);\n  },\n\n  removeLayers: function (ids, permanent) {\n    var layersToRemove = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      var layer = this._layers[id];\n      this.fire('removefeature', {\n        feature: layer.feature,\n        permanent: permanent\n      });\n      layersToRemove.push(layer);\n      if (this._layers[id] && permanent) {\n        delete this._layers[id];\n      }\n    }\n    this.cluster.removeLayers(layersToRemove);\n  },\n\n  /**\n   * Styling Methods\n   */\n\n  resetStyle: function (id) {\n    var layer = this._layers[id];\n\n    if (layer) {\n      layer.options = layer.defaultOptions;\n      this.setFeatureStyle(layer.feature.id, this.options.style);\n    }\n\n    return this;\n  },\n\n  setStyle: function (style) {\n    this.eachFeature(function (layer) {\n      this.setFeatureStyle(layer.feature.id, style);\n    }, this);\n    return this;\n  },\n\n  setFeatureStyle: function (id, style) {\n    var layer = this._layers[id];\n\n    if (typeof style === 'function') {\n      style = style(layer.feature);\n    }\n    if (layer.setStyle) {\n      layer.setStyle(style);\n    }\n  },\n\n  /**\n   * Utility Methods\n   */\n\n  eachFeature: function (fn, context) {\n    for (var i in this._layers) {\n      fn.call(context, this._layers[i]);\n    }\n    return this;\n  },\n\n  getFeature: function (id) {\n    return this._layers[id];\n  }\n});\n\n// function featureLayer (options) {\n//   return new FeatureLayer(options);\n// }\n//\n// export {\n//     FeatureLayer,\n//     featureLayer as default,\n//     version as VERSION\n// }\n\nexport default BaseClusteredFeatureLayer;\n","\nimport * as jquery from \"jquery\";\nconst jQuery = jquery;\n\nimport * as Q from \"q\";\nimport { Config } from '@geoplatform/client';\n\n/**\n * Fetches style information from GeoPlatform UAL\n * @param  id - identifier of layer to resolve style for\n */\nfunction featureStyleResolver(id : string) : Promise<{}> {\n\n    return new Promise<{}>( (resolve, reject) => {\n\n        if(!jQuery) {\n            reject(new Error(\"Unable to load feature layer style, jQuery is not installed\"));\n        }\n        jQuery.ajax({\n           url: Config.ualUrl + '/api/layers/' + id + '/style',\n           dataType: 'json',\n           success: function(data) { resolve(data); },\n           error: function(xhr, status, message) {\n               let em = `FeatureStyleResolver() -\n                   Error loading style information for layer ${id} : ${message}`;\n               reject( new Error(em) );\n           }\n        });\n\n    });\n}\n\nexport default featureStyleResolver;\n","\n\nfunction featurePopupTemplate(feature) {\n\n    let props = Object.keys(feature.properties);\n\n    const pFn = function(list, names) {\n        if(!list || !list.find) return null;\n        let match = list.find( name => {\n            let lc = name.toLowerCase();\n            return names.indexOf(lc)>=0;\n        });\n        return match;\n    };\n\n    let titleProp = pFn(props, ['title','name','label']);\n    let title = titleProp ? feature.properties[titleProp] : \"Untitled\";\n\n    let descProp = pFn(props, ['description', 'summary', 'descript']);\n    let description = descProp ? feature.properties[descProp] : \"No description provided\";\n\n    let result = '<div class=\"feature-popup\">' +\n        '<h5>' + title + '</h5>' +\n        '<p>' + description + '</p>';\n\n    if(feature.properties.modified) {\n        let modified = new Date(feature.properties.modified);\n        result += '<div><span class=\"label\">Updated</span><span class=\"value\">' +\n            modified.toDateString() + '</span></div>';\n    }\n\n    if(feature.properties['cap:effective']) {\n        let date = new Date(feature.properties['cap:effective']);\n        result += '<div>' +\n            '<span class=\"label\">Effective</span>' +\n            '<span class=\"value\">' +\n            date.toDateString() + ' ' + date.toTimeString() +\n            '</span>' +\n            '</div>';\n    }\n    if(feature.properties['cap:expires']) {\n        let date = new Date(feature.properties['cap:expires']);\n        result += '<div>' +\n            '<span class=\"label\">Expires</span>' +\n            '<span class=\"value\">' +\n            date.toDateString() + ' ' + date.toTimeString() +\n            '</span>' +\n            '</div>';\n    }\n\n    let linkProp = pFn(props, ['landingpage','link','website']);\n    if(linkProp) {\n        result += '<br>';\n        result += '<a href=\"' + feature.properties[linkProp] + '\" target=\"_blank\">link</a>';\n    }\n\n    result += '<hr>';\n\n    for(let prop in feature.properties) {\n        if(titleProp === prop || descProp === prop ||\n            linkProp === prop || 'modified' === prop)\n            continue;\n        let value = feature.properties[prop];\n        if(typeof(value) === 'object') {\n            for(let p in value) {\n                result += '<div>' +\n                    '<span class=\"label\">' + prop + '.' + p + '</span>' +\n                    '<span class=\"value\">' + value[p] + '</span>' +\n                    '</div>';\n            }\n        } else {\n            result += '<div>' +\n                '<span class=\"label\">' + prop + '</span>' +\n                '<span class=\"value\">' + value + '</span>' +\n                '</div>';\n        }\n    }\n    result += '</div>';\n    return result;\n}\n\nexport default featurePopupTemplate;\n","\nimport * as jquery from \"jquery\";\nconst jQuery = jquery;\n\nimport { Config } from '@geoplatform/client';\n\nimport {\n    Control,\n    icon as iconFn,\n    marker as markerFn,\n    circleMarker as circleMarkerFn,\n    SVG, svg, Canvas, canvas,\n    Util,\n    Layer\n} from 'leaflet';\n\nimport BaseClusteredFeatureLayer from './base-clustered-feature-layer';\nimport featureStyleResolver from '../shared/style-resolver';\nimport featurePopupTemplate from '../shared/popup-template';\n\n\n/**\n * Clustered Feature Layer\n * Provides custom style loading and point-ilization as well\n * as adding visibility and opacity manipulation methods\n */\nvar ClusteredFeatureLayer = BaseClusteredFeatureLayer.extend({\n\n    currentVisibility: true,\n    currentOpacity: 1.0,\n\n    _gpStyle : { color: \"#00f\", weight: 2, fillColor: '#00f', fillOpacity: 0.3 },\n\n    /**\n     * @param {object} feature - GeoJSON Point Feature\n     * @param {L.LatLng} latlng\n     * @return {L.Marker}\n     */\n    pointToLayerFn: function (feature, latlng) {\n\n        var style = feature && feature.properties ? feature.properties.style : null;\n        if(!style && typeof this.options.style === 'function') {\n            // console.log(\"Using local style function\");\n            try {\n                style = this.options.style(feature);\n            } catch(e) {\n                console.log(\"error using style function in ClusteredFeatureLayer: \" + e.message);\n            }\n        }\n\n        style = style || this.options.style || {};\n        style.radius      = style['stroke-width'] || style.radius || 4;\n        style.weight      = style['stroke-width'] || style.weight || 2;\n        style.color       = style.stroke || style.color || '#03f';\n        style.opacity     = style['stroke-opacity'] || style.opacity || 0.9;\n        style.fillOpacity = style['fill-opacity'] || style.opacity || 0.3;\n        style.fillColor   = style.fill || style.color || '#03f';\n        style.renderer    = this.options.renderer;  //important for pane!\n\n        let marker = null;\n        if(style.shape === 'image') {\n            let width = style.width || 16;\n            let height = style.height || 16;\n            var icon = iconFn( {\n                iconUrl: style.content, //base64 encoded string\n                iconSize: [width, height],\n                iconAnchor: [width*0.5, height*0.5],\n                popupAnchor: [0, -11],\n            });\n            let mopts = { icon: icon };\n            if(Config.leafletPane) (mopts as any).pane = Config.leafletPane;\n            marker = markerFn( latlng, mopts);\n        } else {\n            marker = circleMarkerFn(latlng, style);\n        }\n\n        let popupTemplate = this.options.popupTemplate || featurePopupTemplate;\n        marker.bindPopup(popupTemplate(feature));\n\n        return marker;\n    },\n\n    /**\n     * for all non-point features, bind a popup\n     * @param {object} feature - GeoJSON feature\n     * @param {L.Layer} layer - layer representing feature\n     */\n    eachFeatureFn: function(feature, layer) {\n        if(!feature || !feature.geometry || feature.geometry.type === 'Point') {\n            return;\n        }\n        layer.bindPopup(featurePopupTemplate(feature));\n    },\n\n\n\n    initialize: function (options) {\n\n        var self = this;\n\n        options = options || {};\n\n        if(Config.leafletPane)\n            options.pane = Config.leafletPane;\n\n        options.pointToLayer = Util.bind(this.pointToLayerFn, this);\n        options.onEachFeature = Util.bind(this.eachFeatureFn, this);\n        // options.fields = ['FID', 'type', 'title', 'geometry'];\n\n        //Increase from 1 to increase the distance away from the center that spiderfied markers are placed.\n        // This needs to be increased to ensure all markers can be clicked\n        // when spiderfied (some get stuck under the spider legs)\n        options.spiderfyDistanceMultiplier = 2;\n\n        let getGPStyle = () => { return this._gpStyle; };\n        options.style = options.style || getGPStyle;\n        if(options.styleResolver) {\n            this.styleResolver = options.styleResolver;\n        }\n\n        //in order to put features-based layers into same pane as tile layers,\n        // must specify renderer and set desired pane on that\n        let svgOpts = { };\n        if(Config.leafletPane)\n            (svgOpts as any).pane = Config.leafletPane;\n        var renderer = (SVG && svg(svgOpts)) || (Canvas && canvas());\n        options.renderer = renderer;\n\n        BaseClusteredFeatureLayer.prototype.initialize.call(this, options);\n\n        this.on('load', function() {\n            if(typeof this.options.zIndex !== 'undefined')\n                this.setZIndex(this.options.zIndex);\n        });\n\n    },\n\n    onAdd: function(map) {\n        BaseClusteredFeatureLayer.prototype.onAdd.call(this, map);\n\n        if(this.options.layerId) {\n            this.loadStyle(this.options.layerId);\n        }\n    },\n\n    /** override super class' method to set viz/opac after sub layers created */\n    createLayers: function (features) {\n        BaseClusteredFeatureLayer.prototype.createLayers.call(this, features);\n        this.setVisibility(this.currentVisibility);\n        this.setOpacity(this.currentOpacity);\n    },\n\n    /**\n     * @param {integer} index\n     */\n    setZIndex : function (index) {\n        this.options.zIndex = index;\n        for(var id in this._layers) {\n\n            let lyr = this._layers[id];\n            if(lyr.setZIndex)\n                lyr.setZIndex(index);\n            else if(lyr._updateZIndex)\n                lyr._updateZIndex(index);\n            else if(lyr._renderer && lyr._renderer._container){\n                lyr._renderer._container.style.zIndex = index;\n            } else {\n                // console.log(\"Clustered feature layer child \" + id + \" does not support ordering using z-index\");\n            }\n        }\n    },\n\n    /** */\n    toggleVisibility: function() {\n\n        this.currentVisibility = !this.currentVisibility;\n        this.setVisibility(this.currentVisibility);\n\n        // //clustered features\n        // if(this.cluster && this.cluster._featureGroup && this.cluster._featureGroup._layers) {\n        //     for(let id in this.cluster._featureGroup._layers) {\n        //         let layer = this.cluster._featureGroup._layers[id];\n        //         if(layer._icon) {\n        //             jQuery(layer._icon).toggleClass('invisible');\n        //         }\n        //     }\n        // }\n        //\n        // //non-clustered features\n        // if(this._layers) {\n        //     for(let id in this._layers)\n        //         this._layers[id].toggleVisibility();\n        // }\n    },\n\n    /**\n     * @param {boolean} bool - flag\n     */\n    setVisibility: function(bool) {\n\n        this.currentVisibility = !!bool;\n\n        if(this.options.renderer._container) {\n            this.options.renderer._container.style.display = bool ? '' : 'none';\n        }\n\n        //clustered features\n        if(this.cluster && this.cluster._featureGroup && this.cluster._featureGroup._layers) {\n            for(let id in this.cluster._featureGroup._layers) {\n                let layer = this.cluster._featureGroup._layers[id];\n                if(layer._icon) {\n                    //probably is a more efficient way to do this,\n                    // but this works currently.\n                    // TODO look at using\n                    //  markerCluster.refreshIconOptions({className:'invisible'});\n                    var icon = jQuery(layer._icon);\n                    if(bool) icon.removeClass('invisible');\n                    else icon.addClass('invisible');\n                }\n            }\n        }\n\n        //non-clustered features\n        if(this._layers) {\n            for(let id in this._layers) {\n                let layer = this._layers[id];\n                if(layer.setVisibility)\n                    layer.setVisibility(bool);\n                else if(layer.setStyle)\n                    layer.setStyle({display: bool ? '':'none'});\n            }\n        }\n    },\n\n    /**\n     * @param {number} opacity\n     */\n    setOpacity: function(opacity) {\n\n        this.currentOpacity = isNaN(opacity) ? 1.0 : opacity*1;\n\n        //clustered features\n        if(this.cluster && this.cluster._featureGroup && this.cluster._featureGroup._layers) {\n            for(let id in this.cluster._featureGroup._layers) {\n                let layer = this.cluster._featureGroup._layers[id];\n                if(layer._icon) {\n                    jQuery(layer._icon).css({opacity: opacity});\n                }\n            }\n        }\n\n        //non-clustered features\n        if(this._layers) {\n            for(let id in this._layers) {\n                let layer = this._layers[id];\n                if(layer.setOpacity)\n                    layer.setOpacity(opacity);\n            }\n        }\n    },\n\n    setStyle: function(style) {\n        this.eachFeature(function (layer) {\n            this.setFeatureStyle(layer.feature.id, style);\n        }, this);\n    },\n\n    loadStyle: function(gpLayerId) {\n\n        if(this.options.styleLoader) {\n            this.options.styleLoader(gpLayerId)\n            .then( json => {\n\n                if(!json) return;\n\n                let style = null;\n\n                if(json && json.styles) {\n\n                    let featureFn = function(feature) {\n\n                        let property = this.property || this.field1;\n                        let v = feature[property] || (feature.properties ? feature.properties[property] : null);\n                        let style = null;\n                        if(this.styles) {\n                            let wrapper = this.styles.find( sw => sw.value === v );\n                            if(wrapper) {\n                                style = wrapper.style;\n                                style.radius = style['stroke-width'] || style.radius || 4;\n                                style.weight = style['stroke-width'] || style.weight || 2;\n                                style.color = style.stroke || style.color || '#03f';\n                                style.opacity = style['stroke-opacity'] || style.opacity || 0.9;\n                                style.fillOpacity = style['fill-opacity'] || style.opacity || 0.3;\n                                style.fillColor = style.fill || style.color || '#03f';\n                            } else {\n                                console.log(\"No matching style for \" + JSON.stringify(feature.properties));\n                            }\n                        }\n                        // console.log(\"Using style: \" + JSON.stringify(style));\n                        return style;\n                    };\n                    let styleFn = () => { return featureFn(json); };\n                    this.options.style = styleFn;\n                    setTimeout( (layer, style) => { layer.setStyle(style); }, 1000, this, styleFn);\n                    return;\n\n                } else if(json && typeof(json.push) !== 'undefined') {\n                    //multiple styles returned\n                    style = json[0];  //use first for now\n\n                } else if(json) {\n                    style = json;\n\n                } else {\n                    return; //unrecognizable style\n                }\n\n                if(style.shape) {\n                    var obj = jQuery.extend({}, style);\n                    obj.style = style;\n                    this._gpStyle = style;\n\n                    //setStyle on Cluster.FeatureLayer doesn't appear to work consistently for\n                    // non-clustered features.\n                    // this.setStyle(obj);\n                    //So instead, we manually set it on all features of the layer (that aren't clustered)\n                    for(let id in this._layers)\n                        this._layers[id].setStyle(obj);\n\n                }\n            })\n            .catch( e => {\n                console.log(\"Error fetching feature layer style\");\n                console.log(e);\n            });\n        }\n    }\n});\n\n\n\n\n/**\n * @param layer - GeoPlatform Layer object\n * @param options - optional properties\n * @return leaflet layer instance or null\n */\nfunction clusteredFeatures(layer, options) : Layer {\n\n    let service = layer.services && layer.services.length ?\n        layer.services[0] : null;\n    if(!service) {\n        let msg = `clusteredFeatures() -\n                  Cannot create leaflet layer for GP Layer:\n                  layer has no service`;\n        throw new Error(msg);\n    }\n\n    let url     = service.href,\n        format  = layer.supportedFormats ? layer.supportedFormats[0] : null;\n\n    let styleResolver = options && options.styleResolver ?\n        options.styleResolver : featureStyleResolver;\n\n    let opts = {\n        url: url + '/' + layer.layerName,\n        styleLoader: styleResolver,\n        layerId: layer.id\n    };\n\n    if(Config.leafletPane) (opts as any).pane = Config.leafletPane;\n    if(options && options.leafletPane) (opts as any).pane = options.leafletPane;\n\n    return new ClusteredFeatureLayer(opts);\n}\n\n\n\n/**\n * @param  layer - GeoPlatform Layer object\n * @param  options - optional properties\n * @return leaflet layer instance or null\n */\nfunction geoJsonFeed(layer, options) : Layer {\n\n    let service = layer.services && layer.services.length ?\n        layer.services[0] : null;\n    if(!service) {\n        let msg = `geoJsonFeed() -\n                  Cannot create leaflet layer for GP Layer:\n                  layer has no service`;\n        throw new Error(msg);\n    }\n\n    let url     = service.href,\n        format  = layer.supportedFormats ? layer.supportedFormats[0] : null;\n\n    let layerUrl = url + (url[url.length-1]==='/'?'':'/') +\n        layer.id + '/FeatureServer/' + layer.layerName;\n\n    let styleUrl = url.replace('feeds','styles') +\n        (url[url.length-1]==='/'?'':'/') + layer.id;\n\n    let styleLoaderFactory = function(url) {\n        return function (layerId) {\n            return new Promise<any>( (resolve, reject) => {\n                if(!jQuery) {\n                    reject(new Error(\"Unable to load GeoJSON feed style, jQuery is not installed\"));\n                }\n                jQuery.ajax(url, {\n                    dataType:'json',\n                    success: function(data) { resolve(data); },\n                    error: function(xhr, status, message) {\n                        let em = `geoJsonFeed() -\n                            Error loading style information for layer ${layerId} : ${message}`;\n                        reject( new Error(em) );\n                    }\n                });\n            });\n        };\n    };\n\n    let opts = {\n        url: layerUrl,\n        isModern: true,         //force to use GeoJSON\n        layerId: layer.id,    //used by style loader\n        styleLoader: styleLoaderFactory(styleUrl)\n    };\n\n    if(Config.leafletPane) (opts as any).pane = Config.leafletPane;\n    if(options && options.leafletPane) (opts as any).pane = options.leafletPane;\n\n    return new ClusteredFeatureLayer(opts);\n\n}\n\n\nexport {\n    ClusteredFeatureLayer as default,\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed\n};\n","\n/// <reference path=\"../../node_modules/@geoplatform/client/dist/shared/models.d.ts\" />\n\nimport * as jquery from \"jquery\";\nconst jQuery = jquery;\n\nimport { Map, TileLayer, tileLayer, LatLng, Util, popup } from 'leaflet';\n\nimport {\n    Config, Layer as LayerModel, Service as ServiceModel\n} from '@geoplatform/client';\n\n\n\nclass WMS extends TileLayer.WMS {\n\n    private _enabled : boolean = false;\n\n    constructor(url : string, opts ?: any) {\n        super(url, opts);\n        this._enabled = false;\n    }\n\n    enableGetFeatureInfo  () {\n        this._map.on('click', this.getFeatureInfo, this);\n        this._enabled = true;\n    }\n\n    disableGetFeatureInfo () {\n        this._map.off('click', this.getFeatureInfo, this);\n        this._enabled = false;\n    }\n\n    isGetFeatureInfoEnabled () {\n        return this._enabled;\n    }\n\n    onRemove (map : Map) : this {\n\n        //if GFI is enabled, disable it before removing\n        if(this.isGetFeatureInfoEnabled())\n        this.disableGetFeatureInfo();\n\n        // Triggered when the layer is removed from a map.\n        //   Unregister a click listener, then do all the upstream WMS things\n        return super.onRemove.call(this, map);\n\n    }\n\n    getFeatureInfo  (evt) {\n        // Make an AJAX request to the server and hope for the best\n        var url = this.getFeatureInfoUrl(evt.latlng),\n        parseGetFeatureInfo = this.parseGetFeatureInfo;\n        jQuery.ajax({\n            url: url,\n            success  (data, status, xhr) {\n                // var err = typeof data === 'string' ? null : data;\n                if(typeof(data) !== 'string')\n                data = parseGetFeatureInfo(data);\n                () => {\n                    this.showGetFeatureInfo(null, evt.latlng, data);\n                }\n            },\n            error  (xhr, status, error) {\n                () => { this.showGetFeatureInfo(error); }\n            }\n        });\n    }\n\n    getFeatureInfoUrl  (latlng : LatLng) {\n        // Construct a GetFeatureInfo request URL given a point\n        var point = this._map.latLngToContainerPoint(latlng),\n        size = this._map.getSize(),\n\n        params = {\n            srs: 'EPSG:4326',\n            bbox: this._map.getBounds().toBBoxString(),\n            height: size.y,\n            width: size.x,\n            // layers: this.wmsParams.layers,\n            // query_layers: this.wmsParams.layers,\n            info_format: 'text/xml',\n            x: point.x,\n            y: point.y,\n            i: point.x, //1.3.0\n            j: point.y  //1.3.0\n        };\n\n        let wmvId = (this.wmsParams as any).wmvId;\n\n        // return this._url + Util.getParamString(params, this._url, true);\n        var url = '/api/layers/' + wmvId + '/feature';\n        return Config.ualUrl + url + Util.getParamString(params, url, true);\n    }\n\n    parseGetFeatureInfo (content) {\n        var fields = [];\n        for(var field in content) {\n            fields.push(['<div><strong>', field, ': </strong>', content[field], '</div>'].join(' '));\n        }\n        if(fields.length == 0)\n        fields.push('<em>No data available</em>');\n        return '<div>' + fields.join(' ') + '</div>';\n    }\n\n    showGetFeatureInfo  (err : Error, latlng : LatLng, content: any) {\n        if (err) { console.log(err); return; } // do nothing if there's an error\n\n        // Otherwise show the content in a popup, or something.\n        popup({ maxWidth: 800})\n        .setLatLng(latlng)\n        .setContent(content)\n        .openOn(this._map);\n    }\n\n}\n\n\nfunction determineWMSFormat( layer : LayerModel ) : string {\n    let formats : string[] = layer.formats;\n    if(formats && formats.length) {\n        //look for common formats that make sense first...\n        let idx = Math.max(\n            formats.indexOf('image/png'),\n            formats.indexOf('image/png32'),\n            formats.indexOf('image/png24'),\n            formats.indexOf('image/png8'),\n            formats.indexOf('image/jpeg')\n        );\n        if(idx >= 0) return formats[idx];\n    }\n    console.log(\"Layer '\" + layer.label + \"' has no formats specified, \" +\n        \"assuming a default of 'image/png'\");\n    return 'image/png';\n}\n\n\n/**\n * short-form function for instantiating a WMS-based Layer's Leaflet instance\n */\nfunction wms(layer : LayerModel) : WMS {\n\n    let service : ServiceModel = layer.services && layer.services.length ?\n        layer.services[0] : null;\n    if(!service) {\n        throw new Error(\"Cannot create leaflet layer for WMS Layer '\" +\n            (layer.label || layer.id) +\n            \"' because layer has no service associated with it\");\n    }\n\n    let url : string = service.href;\n    if(!url) {\n        throw new Error(\"WMS layer's service does not defined a service url\");\n    }\n\n    //pick output format for the raster images\n    let format = determineWMSFormat(layer);\n\n    let supportedCrs = layer.crs || [];\n    if(supportedCrs && supportedCrs.length > 0 && ~supportedCrs.indexOf(\"ESPG:3857\")) {\n        console.log(\"Layer '\" + layer.label + \"' does not support \" +\n            \"EPSG:3857 Spherical Mercator projection and may not render appropriately or at all.\");\n    }\n\n    //determine proper version of the WMS spec to use\n    let version : string = '1.1.1';\n    let versions : string[] = service.serviceTypeVersions || [];\n    if(versions.length && versions.indexOf('1.1.1') < 0) {\n        version = versions[0];\n    } else {\n        console.log(\"Warning: WMS Service doesn't list supported versions, assuming 1.1.1\");\n    }\n\n    let opts : any = {\n        layers      : layer.layerName,\n        transparent : true,\n        format      : format,\n        wmvId       : layer.id,\n        version     : version\n    };\n    if(Config.leafletPane) {\n        (opts as any).pane = Config.leafletPane;\n    }\n\n    return new WMS(url, opts);\n\n}\n\nif( (window as any).L ) {\n    const L = (window as any).L;\n    L.TileLayer.WMS = WMS;\n    L.tileLayer.wms = wms;\n}\n\nexport {\n    WMS as default,\n    WMS,\n    wms\n};\n","\n\nimport * as Q from \"q\";\n\nimport * as L from 'leaflet';\nimport { TileLayer, tileLayer } from 'leaflet';\nimport 'leaflet-timedimension/dist/leaflet.timedimension.src';\n// import { TimeDimension, timeDimension } from \"../libs/L.TimeDimension\";\n\nimport {Config} from '@geoplatform/client';\n\nimport WMS from './wms';\n\n\n\nclass WMST extends (L as any).TimeDimension.Layer.WMS {\n\n    private _baseLayer : TileLayer.WMS\n\n    constructor(layer : TileLayer.WMS, opts ?: any) {\n        super(layer, opts);\n    }\n\n    //override default parser to query all Layers (whether queryable or not)\n    _parseTimeDimensionFromCapabilities (xml) {\n        var layers = xml.querySelectorAll('Layer');\n        var layerName = this._baseLayer.wmsParams.layers;\n        var layer = null;\n        var times = null;\n\n        layers.forEach(function(current) {\n            if (current.querySelector(\"Name\").innerHTML === layerName) {\n                layer = current;\n            }\n        });\n        if (layer) {\n            times = this._getTimesFromLayerCapabilities(layer);\n            if (!times) {\n                times = this._getTimesFromLayerCapabilities(layer.parentNode);\n            }\n        }\n\n        return times;\n    }\n\n    //override default parser to fall back if Dimension is provided but has no values\n    _getTimesFromLayerCapabilities (layer) {\n        var times = null;\n        var dimensions = layer.querySelectorAll(\"Dimension[name='time']\");\n        if (dimensions && dimensions.length && dimensions[0].textContent.length) {\n            times = dimensions[0].textContent.trim();\n        }\n        if(!times || !times.length) {\n            var extents = layer.querySelectorAll(\"Extent[name='time']\");\n            if (extents && extents.length && extents[0].textContent.length) {\n                times = extents[0].textContent.trim();\n            }\n        }\n        if(times && ~times.indexOf(\"current\")) {\n            times = times.replace('current', new Date().toISOString());\n        }\n        return times;\n    }\n\n}\n\n\n\n\nfunction wmst(gpLayer) {\n\n    let service = gpLayer.services[0];\n    let url = service.href;\n\n    if(!url) {\n        throw new Error(\"WMST Layer's service does not defined a service url\");\n    }\n\n    let opts = {\n        layers: gpLayer.layerName,\n        transparent: true,\n        format: \"image/png\",\n        wmvId: gpLayer.layerId\n    };\n    if(Config.leafletPane)\n        (opts as any).pane = Config.leafletPane;\n\n    let leafletLayer = new WMS( url, opts );\n\n    let proxyUrl = Config.ualUrl + '/api/services/' +\n        service.id + '/proxy/capabilities';\n\n    let tdOpts = { times : null };\n\n    if(gpLayer.temporal) {\n\n        let d1 = gpLayer.temporal.startDate ?\n            new Date(gpLayer.temporal.startDate) : new Date();\n        let d2 = gpLayer.temporal.endDate ?\n            new Date(gpLayer.temporal.endDate) : new Date();\n\n        tdOpts.times = d1.toISOString() + '/' + d2.toISOString() + '/P1D';\n    }\n\n    return new WMST(leafletLayer, {\n        timeDimension: new (L as any).TimeDimension(tdOpts),\n        proxy: proxyUrl\n    });\n}\n\nif( (window as any).L ) {\n    const L = (window as any).L;\n    L.TileLayer.WMST = WMST;\n    L.tileLayer.wmst = wmst;\n}\n\nexport {\n    WMST as default,\n    WMST,\n    wmst\n};\n","\n\nimport * as Q from \"q\";\nimport {\n    Map, TileLayer, tileLayer, Browser,\n    Point, Util, LatLng\n} from 'leaflet';\n\nimport { Config } from '@geoplatform/client';\n\n\n\n\nconst paramRe = /\\{ *([\\w_-]+) *\\}/g;\n\n// @function template(str: String, data: Object): String\n// Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\n// and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\n// `('Hello foo, bar')`. You can also specify functions instead of strings for\n// data values â they will be evaluated passing `data` as an argument.\nfunction template(str, data) {\n\treturn str.replace(paramRe, function (str, key) {\n\t\tvar value = data[key];\n        if (value === undefined) {\n            value = data[key.toLowerCase()];\n        }\n        if (value === undefined) {\n        \tthrow new Error('No value provided for variable ' + str);\n\t\t} else if (typeof value === 'function') {\n\t\t\tvalue = value(data);\n\t\t}\n\t\treturn value;\n\t});\n}\n\n\n/*\n * inspired by and uses code from https://github.com/mylen/leaflet.TileLayer.WMTS\n */\nclass WMTS extends TileLayer {\n\n    private _url: string;\n    private _crs: any;\n    private matrixIds : any;\n    private wmtsParams : any;\n\n    private defaultWmtsParams: any;\n\n    constructor(url : string, options ?: any) {\n        super(url, options);\n    }\n\n    initialize (url, options) { // (String, Object)\n        this._url = url;\n        this.defaultWmtsParams = {\n            service: 'WMTS',\n            request: 'GetTile',\n            version: '1.0.0',\n            layers: '',\n            styles: '',\n            tileMatrixSet: '',\n            format: 'image/png'\n        };\n        var wmtsParams = Util.extend({}, this.defaultWmtsParams);\n        var tileSize = options.tileSize || this.options.tileSize;\n        if (options.detectRetina && Browser.retina) {\n            wmtsParams.width = wmtsParams.height = tileSize * 2;\n        } else {\n            wmtsParams.width = wmtsParams.height = tileSize;\n        }\n        for (var i in options) {\n            // all keys that are not TileLayer options go to WMTS params\n            if (!this.options.hasOwnProperty(i) && i!=\"matrixIds\") {\n                wmtsParams[i] = options[i];\n            }\n        }\n        this.wmtsParams = wmtsParams;\n        this.matrixIds = options.matrixIds||this.getDefaultMatrix();\n        Util.setOptions(this, options);\n    }\n\n    onAdd ( map: Map ) : this {\n        this._crs = (this.options as any).crs || (map.options as any).crs;\n        return super.onAdd(map);\n    }\n\n    getTileUrl (coords : Point) : string { // (Point, Number) -> String\n        var tileSize = this.options.tileSize as number;\n        var nwPoint = coords.multiplyBy(tileSize);\n        nwPoint.x+=1;\n        nwPoint.y-=1;\n        var sePoint = nwPoint.add( new Point(tileSize, tileSize) );\n        var zoom = this._tileZoom;\n        var nw = this._crs.project(this._map.unproject(nwPoint, zoom));\n        var se = this._crs.project(this._map.unproject(sePoint, zoom));\n        var tilewidth = se.x-nw.x;\n        //zoom = this._map.getZoom();\n        var ident = this.matrixIds[zoom].identifier;\n        var tileMatrix = this.wmtsParams.tileMatrixSet + \":\" + ident;\n        var X0 = this.matrixIds[zoom].topLeftCorner.lng;\n        var Y0 = this.matrixIds[zoom].topLeftCorner.lat;\n        var tilecol=Math.floor((nw.x-X0)/tilewidth);\n        var tilerow=-Math.floor((nw.y-Y0)/tilewidth);\n\n\n        let url = this._url;\n        let isTileMatrixTemplated = url.indexOf('{TileMatrix}');\n        let isTileRowTemplated = url.indexOf('{TileRow}');\n        let isTileColTemplated = url.indexOf('{TileCol}');\n\n        let o = Object.assign({s: this._getSubdomain(coords)}, this.wmtsParams);\n        if(isTileMatrixTemplated>0) o.TileMatrix = ident;\n        if(isTileRowTemplated>0) o.TileRow = tilerow;\n        if(isTileColTemplated>0) o.TileCol = tilecol;\n        for(let k in o) {\n            o[k.toLowerCase()] = o[k];\n        }\n        // url = Util.template(url.toLowerCase(), o);\n        url = template(url, o);\n\n        let qsi = url.indexOf(\"?\");\n        if(qsi<0 || (isTileMatrixTemplated<qsi && isTileRowTemplated<qsi || isTileColTemplated<qsi)) {\n            //if the TM,TR,TC variables are templated but not as querystring parameters\n            // (ie, no '?' present or those params are before the '?'),\n            // then the URL must not be OGC WMTS, so no need for WMTS parameters\n\n        } else {\n            url = url + Util.getParamString(this.wmtsParams, url);\n            if(isTileMatrixTemplated<0)\n                url += \"&TileMatrix=\" + ident; //tileMatrixSet\n            if(isTileRowTemplated<0)\n                url += \"&TileRow=\" + tilerow;\n            if(isTileColTemplated<0)\n                url += \"&TileCol=\" + tilecol;\n        }\n\n        return url;\n    }\n\n    setParams (params, noRedraw) {\n        Util.extend(this.wmtsParams, params);\n        if (!noRedraw) {\n            this.redraw();\n        }\n        return this;\n    }\n\n    getDefaultMatrix  () {\n        /**\n         * the matrix3857 represents the projection\n         * for in the IGN WMTS for the google coordinates.\n         */\n        var matrixIds3857 = new Array(22);\n        for (var i= 0; i<22; i++) {\n            matrixIds3857[i]= {\n                identifier    : \"\" + i,\n                topLeftCorner : new LatLng(20037508.3428,-20037508.3428)\n            };\n        }\n        return matrixIds3857;\n    }\n\n    _getSubdomain (tilePoint : Point) : string {\n\t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\n\t\treturn this.options.subdomains[index];\n\t}\n\n}\n\n\n\n\nfunction wmts(layer) {\n\n    let url = layer.services && layer.services.length ? layer.services[0].href : null;\n\n    let supportedCrs = layer.crs || [];\n    if(supportedCrs && supportedCrs.length > 0 && ~supportedCrs.indexOf(\"ESPG:3857\")) {\n        console.log(\"Layer '\" + layer.label + \"' does not support \" +\n            \"EPSG:3857 Spherical Mercator projection and may not render appropriately or at all.\");\n    }\n\n    let options = {\n        layer: layer.layerName,\n        style: 'default',\n        tileMatrixSet: \"default\",\n        format: \"image/png\"\n    };\n    if(Config.leafletPane)\n        (options as any).pane = Config.leafletPane;\n\n    let distro = (layer.distributions || []).find( dist => {\n        //ensure dist isn't 'null'\n        return dist && dist.href && ( dist.mediaType==='image/png' || dist.mediaType==='image/jpeg' );\n    });\n    if(distro) {\n        url = distro.href;\n        options.format = distro.mediaType;\n\n        let params = distro.parameters || [];\n        params.forEach( param => {\n\n            //ignore wmts specific parameters, WMTS layer will populate those values\n            // based upon map state.\n            let plc = param.name.toLowerCase();\n            if(\"tilematrix\" === plc || \"tilerow\" === plc || \"tilecol\" === plc)\n                return;\n\n            //for all other parameters, try to fill in default or initial values\n            let value = param.defaultValue || param.values && param.values.length && param.values[0];\n            if(value !== null && value !== undefined) {\n                url = url.replace('{' + param.name + '}', value);\n            }\n        });\n    } else {\n        throw new Error(\"WTMS Layer - layer \" + layer.id +\n            \" has no distribution(s) usable to make WMTS requests\");\n    }\n\n    if(!url) throw new Error(\"Unable to determine WMTS URL for layer \" + layer.id +\n        \". Please make sure it is defined by either the service or a distribution on the layer itself.\");\n\n    return new WMTS( url, options );\n\n}\n\n\nif((window as any).L) {\n    const L = (window as any).L;\n    L.TileLayer.WMTS = WMTS;\n    L.tileLayer.wmts = wmts;\n}\n\nexport {\n    WMTS as default,\n    WMTS,\n    wmts\n};\n","\nimport * as Q from \"q\";\nimport { Map, TileLayer, tileLayer, Point, Coords, Browser, Util } from 'leaflet';\n\nimport {Config} from '@geoplatform/client';\n\n\nclass EsriTileLayer extends TileLayer {\n\n    private _url : string;\n    private _crs : any;\n    private esriParams : any;\n    private defaultESRIParams : any;\n\n    constructor(url, options) {\n        super(url, options);\n    }\n\n    initialize (url, options) { // (String, Object)\n\n        if(!url) throw new Error(\"Layer was not configured with a URL\");\n\n        this.defaultESRIParams = {\n            layers:       '', //=show:0,1,2\n            transparent:  true,\n            format:       'png32',\n            f:            'image'\n            // srs:          '4326',\n            // bboxsr:       '4326',\n            // bbox:         null,\n            // size:         '256,256',\n            // imagesr:      '4326'\n        };\n\n        if(url.indexOf(\"/export\") < 0) {\n            let qidx = url.indexOf(\"?\");\n            if(qidx > 0) {\n                url = url.substring(0, qidx) + '/export' + url.substring(qidx);\n            } else {\n                url += '/export';\n            }\n        }\n        this._url = url;\n\n        let esriParams : any = Util.extend({}, this.defaultESRIParams),\n            tileSize = options.tileSize || this.options.tileSize;\n\n        let dim;\n        if (options.detectRetina && Browser.retina) {\n            dim = esriParams.height = tileSize * 2;\n        } else {\n            dim = esriParams.height = tileSize;\n        }\n        esriParams.size = dim + ',' + dim;\n\n        for (var i in options) {\n            // all keys that are not TileLayer options go to WMS params\n            if (!this.options.hasOwnProperty(i) && i !== 'crs') {\n                esriParams[i] = options[i];\n            }\n        }\n\n        //layer ids\n        // esriParams.layers = \"show:\" + esriParams.layers;\n\n        this.esriParams = esriParams;\n\n        Util.setOptions(this, options);\n\n    }\n\n    onAdd (map : Map) : this {\n        this._crs = (this.options as any).crs || (map.options as any).crs;\n        this.esriParams.srs = this.esriParams.imagesr = this.esriParams.bboxsr = this._crs.code;\n        return super.onAdd(map);\n    }\n\n    getTileUrl (tilePoint : Coords ) : string { // (Point, Number) -> String\n\n        let map = this._map,\n            tileSize = this.options.tileSize as number,\n\n        nwPoint = tilePoint.multiplyBy(tileSize),\n        sePoint = nwPoint.add([tileSize, tileSize]),\n\n        nw = this._crs.project(map.unproject(nwPoint, tilePoint.z)),\n        se = this._crs.project(map.unproject(sePoint, tilePoint.z)),\n        bbox = [nw.x, se.y, se.x, nw.y].join(','),\n\n        url = Util.template(this._url, {s: this._getSubdomain(tilePoint)});\n\n        let params = Util.extend({}, this.esriParams);\n        params.layers = \"show:\" + params.layers;\n\n        //convert to esri-special SR for spherical mercator\n        if(params.bboxsr === 'EPSG:3857')\n            params.bboxsr = '102100';\n        if(params.imagesr === 'EPSG:3857')\n            params.imagesr = '102100';\n\n        return url + Util.getParamString(params, url, true) + '&BBOX=' + bbox;\n    }\n\n    setParams (params, noRedraw) {\n        Util.extend(this.esriParams, params);\n        if (!noRedraw) {\n            this.redraw();\n        }\n        return this;\n    }\n\n    _getSubdomain (tilePoint : Point) : string {\n\t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\n\t\treturn this.options.subdomains[index];\n\t}\n}\n\nif((window as any).L) {\n    const L = (window as any).L;\n    L.TileLayer.ESRI = EsriTileLayer;\n    L.tileLayer.esri = function (url, options) {\n        return new L.TileLayer.ESRI(url, options);\n    };\n}\n\nexport default EsriTileLayer;\n","\nimport { TileLayer } from 'leaflet';\n\n\n/**\n * @param layer - GeoPlatform Layer\n * @return\n */\nfunction OSMLayerFactory() : TileLayer {\n\n    return new TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        minZoom: 1, maxZoom: 19,\n        attribution: 'Map data (c) <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors'\n    });\n}\n\nexport default OSMLayerFactory;\n","\nimport * as L from 'leaflet';\nimport { Layer } from \"leaflet\";\nimport * as esri from \"esri-leaflet\";\nimport ServiceTypes from \"../service/types\";\nimport OSM from \"./osm\";\nimport FeatureLayer from './feature';\nimport {\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed\n} from './cluster-feature';\n\nimport {WMS, wms} from './wms';\nimport {WMST, wmst} from './wmst';\nimport {WMTS, wmts} from './wmts';\nimport ESRITileLayer from './esri-tile-layer';\nimport OSMLayerFactory from './osm-factory';\nimport {LayerResourceTypes} from '../shared/resource-types';\nimport {\n    Config, ItemTypes, LayerService, XHRHttpClient,\n    Layer as LayerModel, Service as ServiceModel,\n    ServiceTypeStandard\n} from '@geoplatform/client';\n\ninterface LayerOptions {\n    layers ?: string|string[],\n    transparent ?: boolean,\n    format ?: string,\n    pane ?: string,\n    srs ?: string,\n    url ?: string,\n    useCors ?: boolean\n};\n\n\n\n\n/*\n * Extend base Leaflet layer class to ensure there's always a function\n * available for modifying zindex and opacity, even if nothing actually\n * happens inside.\n */\nLayer.include({\n\n    // Redefining a method\n    setZIndex: function(value : number) {\n        //do nothing in this abstract class, let impls do the work\n    },\n\n    setOpacity: function(value : number) {\n        //do nothing in this abstract class, let impls do the work\n    }\n\n});\n\n\n\n\n/**\n * Fetches style information from GeoPlatform UAL\n * @param id - identifier of layer to resolve style for\n */\nfunction styleResolverFactory(service ?: LayerService) : any {\n\n    if(!service || typeof(service.style) !== 'function') {\n        throw new Error(\"Must provide a LayerService instance\");\n    }\n\n    return function featureStyleResolver(id) {\n        return new Promise<any>( (resolve, reject) => {\n            service.style(id)\n            .then( result => resolve(result) )\n            .catch(e => {\n                let msg = `Error loading style information for layer ${id} : ${e.message}`;\n                reject( new Error(msg) );\n            });\n        });\n    };\n}\n\n\n\n\n\n\n\n\n/**\n * Layer Factory\n *\n * Used to instantiate GeoPlatform Layer objects as Leaflet layer instances\n * capable of being rendered on Leaflet maps.\n *\n * Usage:\n *      let leafletLayer = LayerFactory.create(gpLayerObj);\n *\n *\n * Basic layer support is built in, but additional layer types can be supported\n * by registering new factory methods.\n *\n * Example:\n *      LayerFactory.register( (gpLayerObj) => {\n *          let isSupported = false;\n *          //implement test to verify supported layer type\n *          // ...\n *          if(isSupported) {\n *              return new MyCustomLayerClass(gpLayerObj);\n *          }\n *          return null;\n *      });\n *\n */\nclass LayerFactory {\n\n    private factories : Function[];\n    private service : LayerService;\n\n    constructor() {\n        this.factories = [];    // A list of configured factory functors to instantiate layers\n        this.init();\n    }\n\n    register(fn : Function) {\n        if(typeof(fn) === 'function') {\n            this.factories.push(fn);\n        }\n    }\n\n    setLayerService(service : LayerService) {\n        this.service = service;\n    }\n\n    /**\n     */\n    getStyleResolver() : Function {\n        if(!this.service || typeof(this.service.style) === 'undefined') {\n            this.service = new LayerService(Config.ualUrl, new XHRHttpClient());\n        }\n        return styleResolverFactory(this.service);\n    }\n\n    /**\n     * @param layer - GP Layer object\n     * @return leaflet layer instance or null\n     */\n    create( layer : LayerModel ) : Layer {\n        if(!layer) {\n            throw new Error(\"LayerFactory expects a layer object\");\n        }\n        for(let i=0; i<this.factories.length; ++i) {\n            let fn = this.factories[i];\n            let result = fn && typeof(fn)==='function' && fn(layer);\n            if(result) return result;\n        }\n        return null;\n    }\n\n\n    init () {\n\n        //OSM factory\n        this.register( ( layer : LayerModel )=> {\n            if(layer && layer.resourceTypes &&\n                layer.resourceTypes.length &&\n                ~layer.resourceTypes.indexOf(LayerResourceTypes.OSM)) {\n                return OSMLayerFactory();\n            }\n        });\n\n        // ESRI factory\n        this.register( (layer : LayerModel) => {\n            if(!layer || !layer.services || !layer.services.length) return null;\n            let service : ServiceModel = layer.services[0];\n            let url     = service.href,\n                svcType : ServiceTypeStandard = service.serviceType,\n                typeUri = svcType ? svcType.uri : null,\n                // srs     = layer.supportedCRS ? layer.supportedCRS[0] : null,\n                format  = layer.supportedFormats ? layer.supportedFormats[0] : null,\n                opts : LayerOptions;\n\n            function checkUrl(url) {\n                if(!url) throw new Error(\"Layer's service does not define a service url\");\n            }\n\n            if(ServiceTypes.ESRI_MAP_SERVER &&\n                ServiceTypes.ESRI_MAP_SERVER.uri === typeUri) {\n                checkUrl(url);\n                opts = {\n                    layers: layer.layerName,\n                    transparent: true,\n                    format: format || \"png32\"\n                } as LayerOptions;\n\n                // if(srs) opts.srs = srs;\n                let supportedCrs = layer.crs || [];\n                if(supportedCrs && supportedCrs.length > 0 && ~supportedCrs.indexOf(\"ESPG:3857\")) {\n                    console.log(\"Layer '\" + layer.label + \"' does not support \" +\n                        \"EPSG:3857 Spherical Mercator projection and may not render appropriately or at all.\");\n                }\n\n                if(Config.leafletPane)\n                    opts.pane = Config.leafletPane;\n                return new ESRITileLayer(url, opts);\n\n            } else if(ServiceTypes.ESRI_FEATURE_SERVER &&\n                ServiceTypes.ESRI_FEATURE_SERVER.uri === typeUri) {\n                checkUrl(url);\n                return clusteredFeatures(layer, {\n                    styleResolver: this.getStyleResolver()\n                });\n\n            } else if(ServiceTypes.ESRI_TILE_SERVER &&\n                ServiceTypes.ESRI_TILE_SERVER.uri === typeUri) {\n                checkUrl(url);\n                opts = { url: url, useCors: true };\n                if(Config.leafletPane)\n                    opts.pane = Config.leafletPane;\n                return esri.tiledMapLayer(opts);\n\n            } else if(ServiceTypes.ESRI_IMAGE_SERVER &&\n                ServiceTypes.ESRI_IMAGE_SERVER.uri === typeUri) {\n                opts = { url: url, useCors: true };\n                if(Config.leafletPane)\n                    opts.pane = Config.leafletPane;\n                return esri.imageMapLayer(opts);\n\n            }\n            return null;\n        });\n\n        // OGC factory\n        this.register( (layer : LayerModel) => {\n            if(!layer || !layer.services || !layer.services.length) return null;\n            let service : ServiceModel = layer.services[0];\n            let svcType : ServiceTypeStandard = service.serviceType;\n            let typeUri : string = svcType ? svcType.uri : null;\n\n            if(ServiceTypes.WMS && ServiceTypes.WMS.uri === typeUri) {\n                return wms(layer);\n            } else if(ServiceTypes.WMST && ServiceTypes.WMST.uri === typeUri) {\n                return wmst(layer);\n            } else if(ServiceTypes.WMTS && ServiceTypes.WMTS.uri === typeUri) {\n                return wmts(layer);\n            }\n            return null;\n        });\n\n\n        this.register( (layer : LayerModel) => {\n            if(!layer || !layer.services || !layer.services.length) return null;\n            let service : ServiceModel = layer.services[0];\n            let svcType : ServiceTypeStandard = service.serviceType;\n            let typeUri : string = svcType ? svcType.uri : null;\n            if(ServiceTypes.FEED && ServiceTypes.FEED.uri === typeUri) {\n                return geoJsonFeed(layer, {\n                    styleResolver: this.getStyleResolver()\n                });\n            }\n            return null;\n        });\n\n\n\n\n        this.register( (layer : LayerModel) => {\n\n            if(!layer) return null;\n\n            let resourceTypes = layer.resourceTypes || [];\n            if(resourceTypes.indexOf(LayerResourceTypes.MapBoxVectorTile) < 0) { //not tagged as VT layer\n                return null;\n            }\n\n            let href = layer.href;\n            if(!href || href.indexOf(\".pbf\") < 0) {\n                console.log(\"LayerFactory - Layer does not define an Access URL\");\n                return null;  //missing URL\n            }\n\n            const Leaflet = L as any;\n\n            //if Leaflet vector grid plugin is not installed, can't render VT Layers\n            if( typeof(Leaflet.vectorGrid) === 'undefined' &&\n                typeof(Leaflet.vectorGrid.protobuf) === 'undefined') {\n                console.log(\"LayerFactory - Leaflet Vector Tiles plugin not found\");\n                return null;\n            }\n\n            // let styleFn = function(featureProperties, z){\n            //     let fill = '#AD816E';\n            //     return { color: fill, weight: 1 };\n            // };\n            //\n            // var styles = {\n            //     \"nc_wetlands\" : styleFn,\n            //     \"va_wetlands\": styleFn\n            // };\n            var opts : any = {\n        \t\trendererFactory: ( L.canvas as any ).tile\n                // ,\n        \t\t// vectorTileLayerStyles: styles,\n        \t};\n            if(Config.leafletPane) opts.pane = Config.leafletPane;\n        \treturn Leaflet.vectorGrid.protobuf(href, opts);\n\n        });\n\n\n\n    }\n}\n\nexport default new LayerFactory();\n","\nimport * as jquery from \"jquery\";\nconst jQuery = jquery;\n\nimport * as Q from \"q\";\n\nimport {\n    icon as iconFn, marker as markerFn, circleMarker as circleMarkerFn,\n    SVG, svg, Canvas, canvas,\n    Util\n} from 'leaflet';\n\nimport * as esri from \"esri-leaflet\";\nvar EsriFeatureLayer = esri.FeatureLayer;\n\nimport { Config } from \"@geoplatform/client\";\nimport featurePopupTemplate from '../shared/popup-template';\n\n/**\n * Feature Layer\n * Provides custom style loading and point-ilization as well\n * as adding visibility and opacity manipulation methods\n */\nvar FeatureLayer = EsriFeatureLayer.extend({\n\n    _gpStyle : { color: \"#00f\", weight: 2, fillColor: '#00f', fillOpacity: 0.3 },\n\n    /**\n     * @param {object} feature - GeoJSON Point Feature\n     * @param {L.LatLng} latlng\n     * @return {L.Marker}\n     */\n    pointToLayerFn: function (feature, latlng) {\n\n        // console.log(\"Feature: \" + feature.id);\n\n        var style = feature && feature.properties ? feature.properties.style : null;\n        if(!style && typeof this.options.style === 'function') {\n            // console.log(\"Using local style function\");\n            try {\n                style = this.options.style(feature);\n            } catch(e) {\n                console.log(\"error using style function in ClusteredFeatureLayer: \" + e.message);\n            }\n        }\n\n        style = style || this.options.style || {};\n\n        let marker = null;\n        if(style.shape === 'image') {\n            let width = style.width || 16;\n            let height = style.height || 16;\n            var icon = iconFn( {\n                iconUrl: style.content, //base64 encoded string\n                iconSize: [width, height],\n                iconAnchor: [width*0.5, height*0.5],\n                popupAnchor: [0, -11],\n            });\n            let mopts = { icon: icon };\n            if(Config.leafletPane) (mopts as any).pane = Config.leafletPane;\n            marker = markerFn( latlng, mopts);\n\n        } else {\n            style.radius = style.radius || style['stroke-width'] || 4;\n            style.weight = style.weight || style['stroke-width'] || 2;\n            style.color = style.color || style.stroke || '#03f';\n            style.opacity = style.opacity || style['stroke-opacity'] || 0.9;\n            style.fillOpacity = style.opacity || style['fill-opacity'] || 0.3;\n            style.fillColor = style.color || style.fill;\n            style.renderer = this.options.renderer;  //important for pane!\n            marker = circleMarkerFn(latlng, style);\n        }\n\n        let popupTemplate = this.options.popupTemplate || featurePopupTemplate;\n        marker.bindPopup(popupTemplate(feature));\n        return marker;\n    },\n\n    /**\n     * for all non-point features, bind a popup\n     * @param {object} feature - GeoJSON feature\n     * @param {L.Layer} layer - layer representing feature\n     */\n    eachFeatureFn: function(feature, layer) {\n        if(!feature || !feature.geometry || feature.geometry.type === 'Point') {\n            return;\n        }\n        layer.bindPopup(featurePopupTemplate(feature));\n    },\n\n\n\n    initialize: function (options) {\n\n        var self = this;\n        options = options || {};\n\n        if(Config.leafletPane)\n            options.pane = Config.leafletPane;\n\n        let getGPStyle = () => { return this._gpStyle; };\n        options.style = options.style || getGPStyle();\n\n        //in order to put features-based layers into same pane as tile layers,\n        // must specify renderer and set desired pane on that\n        let svgOpts = { };\n        if(Config.leafletPane)\n            (svgOpts as any).pane = Config.leafletPane;\n        var renderer = (SVG && svg(svgOpts)) || (Canvas && canvas());\n        options.renderer = renderer;\n\n        options.pointToLayer = Util.bind(this.pointToLayerFn, this);\n        options.onEachFeature = Util.bind(this.eachFeatureFn, this);\n\n        // options.fields = ['FID', 'type', 'title', 'geometry'];\n\n        FeatureLayer.prototype.initialize.call(this, options);\n\n        this.on('load', function() {\n            if(typeof this.options.zIndex !== 'undefined')\n                this.setZIndex(this.options.zIndex);\n        });\n\n    },\n\n    setZIndex : function (index) {\n        this.options.zIndex = index;\n        for(var id in this._layers)\n            this._layers[id].setZIndex(index);\n    },\n\n    toggleVisibility: function() {\n        for(var id in this._layers) {\n            let layer = this._layers[id];\n            if(layer.toggleVisibility)\n                this._layers[id].toggleVisibility();\n        }\n    },\n\n    setOpacity: function(opacity) {\n        for(var id in this._layers) {\n            let layer = this._layers[id];\n            if(layer.setOpacity)\n                layer.setOpacity(opacity);\n        }\n    },\n\n    loadStyle: function(gpLayerId) {\n        var self = this;\n\n        if(this.options.styleLoader) {\n            this.options.styleLoader(gpLayerId)\n            .then( json => {\n\n                if(!json) return;\n\n                let style = null;\n\n                if(json && json.styles) {\n\n                    let featureFn = function(feature : any) : any {\n\n                        let property = this.property || this.field1;\n                        let v = feature[property] || (feature.properties ? feature.properties[property] : null);\n                        let style = null;\n                        if(this.styles) {\n                            let wrapper = this.styles.find( sw => sw.value === v );\n                            if(wrapper) {\n                                style = wrapper.style;\n                                style.radius = style.radius || style['stroke-width'] || 4;\n                                style.weight = style.weight || style['stroke-width'] || 2;\n                                style.color = style.color   || style.stroke || '#03f';\n                                style.opacity = style.opacity || style['stroke-opacity'] || 0.9;\n                                style.fillOpacity = style.opacity || style['fill-opacity'] || 0.3;\n                                style.fillColor = style.color || style.fill;\n                            }\n                        }\n                        // console.log(\"Using style: \" + JSON.stringify(style));\n                        return style;\n                    }\n\n                    let styleFn = () => { return featureFn(json); }\n                    this.options.style = styleFn;\n                    this.setStyle(styleFn);\n                    return;\n\n                } else if(json && typeof(json.push) !== 'undefined') {\n                    //multiple styles returned\n                    style = json[0];  //use first for now\n\n                } else if(json) {\n                    style = json;\n\n                } else {\n                    return; //unrecognizable style\n                }\n\n                if(style.shape) {\n                    var obj = jQuery.extend({}, style);\n                    obj.style = style;\n                    this._gpStyle = style;\n\n                    //setStyle on Cluster.FeatureLayer doesn't appear to work consistently for\n                    // non-clustered features.\n                    // this.setStyle(obj);\n                    //So instead, we manually set it on all features of the layer (that aren't clustered)\n                    for(let id in this._layers)\n                        this._layers[id].setStyle(obj);\n\n                }\n            })\n            .catch( e => {\n                console.log(\"Error fetching feature layer style\");\n                console.log(e);\n            });\n        }\n    }\n\n});\n\nexport default FeatureLayer;\n","\n\nimport * as jquery from \"jquery\";\nconst jQuery = jquery;\n\nimport * as Q from \"q\";\nimport * as geojson from 'geojson';\nimport {\n    Map, Layer, LatLng, LatLngBounds,\n    circleMarker, geoJSON,\n    featureGroup, FeatureGroup, LayerGroup\n} from 'leaflet';\n\nimport {\n    Config, ItemTypes,\n    ServiceFactory, ItemService, MapService, LayerService,\n    XHRHttpClient\n} from '@geoplatform/client';\n\nimport LayerFactory from '../layer/factory';\nimport OSM from \"../layer/osm\";\nimport DefaultBaseLayer from '../layer/baselayer-default';\n\n\nclass Listener {\n\n    _listeners : any;\n\n    constructor() {\n        //listeners to be unregistered upon destroy\n        this._listeners = {};\n    }\n\n    on (type, listener) {\n        if(!this._listeners[type])\n            this._listeners[type] = [];\n        this._listeners[type].push(listener);\n    }\n\n    off (type, listener) {\n        if(!type) this._listeners = {};\n        if(!this._listeners[type]) return;\n        if(!listener) this._listeners[type] = [];\n        else {\n            var idx = this._listeners[type].indexOf(listener);\n            if(idx >= 0)\n                this._listeners[type].splice(idx, 1);\n        }\n    }\n\n    notify(type, ...options) {\n        if(!this._listeners[type]) return;\n        var args = Array.prototype.slice.call(arguments, 1);\n        this._listeners[type].forEach(function(l) { l.apply(null, args); });\n    }\n\n}\n\n\n\nexport default class MapInstance extends Listener {\n\n    private svcCache        : any;\n    private serviceFactory  : any;\n    private httpClient      : any;\n    public _key            : string;\n    private _mapId          : string;\n    private _mapDef         : any;\n    private _mapInstance    : Map;\n    private _defaultExtent  : any;\n    private _baseLayerDef   : any;\n    private _baseLayer      : Layer;\n    private _layerStates    : any;\n    private _layerCache     : any;\n    private _layerErrors    : any[];\n    private _layerErrorHandler : Function;\n    private _featureLayer   : FeatureGroup;\n    private _featureLayerVisible  : boolean;\n    private _tools          : any[];\n    private state           : any;\n    private _geoJsonLayerOpts : any;\n\n\n\n\n    constructor(key) {\n        super();\n\n        this.setHttpClient(new XHRHttpClient());\n        this.setServiceFactory(ServiceFactory);\n\n        //generate random key (see factory below)\n        this._key = key || Math.ceil(Math.random()*9999);\n\n        //registry id of current map if available\n        this._mapId = null,\n\n        //definition of map (ie, from server)\n        this._mapDef = this.initializeMapDefinition(),\n\n        //primary map instance (ie, leaflet)\n        this._mapInstance = null,\n\n        //default map extent (if map doesn't have one for being saved)\n        this._defaultExtent = null,\n\n        //current base layer object and leaflet instance\n        this._baseLayerDef = null,\n        this._baseLayer = null,\n\n        //set definitions of layer states (including layer info) on map\n        this._layerStates = [],\n\n        //map layer def ids with leaflet instances\n        this._layerCache = {},\n\n        //errors generated by layers loading\n        this._layerErrors= [],\n        this._layerErrorHandler = function(e) {\n            console.log(`MapInstance.defaultLayerErrorHandler() - ${e.id} : ${e.message}`);\n        },\n\n        //layer used to store features on map\n        this._featureLayer = null,\n        this._featureLayerVisible = true,\n\n        //set of registered map tools\n        this._tools = [],\n\n        //state management\n        this.state = { dirty: false }; // jshint ignore:line\n\n        this._geoJsonLayerOpts  = {\n            style: function(feature) {\n                if(feature.properties.style)\n                    return feature.properties.style;\n            },\n            onEachFeature: function(feature, layer) {\n\n                var style = { weight: 2, color: '#03f', opacity: 0.9, radius: 4, fillColor: '#03f', fillOpacity: 0.5 };\n                if(~feature.geometry.type.indexOf('Point')) {\n                    style.fillOpacity = 0.9;\n                }\n\n                var props = feature.properties = feature.properties || {};\n                if(feature.properties.id === undefined || feature.properties.id === null)\n                    feature.properties.id = Math.floor(Math.random()*999999);\n                feature.properties.label = props.label || props.title || props.name || \"Untitled \" + feature.geometry.type + \" Feature\";\n                feature.properties.description = props.description || props.desc || \"This feature needs a description!\";\n                feature.properties.style = props.style || style;\n\n                layer.bindTooltip(props.label);\n                /*\n                toggle: setLabelNoHide(bool)\n                it may only exist on markers!\n                */\n            },\n            pointToLayer: function (feature : any, latlng : LatLng ) {\n                var style = feature.properties.style || {};\n                style.radius = style.radius || 4;\n                style.weight = style.weight || 2;\n                style.color = style.color || '#03f';\n                style.opacity = style.opacity || 0.9;\n                style.fillOpacity = style.opacity;\n                style.fillColor = style.color;\n                return circleMarker(latlng, style);\n            }\n        };\n    }\n\n    dispose () {\n        this.destroyMap();\n        this.svcCache = null;\n        this.serviceFactory = null;\n        this.httpClient = null;\n        this._key = null;\n        this._mapId = null;\n        this._mapDef = null;\n        this._mapInstance = null;\n        this._defaultExtent = null;\n        this._baseLayerDef = null;\n        this._baseLayer = null;\n        this._layerStates = null;\n        this._layerCache = null;\n        this._layerErrors= null;\n        this._featureLayer = null;\n        this._featureLayerVisible = true;\n        this._tools = null;\n        this.state = null;\n        this._geoJsonLayerOpts = null;\n    }\n\n\n    getKey () {\n        return this._key;\n    }\n\n    /**\n     * Override default (JQuery-based) map service used by this instance\n     * @param mapService - service to use to CRUD map objects\n     * @deprecated use setServiceFactory instead\n     */\n    setService(mapService : MapService) {\n        // this.mapService = mapService;\n    }\n\n    /**\n     * @param factory - GeoPlatform ServiceFactory to instantiate services for maps and layers\n     */\n    setServiceFactory(factory : any) {\n        this.svcCache = {}; //wipe out cached services\n        this.serviceFactory = factory;\n    }\n\n    /**\n     * @param httpClient - HttpClient impl to use with the new factory\n     */\n    setHttpClient(httpClient : any) {\n        this.svcCache = {}; //wipe out cached services\n        this.httpClient = httpClient;\n    }\n\n    /**\n     * @param type - GeoPlatform Object model type to support (\"Map\", \"Layer\", etc)\n     * @return item service implementation for the requested type\n     */\n    getService(type : string) : ItemService {\n        if(!this.svcCache[type])\n            this.svcCache[type] = this.serviceFactory(type, Config.ualUrl, this.httpClient);\n        return this.svcCache[type];\n    }\n\n    /**\n     * @param fn - callback when an error is encountered\n     */\n    setErrorHandler(fn) {\n        this._layerErrorHandler = fn;\n    }\n\n\n    //-----------------\n    getLayerStateIndex (layerId) {\n        if(!layerId) return -1;\n        for(let i=0; i<this._layerStates.length; ++i) {\n            if(this._layerStates[i].layer && layerId === this._layerStates[i].layer.id) {\n                return i;\n            }\n        }\n        return -1;\n        // return this._layerStates.indexOfObj(layerId, (id, state) => state.layer.id === id );\n    }\n\n    getLayerState (layerId) {\n        let index = this.getLayerStateIndex(layerId);\n        return index >= 0 ? this._layerStates[index] : null;\n    }\n    //-----------------\n\n\n    initializeMapDefinition() {\n        return {\n            type: ItemTypes.MAP,\n            title: \"My New Map\",\n            label: \"My New Map\",\n            description: \"This map needs a description\",\n            createdBy: null,\n            baseLayer: this._baseLayerDef,\n            layers: [],\n            keywords: [],\n            themes: [],\n            resourceTypes: ['http://www.geoplatform.gov/ont/openmap/GeoplatformMap']\n        };\n    }\n\n    /**\n     * @param metadata object\n     * @return object definition of the current map suitable for sending to WMVR\n     */\n    getMapResourceContent(metadata ?: any) {\n\n        metadata = metadata || {};\n\n        //map layers\n        metadata.layers = this._layerStates.map(state => {\n            let result = {\n                visibility : state.visibility || true,\n                opacity : isNaN(state.opacity) ? 1.0 : state.opacity*1,\n                layer: {\n                    id: state.layer.id,\n                    uri: state.layer.uri,\n                    label: state.layer.label\n                }\n            };\n            return result;\n        });\n        // ... UAL should support accepting just an id here, so we'll do just that\n        metadata.baseLayer = {\n            id: this._baseLayerDef.id,\n            uri: this._baseLayerDef.uri,\n            label: this._baseLayerDef.label\n        };\n\n        metadata.annotations = this._featureLayer ?\n            { title: \"Map Features\", geoJSON: this._featureLayer.toGeoJSON() } : null;\n\n        //geographic extent\n        let extent = this._mapInstance.getBounds();\n        metadata.extent = {\n            minx: extent.getWest(),\n            miny: extent.getSouth(),\n            maxx: extent.getEast(),\n            maxy: extent.getNorth()\n        };\n\n        return metadata;\n    }\n\n    /**\n     * @return Leaflet toolbar\n     */\n    getDrawControlToolbar() {\n        if(!(this._mapInstance as any).drawControl) return null;\n        var toolbars = (this._mapInstance as any).drawControl._toolbars;\n        var toolbar = null;\n        for(var key in toolbars) {\n            if(toolbars.hasOwnProperty(key)) {\n                if(toolbars[key]._modes) {\n                    toolbar = toolbars[key];\n                    break;\n                }\n            }\n        }\n        return toolbar;\n    }\n\n    /**\n     * @param error Leaflet tile load error (.target is layer, .tile is image)\n     */\n    handleLayerError(error) {\n        // console.log(\"MapInstance.handleLayerError() - \" +\n        //     \"Layer's tile failed to load: \" + error.tile.src);\n        if(!this._layerCache) {\n            console.log(\"Unable to find layer in layer cache. Layer error is \" + error);\n            return;\n        }\n        var layer = error.target;\n        for(var id in this._layerCache) {\n            if(this._layerCache[id] === layer) {\n                this.processLayerError(error, id);\n                break;\n            }\n        }\n    }\n\n    /**\n     * Given a Leaflet tile load error and the responsible layer id,\n     * Try to isolate the cause of the error using the proxy\n     * and notify listeners that an error has occurred\n     */\n    processLayerError(error : Error, id : string) {\n\n        var finder = (l) => { return l.id === id || (l.layer && l.layer.id === id); };\n\n        if(!this._layerErrors.find(finder)) {\n\n            let obj = this.logLayerError(id, \"Layer ('\" + id + \"') failed to completely load. \" +\n                \"It may be inaccessible or misconfigured.\");\n\n            var url = (error as any).tile.src;\n            var params = {id:id};\n            url.substring(url.indexOf(\"?\")+1, url.length).split('&').forEach(function(param) {\n                var p = param.split('=');\n                params[p[0]] = p[1];\n            });\n\n            let layerService = this.getService(ItemTypes.LAYER) as LayerService;\n            if(layerService) {\n                layerService.validate(id, params)\n                .catch(e => {\n                    var def = this._layerStates.find(finder);\n                    if(def) {\n                        obj.message = \"Layer '\" + def.layer.label + \"' failed to completely load. \" +\n                                \"Reported cause: \" + e.message;\n                    }\n                    this.notify('layer:error', obj);\n                });\n            }\n        }\n    }\n\n    /**\n     * @param layerId - identifier of layer generating the error\n     * @param errorMsg - message of the error\n     */\n    logLayerError(layerId, errorMsg) {\n        // console.log(\"MapInstance.logLayerError() - layer \"  + id +\n        //     \" generated error '\" + errorMsg + \"'\");\n        let err = { id: layerId, message: errorMsg };\n        this._layerErrors.push(err);\n        if(this._layerErrorHandler) {\n            this._layerErrorHandler(err);\n        }\n        return err;\n    }\n\n    /* -- State Management of internal model -- */\n\n    touch (event ?: any, ...options) {\n        this.state.dirty = true;\n        if(event) {\n            if(arguments.length > 1) {\n                this.notify.apply(this, Array.prototype.slice.call(arguments));\n            } else\n                this.notify(event);\n            // console.log(\"Dirtying map for \" + event);\n        }\n        // else console.log(\"Dirtying map\");\n    }\n    clean() {\n        // console.log(\"Cleaning map\");\n        this.state.dirty = false;\n    }\n    /* --------------------------------------- */\n\n\n\n\n    /* ==============================================\n        Map manipulation operations\n       ============================================== */\n\n    setMap (map : Map) { this._mapInstance = map; }\n\n    /**\n     * @return  map instance\n     */\n    getMap () : Map { return this._mapInstance; }\n\n    /** @return definition of map */\n    getMapDefinition () : any { return this._mapDef; }\n\n    /** @return identifier of map */\n    getMapId () : string { return this._mapId; }\n\n    /**\n     * Focuses the map on the specified lat/lng coordinate\n     * @param lat number\n     * @param lng number\n     * @param zoom number (optional)\n     */\n    setView (lat : number, lng : number, zoom ?: number) {\n        let z = zoom;\n        if(typeof(z) === 'undefined')\n            z = this._mapInstance.getZoom();\n        this._mapInstance.setView([lat,lng], z);\n        this.touch('map:view:changed');\n    }\n\n    /**\n     * Retrieve the current center of the map\n     * @return [lat,lng]\n     */\n    getView () : number[] {\n        var latLng = this._mapInstance.getCenter();\n        return [latLng.lat, latLng.lng];\n    }\n\n    /**\n     * @return integer current zoom level of the map\n     */\n    getZoom () : number {\n        return this._mapInstance.getZoom();\n    }\n\n    /**\n     * Zoom to the map's default extent\n     * If the map is saved, this will be the saved viewport\n     * otherwise, it will be CONUS\n     */\n    zoomToDefault () {\n        if(!this._mapInstance) return;\n        if(this._defaultExtent) {\n            this._mapInstance.fitBounds([\n                [this._defaultExtent.miny, this._defaultExtent.minx],\n                [this._defaultExtent.maxy, this._defaultExtent.maxx]\n            ]);\n        } else {\n            console.log(\"MapInstance.zoomToDefault() - No default extent specified\");\n            this._mapInstance.setView([38, -96], 5);\n        }\n        try {\n            this.touch('map:view:changed');\n        } catch(e) { }\n    }\n\n    /**\n     * @param extent - either a GP extent object or Leaflet LatLngBounds object\n     */\n    setExtent(extent : LatLngBounds|any) {\n        if(!extent) return;\n        if( typeof(extent.minx) !== 'undefined' &&\n            typeof(extent.miny) !== 'undefined' &&\n            typeof(extent.maxx) !== 'undefined' &&\n            typeof(extent.maxy) !== 'undefined' ) {\n            //GP model extent\n            this._mapInstance.fitBounds([\n                [extent.miny, extent.minx],\n                [extent.maxy, extent.maxx]\n            ]);\n        } else if(typeof(extent.getWest) !== 'undefined') {\n            //L.LatLngBounds\n            this._mapInstance.fitBounds(extent);\n        } else {\n\n        }\n    }\n\n\n    /* ==============================================\n        Layer operations\n       ============================================== */\n\n\n    /**\n     * @param layer Leaflet Layer instance or object definition\n     */\n    setBaseLayer (layer : any) {\n\n        let promise = null;\n        if(!layer) {\n            let svc = this.getService(ItemTypes.LAYER) as LayerService;\n            promise = DefaultBaseLayer.get(svc);\n        } else\n            promise = Promise.resolve(layer);\n\n        promise.then( layer => {\n\n            let leafletLayer = LayerFactory.create(layer);\n            if(!leafletLayer) {\n                console.log(\"Warning: MapInstance could not create base \" +\n                    \"layer for '\" + layer.id + \"'\");\n                return;\n            }\n\n            this._mapInstance.addLayer(leafletLayer);\n\n            (leafletLayer as any).setZIndex(0);  //set at bottom\n\n            let oldBaseLayer = this._baseLayer;\n            if(oldBaseLayer) {\n                this._mapInstance.removeLayer(oldBaseLayer);\n            }\n\n            //remember new base layer\n            this._baseLayer = leafletLayer;\n            this._baseLayerDef = layer;\n\n            //will notify listeners\n            this.touch('baselayer:changed', layer, leafletLayer);\n            // this.notify('baselayer:changed', layer, leafletLayer);\n\n        })\n        .catch(e => {\n            console.log(`MapInstance.setBaseLayer() - Error getting base layer for map : ${e.message}`);\n            this.logLayerError( layer.id, \"Error setting baselayer on map \" +\n                \"because of the following error(s): \" + e.message );\n        });\n    }\n\n    /**\n     * @return array of base layers definitions that can be used\n     */\n    // getBaseLayerOptions () {\n    //     return this._baseLayerOptions;\n    // },\n\n    getBaseLayer () : any { return this._baseLayerDef; }\n\n    /**\n     * @return list of layer states containing layer information\n     */\n    getLayers () : any[] { return this._layerStates; }\n\n    getLayerErrors () : any[] { return this._layerErrors; }\n\n    clearLayerErrors () {\n        this._layerErrors = [];\n        this.notify('layer:error');\n    }\n\n    clearOverlays () {\n        if(!this._layerCache) return;\n        for(var i=this._layerStates.length-1; i>=0; --i) {\n            var state = this._layerStates[i];\n            var layerInstance = this._layerCache[state.layer.id];\n            if(layerInstance) {\n                layerInstance.off(\"layer:error\");\n                this._layerCache[state.layer.id] = null;\n                this._mapInstance.removeLayer(layerInstance);\n            }\n        }\n        this._layerStates = [];\n        this.touch('layers:changed');\n\n        //TODO stop listening for layer events\n    }\n\n    /**\n     * @param layers - list of layers (NOTE: not wrapped by layer states, this method applies that)\n     */\n    addLayers (layers : any|any[] ) {\n        if(!this._layerCache) {\n            console.log(\"WARN: attempting to add layers to an empty cache\");\n            return;\n        }\n\n        if(!this._layerCache) {\n            console.log(\"WARN: Attempting to add layers to a map with no layer cache\");\n            return;\n        }\n\n        if(!layers) return;\n        if(typeof(layers.push) === 'undefined') {\n            layers = [layers];\n        }\n\n        layers.forEach( (obj,index) => {\n\n            let layer = null, state = null;\n\n            if(obj.type && obj.type===ItemTypes.LAYER) { //is a layer\n                layer = obj;\n            } else if(obj.layer) {  //is layer state\n                layer = obj.layer;  // containing a layer\n                state = obj;\n            }\n\n            if(!layer) {\n                console.log(\"MapInstance.addLayers() - layer (\" + index +\n                    \") is not a Layer or a Layer state. Ignoring...\");\n                return;  //layer info is missing, skip it\n            }\n\n            //DT-442 prevent adding layer that already exists on map\n            if(this._layerCache[layer.id]) return;\n\n            if(!state) {\n                try {\n                    //wrapped in try{}catch because layer may contain circular reference\n                    // which will cause error when used by JSON methods\n                    let layerCopy = JSON.parse(JSON.stringify(layer));\n                    state = {\n                        opacity: 1,\n                        visibility: true,\n                        layer: layerCopy\n                    };\n                } catch(e) {\n                    throw new Error(\"Unable to add layer to map because of \" + e.message);\n                }\n            }\n\n            let z = layers.length - index;\n            state.zIndex = z;\n\n            this.addLayerWithState(layer, state);\n\n        });\n\n        this.touch('layers:changed');\n    }\n\n    /**\n     * @param layer - GeoPlatform Layer instance\n     * @param state - GeoPlatform Layer State\n     */\n    addLayerWithState(layer, state) {\n\n        var leafletLayer = null;\n        try {\n            if(!layer || !state)\n                throw new Error(\"Invalid argument, missing layer and or state\");\n\n            leafletLayer = LayerFactory.create(layer);\n            if(!leafletLayer) {\n                let msg = \"Could not create leaflet instance for GP Layer '\" + layer.id + \"'.\";\n                if(!layer.services || !layer.services.length) {\n                    msg += '  The layer instance has no services included, ' +\n                        'which will prevent most layers from being displayed.';\n                }\n                throw new Error(msg);\n            }\n\n        } catch(e) {\n            this.logLayerError( layer.id,\n                \"Layer '\" + layer.label + \"' could not be added to the \" +\n                \"map instance; \" + e.message);\n        }\n\n        if(!leafletLayer) return;\n\n        //cache leaflet object first\n        if(this._layerCache) this._layerCache[layer.id] = leafletLayer;\n\n        //listen for layer errors so we can inform the user\n        // that a layer hasn't been loaded in a useful way\n        leafletLayer.on('tileerror', (e) => { this.handleLayerError(e); });\n\n        this._mapInstance.addLayer(leafletLayer);\n\n        if( !isNaN(state.zIndex) && leafletLayer.setZIndex )\n            leafletLayer.setZIndex(state.zIndex);\n\n        this._layerStates.push(state);\n\n        this.notify('layer:added', layer, leafletLayer);\n\n\n        // if layer is initially \"off\" or...\n        // if layer is initially not 100% opaque\n        if(!state.visibility || state.opacity < 1) {\n            // initialize layer visibility and opacity async, or else\n            // some of the layers won't get properly initialized\n            setTimeout( (layer, state) => {\n                this.setLayerVisibility(layer, state.visibility);\n                this.setLayerOpacity(layer, state.opacity);\n                //TODO notify of change\n\n                //DT-2102 timeout needs to be large enough or else\n                // feature layers won't get opacity updated on map load\n            }, 2000, leafletLayer, state);\n        }\n    }\n\n    /**\n     * @param from - position of layer being moved\n     * @param to - desired position to move layer to\n     */\n    moveLayer (from : number, to : number) {\n        if(!this._layerCache) return;\n\n        if(!this._layerCache) return;\n\n        if(isNaN(from)) return;\n\n        //end of list\n        if(isNaN(to)) to = this._layerStates.length-1;\n\n        let copy = this._layerStates.splice(from, 1)[0];    //grab layer being moved\n        this._layerStates.splice(to, 0, copy);\n\n        for(let z=1, i=this._layerStates.length-1; i>=0; --i,++z) {\n            let layerState = this._layerStates[i];\n            let layerInstance = this._layerCache[ layerState.layer.id ];\n            if(layerInstance) {\n                layerInstance.setZIndex(z);\n                layerState.zIndex = z;\n            }\n        }\n\n        this.touch('layers:changed', this.getLayers());\n    }\n\n    /**\n     *\n     */\n    removeLayer (id) {\n\n        if(!this._layerCache) return;\n        var layerInstance = this._layerCache[id];\n        if(layerInstance) {\n\n            //remove layer from tracked defs array\n            let index = this.getLayerStateIndex(id);\n            // console.log(\"MapInstance.removeLayer(\" + id + \")\");\n            if(index >= 0 && index < this._layerStates.length)\n                this._layerStates.splice(index, 1);\n\n            //stop listening for errors\n            layerInstance.off(\"layer:error\");\n\n            //remove layer from map\n            this._mapInstance.removeLayer(layerInstance);\n\n            //remove layer from cache\n            this._layerCache[id] = null;\n        }\n        this.touch('layers:changed');\n    }\n\n    /**\n     *\n     */\n    toggleLayerVisibility (id) {\n        if(!this._layerCache) return;\n        var layerInstance = this._layerCache[id];\n        if(layerInstance) {\n            let state = this.getLayerState(id);\n            state.visibility = !state.visibility;\n\n            if(layerInstance._currentImage) {\n                //ESRI Image Service layers have an IMG element\n                // that gets modified and replaced every map event (zoom/pan)\n                // so we can't just toggle classes like on other layers.\n                //Instead, we need to use the ESRI setOpacity method to toggle\n                // but need to update layer state as well.\n                layerInstance.setOpacity(state.visibility ? 1 : 0);\n                state.opacity = layerInstance.getOpacity();\n                return;\n            }\n\n            this.setLayerVisibility(layerInstance, state.visibility);\n        }\n    }\n\n    /**\n     * Note: this does not update layer definition state. Use\n     * MapInstance.toggleLayerVisibility to do that and adjust\n     * rendered layer's visibility.\n     *\n     * @param layerInstance - leaflet layer instance\n     * @param visible - flag indicating visibility of layer\n     */\n    setLayerVisibility (layerInstance : Layer, visible : boolean) {\n\n        if((layerInstance as any).setVisibility) {\n            //using custom method provided in src/layer/module.js\n            (layerInstance as any).setVisibility(visible);\n\n        } else if((layerInstance as any)._container) {\n            //otherwise, using jquery on dom directly\n            let el = jQuery((layerInstance as any)._container);\n            // if(visible) el.removeClass(\"invisible\");\n            // else el.addClass('invisible');\n            el.css({'display': visible ? '' : 'none'});\n        }\n\n        this.touch('map:layer:changed');\n    }\n\n    /**\n     *\n     */\n    updateLayerOpacity (id : string, opacity : number) {\n\n        if(!this._layerCache) return;\n        var layerInstance = this._layerCache[id];\n\n        //if layer id is for base layer...\n        if(!layerInstance && this._baseLayerDef.id === id) {\n            layerInstance = this._baseLayer;\n        }\n\n        //adjust rendered leaflet layer\n        opacity = this.setLayerOpacity(layerInstance, opacity);\n\n        // if overlay layer, update state value\n        let state = this.getLayerState(id);\n        if(state) state.opacity = opacity;\n\n    }\n\n    /**\n     * Note: this method does not update the associated Layer Definition\n     * state value for opacity. Use MapInstance.updateLayerOpacity() to\n     * both update state and adjust rendered layer.\n     *\n     * @param layerInstance - leaflet layer instance\n     * @param opacity - value between 0 and 1.0 or 0 and 100\n     * @return normalized opacity value between 0 and 1.0\n     */\n    setLayerOpacity (layerInstance : Layer, opacity : number) : number {\n        if(layerInstance && (layerInstance as any).setOpacity) {\n            if(opacity > 1.0) opacity = opacity / 100.0;\n            (layerInstance as any).setOpacity(opacity);\n            this.touch('map:layer:changed');\n        }\n        return opacity;\n    }\n\n    /**\n     * @param GeoPlatform Layer instance\n     * @return Leaflet layer instance representing that layer or null\n     */\n    getLeafletLayerFor (gpLayer : any) : Layer {\n        if(!gpLayer || !this._layerCache) return null;\n        let leafletLayer = this._layerCache[gpLayer.id];\n        return leafletLayer || null;\n    }\n\n    /**\n     *\n     */\n    toggleGetFeatureInfo (layerId : string) {\n        if(!this._layerCache) return;\n        var layerInstance = this._layerCache[layerId];\n        if(layerInstance) {\n            if(typeof(layerInstance.enableGetFeatureInfo) !== 'undefined') {\n                if(layerInstance.isGetFeatureInfoEnabled()) {\n                    layerInstance.disableGetFeatureInfo();\n                    jQuery((this._mapInstance as any)._container).removeClass('selectable-cursor');\n                } else {\n                    layerInstance.enableGetFeatureInfo();\n                    jQuery((this._mapInstance as any)._container).addClass('selectable-cursor');\n                }\n            }\n\n        }\n    }\n\n\n    /* ==============================================\n       Feature operations\n       ============================================== */\n\n\n    /**\n     * @return array of features on the map\n     */\n    getFeatures () : any[] {\n        if(this._featureLayer) {\n            let geojson = this._featureLayer.toGeoJSON();\n            return (geojson as any).features;\n        }\n        return [];\n    }\n\n    /**\n     * @param json geojson object or array of geojson objects\n     */\n    addFeatures (json : any) {\n\n        if(!json) return;\n\n        if(typeof(json.push) !== 'undefined') {\n            //array of features\n            for(var i=0; i<json.length; ++i)\n                this.addFeature(json[i], false);\n            this.touch('features:changed');\n\n        } else if(json.features) {\n            this.addFeatures(json.features);\n\n        } else { //single feature\n            this.addFeature(json, true);\n        }\n\n    }\n\n    /**\n     * @param json geojson object\n     */\n    addFeature (json : any, fireEvent ?: boolean) {\n        // var type = json.type;\n        // var coordinates = json.coordinates;\n\n        if(!this._featureLayer) {\n\n            // _featureLayer = geoJSON([], _geoJsonLayerOpts).addTo(_mapInstance);\n            this._featureLayer = featureGroup().addTo(this._mapInstance);\n\n        }\n\n        // _featureLayer.addData(json);\n        var opts = jQuery.extend({}, this._geoJsonLayerOpts);\n        geoJSON(json, opts).eachLayer((l)=>this.addFeatureLayer(l));\n\n        if(typeof(fireEvent) === 'undefined' || fireEvent === true)\n            this.touch('features:changed');\n        else this.touch();\n\n        // console.log(JSON.stringify(_featureLayer.toGeoJSON()));\n\n    }\n\n    /**\n     * @param featureJson object defining a GeoJSON feature\n     */\n    updateFeature (featureJson : any) {\n        var layer = this.getFeatureLayer(featureJson.properties.id);\n        if(layer) {\n\n            (layer as any).feature = featureJson;\n\n            //update style\n            layer.setStyle(featureJson.properties.style);\n\n            //rebind label in case that changed\n            var label = featureJson.properties.label ||\n                \"Untitled \" + featureJson.geometry.type + \" Feature\";\n            layer.bindTooltip(label);\n\n            // layer.redraw();\n            this.touch(\"map:feature:changed\");\n        }\n    }\n\n    /**\n     * Replace an existing L.Path-based layer with one using\n     * the supplied Feature GeoJSON object.  Removes the existing\n     * layer and adds a new one created from the GeoJSON.\n     *\n     * @param featureJson object defining GeoJSON feature\n     */\n    replaceFeature (featureJson : any) {\n\n        //find existing layer for this feature\n        var layer = this.getFeatureLayer(featureJson.properties.id);\n        if(layer) {\n\n            //remove existing\n            this._featureLayer.removeLayer(layer);\n\n            //add replacement\n            geoJSON(featureJson, this._geoJsonLayerOpts)\n                .eachLayer((l)=>this.addFeatureLayer(l));\n\n            this.touch(\"map:feature:changed\");\n        }\n    }\n\n    /**\n     * @param featureId identifier of feature to focus the map on\n     */\n    focusFeature (featureId : string) {\n        var layer = this.getFeatureLayer(featureId);\n        if(layer) {\n            if( typeof(layer.getBounds) !== 'undefined') {\n                let extent = layer.getBounds();\n                this._mapInstance.fitBounds(extent);\n            } else if(typeof( (layer as any).getLatLng) !== 'undefined') {\n                let latLng = (layer as any).getLatLng();\n                this._mapInstance.panTo(latLng);\n            } else {\n                console.log(\"MapInstance.focusFeature() - Cannot focus feature because it has no bounds or lat/lng\");\n            }\n        } else {\n            console.log(\"MapInstance.focusFeature() - Cannot focus feature because it has no layer\");\n        }\n    }\n\n    /**\n     * @param featureId : string\n     */\n    removeFeature (featureId) {\n        var layer = this.getFeatureLayer(featureId);\n        if(layer && this._featureLayer) {\n            this._featureLayer.removeLayer(layer);\n            this.touch('features:changed');\n        }\n    }\n\n    /**\n     *\n     */\n    removeFeatures () {\n        if(this._featureLayer) {\n            this._featureLayer.clearLayers();\n            this.touch(\"features:changed\");\n        }\n    }\n\n    /**\n     *\n     */\n    getFeatureLayer ( featureId ?: string ) : FeatureGroup {\n        //if no feature was specified, return root feature layer\n        if(!featureId) return this._featureLayer;\n\n        //otherwise, find feature...\n        if(!this._featureLayer) return null;\n\n        var features = this._featureLayer.getLayers();\n        for(var i=0; i<features.length; ++i) {\n            if( (features[i] as any).feature &&\n                (features[i] as any).feature.properties.id === featureId) {\n                return (features[i] as any);\n            }\n        }\n        return null;\n    }\n\n    toggleFeaturesLayer () {\n        if(!this._featureLayer) return false;    //ignore if not rendered yet\n\n        this._featureLayerVisible = !this._featureLayerVisible;\n        this.setFeatureLayerVisibility(this._featureLayer, this._featureLayerVisible);\n        return this._featureLayerVisible;\n    }\n\n    /**\n     * @param  feature - Leaflet feature instance\n     * @param  visibility - flag\n     */\n    setFeatureVisibility (feature, visibility : boolean) {\n        this.setFeatureLayerVisibility(feature, visibility);\n    }\n\n    getFeaturesLayerVisibility () {\n        return this._featureLayerVisible;\n    }\n\n\n    /*\n     * method for adding feature layers to the map\n     * when these layers may be layer groups.\n     * finds leaf node layers and adds them to the\n     * map's feature group\n     */\n    addFeatureLayer(layer) {\n        this._addFeatureLayer(layer);\n        this.touch(\"features:changed\");\n    }\n\n    /**\n     * Internal method, use 'addFeatureLayer' instead\n     * @param layer\n     */\n    _addFeatureLayer(layer : Layer) {\n        if(!(layer as any).feature && layer instanceof LayerGroup) {\n            layer.eachLayer( (child) => {\n                this._addFeatureLayer(child);\n            });\n        } else {\n            this._featureLayer.addLayer(layer);\n        }\n    }\n\n\n    //toggle visibility of parent feature layer\n    setFeatureLayerVisibility(layer, visibility) {\n        if(!layer) return;\n        this._featureLayerVisible = visibility;\n\n        if(layer.getLayers) {\n            layer.getLayers().forEach( (child) => {\n                this.setFeatureLayerVisibility(child, visibility);\n            });\n\n        } else {\n            let container = layer._container || layer._path;\n            if(container)\n                container.style.display = visibility ? '' : 'none';\n        }\n    }\n\n\n\n    /* ==============================================\n       Map lifecycle operations\n       ============================================== */\n\n    /**\n     * @param metadata\n     * @return resolving persisted map\n     */\n    save (metadata : any) : Promise<any> {\n        return this.saveMap(metadata);\n    }\n\n    /**\n     * @param md object containing metadata properties for map\n     */\n    saveMap (md : any) : Promise<any> {\n\n        let metadata = md || {};\n\n        //add GeoPlatformMap resource type if not already present\n        const gpMapType = 'http://www.geoplatform.gov/ont/openmap/GeoplatformMap';\n        metadata.resourceTypes = metadata.resourceTypes || [];\n        if(metadata.resourceTypes.indexOf(gpMapType) < 0)\n            metadata.resourceTypes.push(gpMapType);\n\n        var content = this.getMapResourceContent(metadata);\n\n        //ensure the two name properties line up\n        if(content.title && content.title !== content.label) {\n            content.label = content.title;\n        } else if(content.label && !content.title) {\n            content.title = content.label;\n        }\n\n        // console.log(\"Updating: \" + JSON.stringify(map));\n        return new Promise<any>( (resolve, reject) => {\n            this.getService(ItemTypes.MAP).save(content)\n            .then( result => {\n\n                //track new map's info so we can update it with next save\n                if(!this._mapId)\n                    this._mapId = result.id;\n\n                this._mapDef = result;\n                this._defaultExtent = result.extent;\n                this.clean();\n                resolve(result);\n            })\n            .catch(err=>{\n                console.log(\"MapCore MapInstance.saveMap() - \" +\n                    \"The requested map could not be saved because: \" + err.message);\n                let e = new Error(\"The requested map could not be saved because of the following error(s): \" +\n                    err.message);\n                reject(e);\n            });\n        });\n\n    }\n\n    /**\n     * Retrieve a map's descriptor from the registry\n     * @param mapId identifier of map\n     * @return resolving the map object\n     */\n    fetchMap (mapId : string) : any {\n        //Having to send cache busting parameter to avoid CORS header cache\n        // not sending correct Origin value\n        return this.getService(ItemTypes.MAP).get(mapId);\n    }\n\n    /**\n     * Retrieve a map's descriptor and load it as the\n     * current map managed by this service\n     * @param mapId identifier of map\n     * @return resolving the map object\n     */\n    loadMap (mapId : string) : any {\n\n        return new Promise<any>( (resolve, reject) => {\n\n            this.fetchMap(mapId).then(map => {\n\n                if(!map) {\n                    throw new Error(\"The requested map ('\" + mapId +\n                        \"') came back null\");\n\n                } else if(typeof(map) === 'string') {\n                    throw new Error(\"The requested map ('\" + mapId +\n                        \"') came back as a string\");\n\n                } else if((map as any).message) {\n                    throw new Error(\"There was an error loading the requested map ('\" +\n                        mapId + \"'): \" + (map as any).message);\n                }\n\n\n                //loading a map by its ID, so we need to increment it's view count\n                if('development' !== Config.env) {\n\n                    setTimeout( (map) => {\n                        //update view count\n                        let views = map.statistics ? (map.statistics.numViews||0) : 0;\n                        let patch = [ { op: 'replace', path: '/statistics/numViews', value: views+1 } ];\n                        this.getService(ItemTypes.MAP).patch(map.id, patch)\n                        // this.mapService.patch(map.id, patch)\n                        .then( updated => { map.statistics = updated.statistics; })\n                        .catch( e => {\n                            console.log(\"MapInstance.saveMap() - Error updating view \" +\n                                \"count for map ('\" + mapId + \"'): \" + e);\n                        });\n                    }, 1000, map);\n\n                }\n\n                //load the map into the viewer\n                this.loadMapFromObj(map);\n\n                resolve(map);\n            })\n            .catch( err => {\n                console.log(\"MapInstance.loadMap() - \" +\n                    \"The requested map could not be loaded because \" + err.message);\n                let e = new Error(\"The requested map ('\" + mapId +\n                    \"') could not be loaded because of the following error(s): \" +\n                    err.message);\n                reject(e);\n            });\n        });\n    }\n\n    /**\n     * Load a map from its descriptor as the current\n     * map managed by this service\n     * @param map object\n     */\n    loadMapFromObj (map : any) {\n\n        // console.log(\"Loading Map Object\");\n        // console.log(map);\n\n        this._mapId = map.id;\n        this._mapDef = map;\n\n        map.extent = this.ensureExtent(map.extent);\n\n        //set extent from loaded map\n        this._defaultExtent = map.extent;\n        var extent = map.extent;\n\n        //remove existing layers\n        this._mapInstance.eachLayer((l) => {\n            this._mapInstance.removeLayer(l);\n        });\n        this._layerCache = {};\n        this._layerStates = [];\n\n        //set new base layer\n        this.setBaseLayer(map.baseLayer);\n\n        //add layers from loaded map\n        this.addLayers(map.layers);\n\n        //add features\n        if(map.annotations && map.annotations.geoJSON) {\n            let fc = map.annotations.geoJSON;\n            if(fc.features)\n                this.addFeatures(fc.features);\n            else\n                this.addFeatures([fc]);\n        }\n\n        this._mapInstance.fitBounds([\n            [extent.miny, extent.minx],\n            [extent.maxy, extent.maxx]\n        ]);\n\n        this.clean();\n        this.notify('map:loaded', map);\n\n    }\n\n\n    /**\n     * @param extent\n     * @return corrected or default extent\n     */\n    ensureExtent( extent : any ) : any {\n\n        let west  = !extent || isNaN(extent.minx) ? -179.0 : extent.minx*1.0;\n        let east  = !extent || isNaN(extent.maxx) ?  179.0 : extent.maxx*1.0;\n        let south = !extent || isNaN(extent.miny) ?  -89.0 : extent.miny*1.0;\n        let north = !extent || isNaN(extent.maxy) ?   89.0 : extent.maxy*1.0;\n\n        //ensure x,y is ordered correctly\n        let t;\n        if(west > east) {\n            t = Math.min(west, east);\n            east = Math.max(west, east);\n            west = t;\n        }\n        if(south > north) {\n            t = Math.min(south, north);\n            north = Math.max(south, north);\n            south = t;\n        }\n\n        //prevent out-of-bounds extents\n        if(west < -180.0) west = -179.0;\n        if(east > 180.0)  east =  179.0;\n        if(south < -90.0) south = -89.0;\n        if(north > 90.0)  north =  89.0;\n\n        return { minx : west, miny : south, maxx : east, maxy : north };\n    }\n\n\n    /**\n     *\n     */\n    destroyMap () {\n        // console.log(\"Destroying Map\");\n        this._mapInstance = null;\n        this._layerCache = null;\n        this._layerStates = null;\n        this._featureLayer = null;\n    }\n\n\n    /**\n     * Used to take an existing map that is already persisted on the\n     * server and unlink it here in the client so that it will be saved\n     * as a completely new map when mapService.saveMap(...) is next called\n     */\n    setAsNewMap (mapToUse) {\n        this._mapId = null;\n        this._mapDef = mapToUse || this.initializeMapDefinition();\n    }\n\n\n    /* ==============================================\n        Tool operations\n       ============================================== */\n\n    registerTool (id, tool) {\n        this._tools[id] = tool;\n    }\n\n    unregisterTool (id) {\n        this._tools[id] = null;\n    }\n\n    enableTool (id, finish) {\n        if(!this._tools[id]) return false;\n        this._tools[id].activate(function() {\n            this.notify('tool:disabled', id);\n        });\n        this.notify('tool:enabled', id);\n    }\n\n\n    /* ----------- MISC ------------ */\n\n    //https://github.com/gsklee/ngStorage\n    cacheMap () {\n\n        if(this.state && this.state.dirty) {\n            var map = this.getMapResourceContent();\n            //use exploded layer info\n            map.layers = this._layerStates.slice(0);\n            // $sessionStorage.map = map;\n        }\n    }\n\n    restoreMap () {\n        // if($sessionStorage.map) {\n        //     console.log(\"Restoring cached map\");\n        //     let map = $sessionStorage.map;\n        //     // console.log(JSON.stringify(map));\n        //     $sessionStorage.map = null;\n        //     this.loadMapFromObj(map);\n        // }\n    }\n    /* ---------------------------- */\n}\n","\nimport MapInstance from './instance';\n\nvar cache = {};\n\nexport default {\n\n    get: function(key) {\n        if(key && cache[key])\n            return cache[key];\n\n        let instance = new MapInstance(key);\n        cache[instance._key] = instance;\n        return instance;\n    },\n\n    dispose: function(key) {\n        if(key) {\n            cache[key].dispose();\n            delete cache[key];\n        } else {\n            cache = null;\n        }\n    }\n};\n","\nimport Polyfills from \"./polyfills\";\nPolyfills();\n\n\nimport LoadingControl from './control/loading';\nimport MeasureControl from './control/measure';\nimport MousePositionControl from './control/mouse-position';\nimport FeatureEditor from './control/feature-editor';\n\nimport DefaultBaseLayer from './layer/baselayer-default';\nimport LayerFactory from './layer/factory';\nimport OSMLayerFactory from './layer/osm-factory';\nimport BaseClusteredFeatureLayer from './layer/base-clustered-feature-layer';\nimport {\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed\n} from './layer/cluster-feature';\nimport FeatureLayer from './layer/feature';\nimport {WMS, wms} from './layer/wms';\nimport {WMST, wmst} from './layer/wmst';\nimport {WMTS, wmts} from './layer/wmts';\nimport ESRITileLayer from './layer/esri-tile-layer';\nimport OSM from './layer/osm';\n\nimport MapInstance from './map/instance';\nimport MapFactory from './map/factory';\n\nimport ServiceTypes from './service/types';\n\nimport PopupTemplate from './shared/popup-template';\nimport StyleResolver from './shared/style-resolver';\n\n\n\n\nexport {\n    LoadingControl,\n    MeasureControl,\n    MousePositionControl,\n    FeatureEditor,\n    DefaultBaseLayer,\n    LayerFactory,\n    OSMLayerFactory,\n    BaseClusteredFeatureLayer,\n    ClusteredFeatureLayer,\n    clusteredFeatures,\n    geoJsonFeed,\n    FeatureLayer,\n    WMS, wms,\n    WMST, wmst,\n    WMTS, wmts,\n    ESRITileLayer,\n    OSM,\n    MapInstance,\n    MapFactory,\n    ServiceTypes,\n    PopupTemplate,\n    StyleResolver\n};\n"],"names":["L","icon","esri.FeatureManager","jQuery","marker","iconFn","markerFn","circleMarkerFn","L.TimeDimension","(/** @type {?} */ (L)).TimeDimension","ServiceTypes","ESRITileLayer","esri.tiledMapLayer","esri.imageMapLayer","L.canvas","esri.FeatureLayer","FeatureLayer","LayerFactory"],"mappings":"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"}
